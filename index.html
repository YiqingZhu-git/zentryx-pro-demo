<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Zentryx Pro - Professional cryptocurrency portfolio management and strategy analysis dashboard" />
    <meta name="keywords" content="cryptocurrency, portfolio, trading, strategy, crypto dashboard" />
    <meta name="author" content="Zentryx" />
    <meta name="theme-color" content="#ffffff" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Zentryx Pro - Crypto Strategy Dashboard" />
    <meta property="og:description" content="Professional cryptocurrency portfolio management and strategy analysis" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Zentryx Pro - Crypto Strategy Dashboard" />
    <meta name="twitter:description" content="Professional cryptocurrency portfolio management and strategy analysis" />
    
    <title>Zentryx Pro - Professional Crypto Strategy Dashboard</title>
    
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
      preconnect
    />
    
    <!-- External Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js" defer></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style" />
    
    <!-- No inline styles - all styles are in external styles.css -->
  </head>
  <body class="p-4 lg:p-6" role="application" aria-label="Zentryx Pro Dashboard">
    <div id="app" class="max-w-screen-2xl mx-auto">
      <!-- Header -->
      <header class="top-bar glass-panel mb-6 flex-shrink-0" role="banner">
        <div class="top-bar__left">
          <div class="brand-mark">
          <svg
            class="w-10 h-10 text-accent-blue"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              d="M12 2L2 7V17L12 22L22 17V7L12 2Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M2 7L12 12L22 7"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M12 12V22"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-secondary">Zentryx Pro</p>
              <h1 class="text-2xl font-bold leading-tight">Digital Portfolio Terminal</h1>
        </div>
          </div>
        </div>
        <nav class="top-bar__nav" aria-label="Primary navigation">
          <button class="top-nav-link active" data-nav="dashboard">Dashboard</button>
          <button class="top-nav-link" data-nav="strategies">Strategies</button>
          <button class="top-nav-link" data-nav="research">Research</button>
          <button class="top-nav-link" id="walletNavLink" aria-controls="walletDrawer">Wallet</button>
        </nav>
        <div class="top-bar__right">
          <div class="status-pill" id="systemStatusPill" role="status" aria-live="polite">
            <span class="status-dot" id="systemStatusDot"></span>
            <div>
              <p class="status-label" id="systemStatusLabel">Market data synced</p>
              <span class="status-meta" id="systemStatusMeta">Updated 8s ago</span>
            </div>
          </div>
          <div class="top-bar__controls">
          <button
            id="language-toggle"
            aria-label="Toggle language"
              class="icon-btn"
            title="Toggle language"
            >
              <span id="language-text" class="text-sm font-semibold">English</span>
          </button>
            <button
              id="theme-toggle"
              aria-label="Toggle theme"
              class="icon-btn"
              title="Toggle theme"
            >
              <svg
                id="theme-icon"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              ></svg>
            </button>
            <button
              id="colorblind-toggle"
              aria-label="Toggle colorblind friendly mode"
              class="icon-btn"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                ></path>
              </svg>
            </button>
            <button class="icon-btn" id="notificationBell" aria-label="Open notifications panel">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1.8"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                ></path>
              </svg>
              <span class="sr-only">Notifications</span>
            </button>
          </div>
          <div class="wallet-orb-wrapper">
            <button
              id="walletOrb"
              class="wallet-orb"
              type="button"
              aria-expanded="false"
              aria-controls="walletDrawer"
              title="Open wallet"
            >
              <span class="wallet-orb__glare" aria-hidden="true"></span>
              <svg
                class="wallet-orb__icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <path d="M3 7h18v10H3z"></path>
                <path d="M16 11.5a1.5 1.5 0 110 3"></path>
                <path d="M3 10h18"></path>
              </svg>
            </button>
            <span class="wallet-orb__label text-xs font-semibold text-secondary">Wallet</span>
          </div>
          <div id="user-profile" class="top-bar__user">
            <div class="text-right">
              <div class="text-sm font-semibold leading-tight"><span data-translate="Client">Client</span> Y. Zhu</div>
              <div class="text-xs text-secondary leading-tight">
                <span data-translate="Total Assets">Total Assets</span>: $1,254,300.50
              </div>
            </div>
            <img
              src="https://placehold.co/44x44/388BFD/ffffff?text=YZ"
              alt="User Avatar for Client Y. Zhu"
              class="w-11 h-11 rounded-full"
              loading="lazy"
            />
          </div>
        </div>
      </header>

      <!-- Hero -->
      <section id="heroSection" class="hero-grid rounded-3xl p-8 mb-8">
        <div class="hero-copy">
          <p class="hero-eyebrow">Multi-asset portfolio intelligence</p>
          <h2 class="hero-title">Understand, configure, and track your digital asset portfolio in one terminal.</h2>
          <p class="hero-subtitle">
            Technology-driven allocation models keep exposures, guardrails, and market context aligned so you stay execution-ready.
          </p>
          <div class="hero-cta">
            <button class="btn-primary hero-primary-cta" id="heroGeneratePlanBtn">Generate allocation brief</button>
            <button class="btn-secondary hero-secondary-cta" id="heroSamplePortfolioBtn">View sample portfolio</button>
          </div>
          <div class="hero-metrics">
            <div>
              <p class="metric-label">Configured portfolios</p>
              <p class="metric-value" id="heroConfiguredPortfolios">128</p>
            </div>
            <div>
              <p class="metric-label">Tracked assets</p>
              <p class="metric-value">25</p>
            </div>
            <div>
              <p class="metric-label">Automation coverage</p>
              <p class="metric-value">82%</p>
            </div>
          </div>
        </div>
        <div class="hero-visual glass-card rounded-2xl p-6">
          <div class="hero-visual__header">
            <div>
              <p class="text-xs uppercase tracking-wide text-secondary">Portfolio pulse</p>
              <h3 class="text-lg font-semibold">Live allocation drift</h3>
            </div>
            <span class="hero-badge">Realtime</span>
          </div>
          <div class="hero-chart-shell">
            <canvas id="heroPerformanceChart" aria-label="Hero performance trend" role="img"></canvas>
          </div>
          <div class="hero-visual__stats">
            <div>
              <p class="text-xs text-secondary">Last 30d</p>
              <p class="text-base font-semibold text-gain">+12.4%</p>
            </div>
            <div>
              <p class="text-xs text-secondary">Max drawdown</p>
              <p class="text-base font-semibold">-3.2%</p>
            </div>
            <div>
              <p class="text-xs text-secondary">Allocation drift</p>
              <p class="text-base font-semibold">1.8%</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Research Report Section -->
      <section class="research-report-section glass-card p-8 rounded-3xl mb-8">
        <div class="research-report-grid">
          <!-- Left Column: Report Info -->
          <div class="research-report-content">
            <div class="flex items-start gap-4 mb-6">
              <div class="research-icon">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <span class="research-badge" data-translate="New Research">æ–°ç ”ç©¶</span>
                  <span class="text-xs text-secondary">2025-08-20</span>
                </div>
                <h2 class="text-2xl font-bold mb-2" data-translate="Cryptocurrency Investment Strategy Research Report">æŠ•èµ„ç­–ç•¥ç ”ç©¶æŠ¥å‘Š</h2>
                <p class="text-base text-secondary leading-relaxed" data-translate="Comprehensive 40+ page analysis covering market trends, portfolio optimization, risk management, and strategic recommendations for cryptocurrency investment.">
                  å…¨é¢çš„40+é¡µåˆ†ææŠ¥å‘Šï¼Œæ¶µç›–å¸‚åœºè¶‹åŠ¿ã€æŠ•èµ„ç»„åˆä¼˜åŒ–ã€é£é™©ç®¡ç†ä»¥åŠæŠ•èµ„æˆ˜ç•¥å»ºè®®ã€‚
                </p>
              </div>
            </div>

            <!-- Report Highlights -->
            <div class="research-highlights mb-6">
              <h3 class="text-sm font-semibold uppercase tracking-wide text-secondary mb-3" data-translate="Report Highlights">æŠ¥å‘Šäº®ç‚¹</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="highlight-item">
                  <svg class="w-4 h-4 text-accent-blue" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                  </svg>
                  <span data-translate="6+ Investment Strategies Analyzed">6+ æŠ•èµ„ç­–ç•¥åˆ†æ</span>
                </div>
                <div class="highlight-item">
                  <svg class="w-4 h-4 text-accent-blue" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                  </svg>
                  <span data-translate="Market Sentiment Analysis">å¸‚åœºæƒ…ç»ªåˆ†æ</span>
                </div>
                <div class="highlight-item">
                  <svg class="w-4 h-4 text-accent-blue" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                  </svg>
                  <span data-translate="Risk Management Framework">é£é™©ç®¡ç†æ¡†æ¶</span>
                </div>
                <div class="highlight-item">
                  <svg class="w-4 h-4 text-accent-blue" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                  </svg>
                  <span data-translate="Portfolio Optimization Models">æŠ•èµ„ç»„åˆä¼˜åŒ–æ¨¡å‹</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col gap-4">
              <div class="flex flex-wrap gap-3">
                <a href="report.pdf" download class="btn-primary flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span data-translate="Check the Report (PDF)">æŸ¥çœ‹æŠ¥å‘Š (PDF)</span>
                </a>
              </div>

              <div class="report-metrics">
                <div class="report-metric-card">
                  <div class="metric-value">40+</div>
                  <p class="metric-label">é¡µ</p>
                </div>
                <div class="report-metric-card">
                  <div class="metric-value">6+</div>
                  <p class="metric-label">ç­–ç•¥</p>
                </div>
                <div class="report-metric-card">
                  <div class="metric-value">12.8%</div>
                  <p class="metric-label">å¹³å‡å›æŠ¥</p>
                </div>
                <div class="report-metric-card">
                  <div class="metric-value">2025</div>
                  <p class="metric-label">æœ€æ–°</p>
                </div>
              </div>
            </div>
          </div>

          <div class="research-report-side">
            <h3 class="text-lg font-semibold mb-3">é¡¹ç›®æŠ¥å‘Š Project Report</h3>
            <section id="docViewer" class="doc-viewer glass-card">
              <iframe
                src="report.pdf#toolbar=0&navpanes=0"
                width="100%"
                height="520"
                style="border: none; border-radius: 12px;"
                loading="lazy"
              ></iframe>
            </section>
          </div>
        </div>

        <div class="research-stats metrics-row">
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(56, 139, 253, 0.15), rgba(56, 139, 253, 0.05));">
              <svg class="w-6 h-6 text-accent-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
            </div>
            <div class="stat-value">40+</div>
            <div class="stat-label" data-translate="Pages">é¡µ</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(167, 139, 250, 0.05));">
              <svg class="w-6 h-6 text-accent-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </div>
            <div class="stat-value">6+</div>
            <div class="stat-label" data-translate="Strategies">ç­–ç•¥</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));">
              <svg class="w-6 h-6 text-gain" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
              </svg>
            </div>
            <div class="stat-value">12.8%</div>
            <div class="stat-label" data-translate="Avg. Return">å¹³å‡å›æŠ¥</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.05));">
              <svg class="w-6 h-6" style="color: #fbbf24;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="stat-value">2025</div>
            <div class="stat-label" data-translate="Latest">æœ€æ–°</div>
          </div>
        </div>
      </section>

      <!-- Main Content Grid -->
      <main class="dashboard-grid gap-6">
        <section class="dashboard-column space-y-6" aria-label="Portfolio overview">
          <div id="healthScoreCard" class="glass-card p-6 rounded-2xl"></div>
          <div id="portfolioSummary" class="glass-card p-6 rounded-2xl"></div>
          <div
            id="holdingsCard"
            class="glass-card p-6 rounded-2xl flex flex-col"
          >
            <div class="flex justify-between items-center mb-5 flex-shrink-0">
              <h2 class="text-lg font-semibold" data-translate="Holdings">Holdings</h2>
              <span id="assetCount" class="text-sm text-secondary"></span>
            </div>
            <div
              id="holdingsContainer"
              class="holdings-grid"
            ></div>
          </div>
        </section>

        <section class="dashboard-column space-y-6" aria-label="Smart allocation and strategies">
          <section
            id="portfolioAIAgentSection"
            class="glass-card p-6 rounded-2xl"
            aria-labelledby="ai-agent-title"
          >
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                <div class="smart-allocation-icon">
                  <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                  </svg>
                  <div class="smart-allocation-icon-glow"></div>
                </div>
                <div>
                  <p class="text-xs uppercase tracking-[0.35em] text-secondary mb-1 flex items-center gap-2">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                    Smart allocation
                  </p>
                  <h2 id="ai-agent-title" class="text-2xl font-bold" style="color: var(--text-primary);" data-translate="Smart Allocation Center">Smart Allocation Center</h2>
                  <p class="text-sm" style="color: var(--text-secondary);">Input your preferences and the system returns a structured allocation brief.</p>
                </div>
              </div>
            </div>
            
            <!-- Input Form -->
            <div id="ai-agent-input" class="mb-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Cash / Reserves (%)</label>
                  <input type="number" id="input-cash" min="0" max="100" value="" placeholder="e.g. 30" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Equities (%)</label>
                  <input type="number" id="input-stocks" min="0" max="100" value="" placeholder="e.g. 40" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Fixed Income (%)</label>
                  <input type="number" id="input-bonds" min="0" max="100" value="" placeholder="e.g. 20" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Digital assets (%)</label>
                  <input type="number" id="input-crypto" min="0" max="100" value="" placeholder="e.g. 10" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Risk tolerance</label>
                  <select id="input-risk" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                    <option value="conservative">Conservative</option>
                    <option value="balanced" selected>Balanced</option>
                    <option value="aggressive">Growth</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Investment horizon</label>
                  <select id="input-horizon" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                    <option value="1">1 year</option>
                    <option value="3" selected>3 years</option>
                    <option value="5">5 years</option>
                    <option value="10">10+ years</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Total assets (USD)</label>
                  <input type="number" id="input-total-assets" min="0" value="1254300" placeholder="e.g. 1,250,000" class="w-full px-4 py-2 rounded-lg border border-border-color bg-transparent" style="color: var(--text-primary);">
                </div>
              </div>
              <button id="generate-recommendation-btn" class="btn-primary w-full py-3 rounded-lg font-semibold flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                <span>Generate allocation plan</span>
              </button>
            </div>
            
            <!-- Loading State -->
            <div id="ai-agent-loading" class="hidden text-center py-8">
              <div class="spinner mx-auto mb-4"></div>
              <p class="text-sm" style="color: var(--text-secondary);">Processing preferences...</p>
            </div>
            
            <!-- Recommendation Results -->
            <div id="ai-agent-results" class="hidden"></div>
          </section>

          <div id="strategyScreener" class="glass-card p-6 rounded-2xl"></div>

          <!-- Sentiment Overlay Info Card -->
          <div class="glass-card p-5 rounded-2xl" style="background: linear-gradient(135deg, rgba(167, 139, 250, 0.08), rgba(56, 139, 253, 0.08)); border: 1px solid rgba(167, 139, 250, 0.2);">
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0">
                <div style="width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(56, 139, 253, 0.15)); display: flex; align-items: center; justify-content: center; border: 1.5px solid rgba(167, 139, 250, 0.3);">
                  <svg class="w-6 h-6" style="color: var(--accent-purple);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="font-semibold text-md" data-translate="Sentiment Overlay">æƒ…ç»ªå åŠ </h3>
                  <label class="switch">
                    <input type="checkbox" id="sentiment-toggle-header" />
                    <span class="slider"></span>
                  </label>
                </div>
                <p class="text-sm text-secondary leading-relaxed" data-translate="Enable sentiment overlay to highlight strategies that perform well in current market conditions. Strategies with a purple glow are best suited for the current Fear & Greed sentiment.">
                  å¯ç”¨æƒ…ç»ªå åŠ åŠŸèƒ½ï¼Œç³»ç»Ÿå°†æ ¹æ®å½“å‰å¸‚åœºæƒ…ç»ªï¼ˆææƒ§ä¸è´ªå©ªæŒ‡æ•°ï¼‰é«˜äº®æ˜¾ç¤ºè¡¨ç°ä¼˜å¼‚çš„ç­–ç•¥ã€‚å¸¦æœ‰ç´«è‰²å…‰æ™•çš„ç­–ç•¥æœ€é€‚åˆå½“å‰å¸‚åœºç¯å¢ƒã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            id="strategyOutput"
            class="glass-card p-6 rounded-2xl flex flex-col strategy-focus-shell"
          >
            <div id="strategyFocusAnchor" class="sr-only" aria-hidden="true"></div>
            <div class="flex justify-between items-center mb-4 flex-shrink-0">
              <h2 class="text-lg font-semibold" data-translate="My Strategy Library">System Strategy Recommendations</h2>
              <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                  <span class="text-xs font-medium text-secondary"
                    data-translate="Sentiment Overlay"
                    >Sentiment Overlay</span
                  >
                  <label class="switch">
                    <input type="checkbox" id="sentiment-toggle" />
                    <span class="slider"></span>
                  </label>
                </div>
                <button
                  id="compareAllBtn"
                  class="btn-secondary text-xs font-semibold py-1.5 px-3 rounded-md"
                  data-translate="Compare"
                >
                  Compare
                </button>
              </div>
            </div>
            <!-- Click Hint -->
            <div class="mb-3 p-3 rounded-lg" style="background: rgba(56, 139, 253, 0.08); border: 1px dashed rgba(56, 139, 253, 0.3);">
              <div class="flex items-center gap-2 text-sm">
                <svg class="w-4 h-4 flex-shrink-0" style="color: var(--accent-blue);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path>
                </svg>
                <span class="text-secondary" data-translate="Click on any strategy card to view detailed analysis, performance metrics, and personalized recommendations.">
                  ç‚¹å‡»ä»»æ„ç­–ç•¥å¡ç‰‡æŸ¥çœ‹è¯¦ç»†åˆ†æã€ä¸šç»©æŒ‡æ ‡å’Œä¸ªæ€§åŒ–å»ºè®®ã€‚
                </span>
              </div>
            </div>

            <div
              id="strategyList"
              class="space-y-3"
            ></div>
          </div>

          <!-- New: Strategy Performance Comparison -->
          <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-lg font-semibold mb-4" data-translate="Strategy Performance">Strategy Performance</h2>
            <div style="height: 200px; position: relative;">
              <canvas id="strategyPerformanceChart"></canvas>
            </div>
            <div class="grid grid-cols-3 gap-3 mt-4">
              <div class="text-center p-3 rounded-lg bg-bg-secondary">
                <div class="text-xs text-secondary mb-1">Avg Return</div>
                <div class="text-lg font-bold text-gain">+89.2%</div>
              </div>
              <div class="text-center p-3 rounded-lg bg-bg-secondary">
                <div class="text-xs text-secondary mb-1">Avg Sharpe</div>
                <div class="text-lg font-bold">1.85</div>
              </div>
              <div class="text-center p-3 rounded-lg bg-bg-secondary">
                <div class="text-xs text-secondary mb-1">Best</div>
                <div class="text-lg font-bold text-gain">+191%</div>
              </div>
            </div>
          </div>

          <!-- New: Market Conditions -->
          <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-lg font-semibold mb-4" data-translate="Market Conditions">Market Conditions</h2>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 rounded-lg bg-bg-secondary">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full bg-green-500"></div>
                  <span class="text-sm" data-translate="Volatility">Volatility</span>
                </div>
                <span class="text-sm font-semibold"><span data-translate="Low">Low</span> (12%)</span>
              </div>
              <div class="flex items-center justify-between p-3 rounded-lg bg-bg-secondary">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                  <span class="text-sm" data-translate="Liquidity">Liquidity</span>
                </div>
                <span class="text-sm font-semibold" data-translate="Medium">Medium</span>
              </div>
              <div class="flex items-center justify-between p-3 rounded-lg bg-bg-secondary">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                  <span class="text-sm">Trend</span>
                </div>
                <span class="text-sm font-semibold">Bullish</span>
              </div>
              <div class="flex items-center justify-between p-3 rounded-lg bg-bg-secondary">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full bg-purple-500"></div>
                  <span class="text-sm">Momentum</span>
                </div>
                <span class="text-sm font-semibold">Strong</span>
              </div>
            </div>
          </div>
        </section>

        <section class="dashboard-column space-y-6" aria-label="Market intelligence">
          <div id="marketSentimentCard" class="glass-card p-6 rounded-2xl" data-sentiment-value="62">
            <div class="flex items-center justify-between mb-4">
              <div>
                <p class="text-xs uppercase tracking-[0.3em] text-secondary" data-translate="Market context">Market context</p>
                <h2 class="text-lg font-semibold" data-translate="Market Sentiment">Market Sentiment</h2>
            </div>
              <span class="sentiment-badge" id="sentimentBadge" data-translate="Greed">Greed</span>
            </div>
            <div class="sentiment-gauge" role="img" aria-label="Market sentiment gauge">
              <svg viewBox="0 0 200 120">
                <defs>
                  <linearGradient id="sentimentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#f43f5e"></stop>
                    <stop offset="50%" stop-color="#fbbf24"></stop>
                    <stop offset="100%" stop-color="#22c55e"></stop>
                  </linearGradient>
                </defs>
                <path d="M10 110 A90 90 0 0 1 190 110" class="gauge-arc"></path>
                <path id="sentimentArc" d="M10 110 A90 90 0 0 1 190 110" class="gauge-arc gauge-arc--value"></path>
              </svg>
              <div class="gauge-needle" id="sentimentNeedle"></div>
              <div class="gauge-center">
                <span id="sentimentScoreValue">62</span>
                <small> / 100</small>
              </div>
            </div>
            <p class="text-sm text-secondary mt-4" id="sentimentImpactCopy">
              Sentiment leans optimistic; risk assets tend to outperform while spreads compress.
            </p>
          </div>

          <div id="marketNewsCard" class="glass-card p-6 rounded-2xl">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold" data-translate="Market Briefing">Market Briefing</h2>
              <button class="btn-secondary text-xs px-3 py-1.5 rounded-full" id="refreshNewsBtn" data-translate="Refresh">Refresh</button>
            </div>
            <ul id="marketNewsList" class="space-y-4"></ul>
          </div>

          <div id="whaleFlowCard" class="glass-card p-6 rounded-2xl">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold" data-translate="Capital Flows">Capital Flows</h2>
              <span class="text-xs text-secondary" data-translate="Last 90 minutes">Last 90 minutes</span>
            </div>
            <ul id="whaleFlowList" class="space-y-3 text-sm"></ul>
          </div>

          <!-- New: Portfolio Allocation Chart -->
          <div class="glass-card p-6 rounded-2xl">
            <div class="flex items-center gap-3 mb-4">
              <div class="allocation-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                </svg>
              </div>
              <div class="flex-1">
                <h2 class="text-lg font-semibold" data-translate="Asset Allocation">Asset Allocation</h2>
                <span class="text-xs text-secondary" data-translate="Current breakdown">Current breakdown</span>
              </div>
            </div>
            <div style="height: 220px; position: relative;">
              <canvas id="allocationDonutChart"></canvas>
            </div>
            <div id="allocationLegend" class="mt-4 space-y-2"></div>
          </div>

          <!-- New: Performance Metrics Summary -->
          <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-lg font-semibold mb-4" data-translate="Performance Metrics">Performance Metrics</h2>
            <div class="space-y-3">
              <div class="flex justify-between items-center py-2 border-b border-border-color">
                <span class="text-sm text-secondary" data-translate="YTD Return">Total Return (YTD)</span>
                <span class="font-semibold text-gain">+47.3%</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-border-color">
                <span class="text-sm text-secondary" data-translate="Best Performer">Best Performer</span>
                <span class="font-semibold">SOL <span class="text-gain text-xs">+125%</span></span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-border-color">
                <span class="text-sm text-secondary" data-translate="Worst Performer">Worst Performer</span>
                <span class="font-semibold">DOGE <span class="text-loss text-xs">-12%</span></span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-border-color">
                <span class="text-sm text-secondary" data-translate="Win Rate">Win Rate</span>
                <span class="font-semibold">68%</span>
              </div>
              <div class="flex justify-between items-center py-2">
                <span class="text-sm text-secondary">Avg. Hold Time</span>
                <span class="font-semibold">45 days</span>
              </div>
            </div>
          </div>

          <!-- New: Quick Actions -->
          <div class="glass-card p-6 rounded-2xl">
            <h2 class="text-lg font-semibold mb-4" data-translate="Quick Actions">Quick Actions</h2>
            <div class="grid grid-cols-2 gap-3">
              <button class="quick-action-btn">
                <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span class="text-xs" data-translate="Rebalance">Rebalance</span>
                  </button>
              <button class="quick-action-btn">
                <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <span class="text-xs" data-translate="Analytics">Analytics</span>
                  </button>
              <button class="quick-action-btn">
                <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="text-xs" data-translate="Export">Export</span>
                  </button>
              <button class="quick-action-btn">
                <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <span class="text-xs" data-translate="Alerts">Alerts</span>
              </button>
              </div>
          </div>

          <!-- New: Risk Metrics -->
          <div class="glass-card p-6 rounded-2xl">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold" data-translate="Risk Monitor">Risk Monitor</h2>
              <span class="tag tag-green" data-translate="Healthy">Healthy</span>
            </div>
            <div class="space-y-3">
              <div>
                <div class="flex justify-between items-center mb-1">
                  <span class="text-xs text-secondary" data-translate="Portfolio Beta">Portfolio Beta</span>
                  <span class="text-sm font-semibold">0.85</span>
                </div>
                <div class="w-full bg-bg-secondary rounded-full h-2">
                  <div class="h-2 rounded-full bg-gradient-to-r from-accent-blue to-accent-purple" style="width: 85%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between items-center mb-1">
                  <span class="text-xs text-secondary" data-translate="Diversification Score">Diversification Score</span>
                  <span class="text-sm font-semibold">78/100</span>
                </div>
                <div class="w-full bg-bg-secondary rounded-full h-2">
                  <div class="h-2 rounded-full bg-gradient-to-r from-green-400 to-green-600" style="width: 78%"></div>
                </div>
              </div>
              <div>
                <div class="flex justify-between items-center mb-1">
                  <span class="text-xs text-secondary" data-translate="Liquidity Risk">Liquidity Risk</span>
                  <span class="text-sm font-semibold" data-translate="Low">Low</span>
                </div>
                <div class="w-full bg-bg-secondary rounded-full h-2">
                  <div class="h-2 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-600" style="width: 25%"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Advanced Analytics -->
      <section id="advancedAnalyticsSection" class="mt-8 mb-6" aria-labelledby="analytics-title">
        <div class="glass-card p-6 rounded-3xl space-y-6">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div>
              <p class="text-xs uppercase tracking-[0.35em] text-secondary" data-translate="Deep dive">Deep dive</p>
              <h2 id="analytics-title" class="text-2xl font-bold" style="color: var(--text-primary);" data-translate="Strategy & Portfolio Analytics">Strategy & Portfolio Analytics</h2>
            </div>
            <button
              id="toggleComparisonBtn"
              class="btn-secondary text-sm font-semibold py-2 px-4 rounded-md"
              aria-expanded="true"
              aria-controls="advanced-analytics-content"
            >
              <span class="toggle-text">Hide</span> <span data-translate="Analytics">Analytics</span>
            </button>
          </div>
          <div id="advanced-analytics-content" class="analytics-grid">
            <div class="analytics-card glass-card rounded-2xl p-5" id="quadrantChartCard">
                <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" data-translate="Risk / Return Quadrant">Risk / Return Quadrant</h3>
                <button class="icon-btn" id="openComparisonGalleryBtn" aria-label="Open strategy gallery">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h8M4 10h8M4 14h4"></path>
                    </svg>
                  </button>
                </div>
              <canvas
                id="quadrantChart"
                aria-label="Quadrant chart comparing strategy risk and return"
                role="img"
                height="220"
              ></canvas>
                  </div>
            <div class="analytics-card glass-card rounded-2xl p-5">
              <h3 class="text-lg font-semibold mb-4" data-translate="Portfolio vs Benchmark">Portfolio vs Benchmark</h3>
              <canvas id="portfolioVsBenchmarkChart" height="220"></canvas>
                </div>
            <div class="analytics-card glass-card rounded-2xl p-5">
              <h3 class="text-lg font-semibold mb-4" data-translate="Strategy Risk Buckets">Strategy Risk Buckets</h3>
              <div id="strategyRiskDistribution" class="space-y-3"></div>
                  </div>

            <!-- New: Asset Correlation Heatmap -->
            <div class="analytics-card glass-card rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" data-translate="Asset Correlation Matrix">Asset Correlation</h3>
                <span class="text-xs text-secondary" data-translate="Rolling 30-day">Rolling 30-day</span>
                </div>
              <div id="correlationMatrix" class="overflow-x-auto"></div>
              </div>

            <!-- New: Maximum Drawdown Analysis -->
            <div class="analytics-card glass-card rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" data-translate="Max Drawdown">Max Drawdown</h3>
                <span class="text-xs text-secondary" data-translate="Peak to trough">Peak to trough</span>
              </div>
              <canvas id="drawdownChart" height="220"></canvas>
            </div>
            
            <!-- New: Rolling Sharpe Ratio -->
            <div class="analytics-card glass-card rounded-2xl p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold" data-translate="Rolling Sharpe Ratio">Rolling Sharpe Ratio</h3>
                <span class="text-xs text-secondary" data-translate="60-day rolling window">60-day window</span>
              </div>
              <canvas id="rollingSharpeChart" height="220"></canvas>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Floating Smart Assistant Entry -->
    <button
      id="assistantFab"
      class="assistant-fab"
      type="button"
      aria-controls="assistantChatPanel"
      aria-expanded="false"
    >
      ğŸ’¬ <span data-translate="Smart assistant">æ™ºèƒ½åŠ©æ‰‹</span>
    </button>
    <section
      id="assistantChatPanel"
      class="assistant-chat glass-card rounded-2xl hidden"
      aria-label="Smart assistant conversation"
    >
      <div class="assistant-chat__header">
        <div>
          <p class="text-sm font-semibold" data-translate="Smart assistant">æ™ºèƒ½åŠ©æ‰‹</p>
          <p class="text-xs text-secondary" data-translate="On-demand strategy insights">éšæ—¶è·å–ç­–ç•¥è§è§£</p>
        </div>
        <button
          id="assistantChatClose"
          class="btn-secondary p-2 rounded-full"
          type="button"
          aria-label="Close assistant panel"
        >
          <svg
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="assistantChatBody" class="assistant-chat__body">
        <div class="assistant-message">
          <p class="text-xs text-secondary mb-1">Zentryx AI</p>
          <p class="text-sm">
            ğŸ‘‹ Hello! I'm your AI portfolio assistant. I can help you with strategy analysis, risk assessment, market insights, and portfolio optimization. Ask me anything about your investments!
          </p>
        </div>
      </div>
      <form id="assistantChatForm" class="assistant-chat__form">
        <input
          id="assistantChatInput"
          type="text"
          class="flex-1 bg-transparent border border-border-color rounded-lg px-3 py-2 text-sm"
          placeholder="Describe a task, e.g. rebalance BTC sleeve"
          aria-label="Assistant request"
          required
        />
        <button type="submit" class="btn-primary px-4 py-2 rounded-lg text-sm font-semibold">
          Send
        </button>
      </form>
    </section>

    <div id="chartTooltip" class="chart-tooltip" role="tooltip" aria-hidden="true"></div>

    <!-- Wallet Drawer -->
    <div id="walletDrawerOverlay" class="wallet-drawer-overlay hidden" aria-hidden="true"></div>
    <aside
      id="walletDrawer"
      class="wallet-drawer"
      role="dialog"
      aria-modal="false"
      aria-labelledby="walletDrawerTitle"
    >
      <div class="wallet-drawer__header">
        <div>
          <p id="walletDrawerTitle" class="text-lg font-semibold">Wallet Console</p>
          <p class="text-xs text-secondary uppercase tracking-[0.25em]">Balances Â· shortcuts Â· records</p>
        </div>
        <button
          id="closeWalletDrawer"
          class="btn-secondary p-2 rounded-full"
          type="button"
          aria-label="Close wallet panel"
        >
          <svg
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="wallet-drawer__content">
        <div class="wallet-balance-card glass-card rounded-2xl p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs uppercase tracking-wide text-secondary">Total balance</p>
              <p class="text-3xl font-semibold">$1,254,300.50</p>
            </div>
            <span class="tag tag-green">+4.6% this week</span>
          </div>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <p class="text-secondary text-xs mb-1 uppercase tracking-wider">Last sync</p>
              <p class="font-semibold">25 seconds ago</p>
            </div>
            <div>
              <p class="text-secondary text-xs mb-1 uppercase tracking-wider">Connected</p>
              <p class="font-semibold">MetaMask Â· Ledger</p>
            </div>
          </div>
        </div>
        <div>
          <p class="text-sm font-semibold mb-3">Quick actions</p>
          <div class="grid grid-cols-3 gap-3">
            <button class="wallet-quick-btn btn-secondary flex flex-col items-center gap-2 py-3 rounded-2xl">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14"></path>
                <path d="M5 12h14"></path>
              </svg>
              <span class="text-xs font-semibold">Deposit</span>
            </button>
            <button class="wallet-quick-btn btn-secondary flex flex-col items-center gap-2 py-3 rounded-2xl">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
                <path d="M12 19V5"></path>
              </svg>
              <span class="text-xs font-semibold">Withdraw</span>
            </button>
            <button class="wallet-quick-btn btn-secondary flex flex-col items-center gap-2 py-3 rounded-2xl">
              <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 2v6h-6"></path>
                <path d="M3 22v-6h6"></path>
                <path d="M21 2l-7 7"></path>
                <path d="M3 22l7-7"></path>
              </svg>
              <span class="text-xs font-semibold">Sync</span>
            </button>
          </div>
        </div>
        <div>
          <p class="text-sm font-semibold mb-3">Latest activity</p>
          <ul id="walletHistoryList" class="space-y-3 text-sm"></ul>
        </div>
        <div class="glass-card rounded-2xl p-4 text-sm">
          <p class="font-semibold mb-1">Security posture</p>
          <p class="text-secondary">Connections encrypted Â· Hardware wallets supported Â· Session monitors enabled.</p>
        </div>
      </div>
    </aside>

    <!-- Image Gallery Modal with Swipe Support -->
    <div
      id="imageGalleryModal"
      class="fixed inset-0 z-50 items-center justify-center hidden bg-black bg-opacity-98 backdrop-blur-md"
      role="dialog"
      aria-modal="true"
      aria-labelledby="gallery-modal-title"
      aria-hidden="true"
    >
      <!-- Close Button - Always visible -->
      <button
        id="closeGalleryBtn"
        class="fixed top-6 right-6 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-900 rounded-full p-3 transition-all z-50 shadow-2xl hover:scale-110"
        aria-label="Close gallery"
        style="backdrop-filter: blur(10px);"
      >
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      
      <!-- Navigation Arrows -->
      <button
        id="galleryPrevBtn"
        class="fixed left-6 top-1/2 -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-900 rounded-full p-4 transition-all z-50 shadow-2xl hover:scale-110"
        aria-label="Previous visual"
        style="backdrop-filter: blur(10px);"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      <button
        id="galleryNextBtn"
        class="fixed right-6 top-1/2 -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-900 rounded-full p-4 transition-all z-50 shadow-2xl hover:scale-110"
        aria-label="Next visual"
        style="backdrop-filter: blur(10px);"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      
      <!-- Gallery Container -->
      <div class="w-full h-full flex flex-col items-center justify-center p-8">
        <!-- Title -->
        <h3 id="gallery-modal-title" class="text-white text-2xl font-bold mb-6 text-center drop-shadow-lg"></h3>
        
        <!-- Image Counter -->
        <div id="gallery-counter" class="text-white text-sm mb-4 opacity-75"></div>
        
        <!-- Main Image Container -->
        <div class="flex-1 flex items-center justify-center w-full max-w-[90vw] max-h-[80vh] overflow-hidden">
          <div id="gallery-image-container" class="relative w-full h-full flex items-center justify-center">
            <img
              id="gallery-main-image"
              src=""
              alt=""
              class="max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-transform duration-300"
              style="image-rendering: high-quality;"
            />
            <!-- Loading Indicator -->
            <div id="gallery-loading" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-lg hidden">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
        
        <!-- Thumbnail Strip -->
        <div id="gallery-thumbnails" class="mt-6 flex gap-3 overflow-x-auto max-w-full px-4 pb-2" style="scrollbar-width: thin;">
          <!-- Thumbnails will be populated here -->
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div
      id="strategyDetailModal"
      class="fixed inset-0 z-50 hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="strategy-modal-title"
      aria-hidden="true"
      style="background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);"
    >
      <div class="h-full w-full overflow-y-auto overflow-x-hidden">
        <div class="min-h-full flex items-start justify-center p-4 lg:p-8 py-8">
      <div
        id="strategyDetailContent"
            class="max-w-screen-xl w-full mx-auto relative"
            style="background: var(--bg-primary); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem;"
          >
            <!-- Content will be inserted here -->
          </div>
        </div>
      </div>
      <button
        id="closeStrategyModalBtn"
        class="fixed top-6 right-8 bg-white dark:bg-gray-800 bg-opacity-90 hover:bg-opacity-100 text-gray-900 dark:text-white rounded-full p-3 transition-all z-50 shadow-2xl hover:scale-110 border-2 border-gray-200 dark:border-gray-700"
        aria-label="Close strategy details"
        style="backdrop-filter: blur(10px);"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          stroke-width="2.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>
    <div
      id="aiAnalysisModal"
      class="fixed inset-0 z-50 items-center justify-center hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="ai-modal-title"
      aria-hidden="true"
    >
      <div class="modal-backdrop fixed inset-0" aria-hidden="true"></div>
      <div class="relative glass-card w-full max-w-lg p-6 rounded-2xl">
        <h3 id="ai-modal-title" class="text-xl font-semibold mb-4 flex items-center">
          âœ¨ System insight
        </h3>
        <div
          id="aiAnalysisContent"
          class="text-sm leading-relaxed max-h-[60vh] overflow-y-auto"
          role="region"
          aria-live="polite"
          aria-atomic="true"
        ></div>
        <button
          id="closeAiModalBtn"
          class="absolute top-3 right-3 text-secondary hover:text-primary"
      aria-label="Close intelligent analysis modal"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>
    <div
      id="walletModal"
      class="fixed inset-0 z-50 items-center justify-center hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="wallet-modal-title"
      aria-hidden="true"
    >
      <div class="modal-backdrop fixed inset-0" aria-hidden="true"></div>
      <div class="relative glass-card w-full max-w-md p-6 rounded-2xl">
        <h3 id="wallet-modal-title" class="text-xl font-semibold text-center mb-6">
          Connect Your Wallet
        </h3>
        <div
          id="walletOptions"
          class="grid grid-cols-2 sm:grid-cols-3 gap-4"
          role="list"
          aria-label="Available wallet options"
        ></div>
        <button
          id="closeWalletModalBtn"
          class="absolute top-3 right-3 text-secondary hover:text-primary"
          aria-label="Close wallet connection modal"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DATA & CONFIG ---
        const userHoldingsSymbols = [
          "BTC",
          "ETH",
          "SOL",
          "DOGE",
          "MATIC",
          "KAS",
          "LDO",
          "UNI",
          "AAVE",
          "MKR",
          "BNB",
          "TAO",
          "ADA",
          "PEPE",
          "BONK",
        ];
        const assetSymbols = [
          "BTC",
          "ETH",
          "SOL",
          "DOGE",
          "MATIC",
          "KAS",
          "LDO",
          "UNI",
          "AAVE",
          "MKR",
          "BNB",
          "TAO",
          "ADA",
          "PEPE",
          "BONK",
          "XRP",
          "USDC",
          "SUI",
          "LTC",
          "ENA",
          "SHIB",
          "TRX",
          "LINK",
          "ATOM",
          "FIL",
        ];

        const userPortfolioProfile = {
          BTC: { allocationUsd: 520000 },
          ETH: { allocationUsd: 245000 },
          SOL: { allocationUsd: 95000 },
          DOGE: { allocationUsd: 32000 },
          MATIC: { allocationUsd: 40000 },
          KAS: { allocationUsd: 27000 },
          LDO: { allocationUsd: 33000 },
          UNI: { allocationUsd: 38000 },
          AAVE: { allocationUsd: 36000 },
          MKR: { allocationUsd: 42000 },
          BNB: { allocationUsd: 82000 },
          TAO: { allocationUsd: 28000 },
          ADA: { allocationUsd: 24000 },
          PEPE: { allocationUsd: 7000 },
          BONK: { allocationUsd: 5300 },
        };
        const portfolioFallbackAllocation = 25000;

        const walletActivity = [
          { type: "Deposit", meta: "OTC desk", amount: "+$85,000", time: "09:24", accent: "positive" },
          { type: "Staking", meta: "ETH validator", amount: "-32 ETH", time: "08:11", accent: "neutral" },
          { type: "Transfer out", meta: "Custody vault", amount: "-$25,400", time: "22:10 yesterday", accent: "negative" },
          { type: "Airdrop", meta: "ZENTRY", amount: "+4,500 ZEN", time: "16:02 yesterday", accent: "positive" },
        ];

        const sparklineCache = new Map();
        const assetMeta = new Map();
        const SPARKLINE_ANIMATION_DURATION = 300;
        const chartTooltip = document.getElementById("chartTooltip");
        const healthScoreInsights = {
          diversification: "Evaluates concentration versus diversification across holdings and sleeves.",
          volatility: "Tracks realised swings and drawdowns against your stated preference.",
          environment: "Blends current market sentiment with your beta and liquidity exposure."
        };

        if (window.Chart) {
          Chart.defaults.animation = { duration: 300, easing: "easeOutCubic" };
          Chart.defaults.plugins = Chart.defaults.plugins || {};
          Chart.defaults.plugins.tooltip = Chart.defaults.plugins.tooltip || {};
          Chart.defaults.plugins.tooltip.enabled = true;
          Chart.defaults.interaction = { intersect: false, mode: "index" };
        }

        const staticMarketData = {
          Message: "Success",
          Type: 100,
          Data: [
            {
              CoinInfo: {
                Id: "1182",
                Name: "BTC",
                FullName: "Bitcoin",
                ImageUrl: "/media/37746251/btc.png",
              },
              RAW: {
                USD: {
                  PRICE: 116392.10589834,
                  CHANGEPCT24HOUR: 1.8594635263653503,
                  VOLUME24HOURTO: 1589947067.72124,
                  MKTCAP: 2294370000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "7605",
                Name: "ETH",
                FullName: "Ethereum",
                ImageUrl: "/media/37746238/eth.png",
              },
              RAW: {
                USD: {
                  PRICE: 3831.08497195876,
                  CHANGEPCT24HOUR: 6.33899509657001,
                  VOLUME24HOURTO: 1407386987.4723,
                  MKTCAP: 460000000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "934443",
                Name: "SOL",
                FullName: "Solana",
                ImageUrl: "/media/37747734/sol.png",
              },
              RAW: {
                USD: {
                  PRICE: 172.070185738805,
                  CHANGEPCT24HOUR: 4.720509133573706,
                  VOLUME24HOURTO: 206880055.191624,
                  MKTCAP: 79000000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "4432",
                Name: "DOGE",
                FullName: "Dogecoin",
                ImageUrl: "/media/37746339/doge.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.214662268125027,
                  CHANGEPCT24HOUR: 6.993990255403637,
                  VOLUME24HOURTO: 84534479.2990717,
                  MKTCAP: 30000000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "960603",
                Name: "MATIC",
                FullName: "Polygon",
                ImageUrl: "/media/37746047/matic.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.7368,
                  CHANGEPCT24HOUR: 8.49,
                  VOLUME24HOURTO: 1884556.05,
                  MKTCAP: 7300000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "953119",
                Name: "KAS",
                FullName: "Kaspa",
                ImageUrl: "/media/43957904/kas.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.18967,
                  CHANGEPCT24HOUR: 4.75,
                  VOLUME24HOURTO: 24320809.07,
                  MKTCAP: 4500000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "925809",
                Name: "LDO",
                FullName: "Lido DAO",
                ImageUrl: "/media/40485192/ldo.png",
              },
              RAW: {
                USD: {
                  PRICE: 2.023,
                  CHANGEPCT24HOUR: 12.09,
                  VOLUME24HOURTO: 3147426.72,
                  MKTCAP: 1800000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "171986",
                Name: "UNI",
                FullName: "Uniswap",
                ImageUrl: "/media/37746885/uni.png",
              },
              RAW: {
                USD: {
                  PRICE: 10.18,
                  CHANGEPCT24HOUR: 7.89,
                  VOLUME24HOURTO: 81173580.57,
                  MKTCAP: 7600000000,
                },
              },
            },
            {
              CoinInfo: {
                Id: "321992",
                Name: "AAVE",
                FullName: "Aave",
                ImageUrl: "/media/37747534/aave.png",
              },
              RAW: {
                USD: {
                  PRICE: 93.85,
                  CHANGEPCT24HOUR: 7.59,
                  VOLUME24HOURTO: 7384231.99,
                  MKTCAP: 1300000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "MKR",
                FullName: "Maker",
                ImageUrl: "/media/37746665/mkr.png",
              },
              RAW: {
                USD: {
                  PRICE: 2350.1,
                  CHANGEPCT24HOUR: -1.5,
                  VOLUME24HOURTO: 117500000,
                  MKTCAP: 2100000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "BNB",
                FullName: "BNB",
                ImageUrl: "/media/40485170/bnb.png",
              },
              RAW: {
                USD: {
                  PRICE: 580.5,
                  CHANGEPCT24HOUR: 0.5,
                  VOLUME24HOURTO: 464400000,
                  MKTCAP: 85000000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "TAO",
                FullName: "Bittensor",
                ImageUrl: "/media/44082055/tao.png",
              },
              RAW: {
                USD: {
                  PRICE: 285.2,
                  CHANGEPCT24HOUR: 3.1,
                  VOLUME24HOURTO: 71300000,
                  MKTCAP: 1900000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "ADA",
                FullName: "Cardano",
                ImageUrl: "/media/37746235/ada.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.389,
                  CHANGEPCT24HOUR: -0.9,
                  VOLUME24HOURTO: 11670000,
                  MKTCAP: 13000000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "PEPE",
                FullName: "Pepe",
                ImageUrl: "/media/43957908/pepe.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.0000115,
                  CHANGEPCT24HOUR: 10.2,
                  VOLUME24HOURTO: 5750000,
                  MKTCAP: 4800000000,
                },
              },
            },
            {
              CoinInfo: {
                Name: "BONK",
                FullName: "Bonk",
                ImageUrl: "/media/44082052/bonk.png",
              },
              RAW: {
                USD: {
                  PRICE: 0.0000218,
                  CHANGEPCT24HOUR: 8.1,
                  VOLUME24HOURTO: 4360000,
                  MKTCAP: 1400000000,
                },
              },
            },
          ],
        };
        const staticNewsData = {
          Type: 100,
          Message: "News list successfully returned",
          Promoted: [],
          Data: [
            {
              id: "49695165",
              guid: "https://timestabloid.com/?p=77256",
              published_on: 1754575525,
              imageurl:
                "https://resources.cryptocompare.com/news/67/default.png",
              title: "Top Analyst Says XRP Is About to Explode. Hereâ€™s Why",
              url: "https://timestabloid.com/top-analyst-says-xrp-is-about-to-explode-heres-why/",
              body: "The XRP market has shown some volatility in recent weeks, but a new chart shared by crypto analyst JackTheRippler (@RippleXrpie) suggests that the token may be on the verge of a major breakout.",
              tags: "Cryptocurrency|News|XRP|XRP Price|XRP Price Prediction",
              lang: "EN",
              upvotes: "0",
              downvotes: "0",
              categories: "XRP|TRADING|MARKET|RESEARCH",
              source_info: {
                name: "TimesTabloid",
                img: "https://resources.cryptocompare.com/news/67/default.png",
                lang: "EN",
              },
              source: "timestabloid",
            },
            {
              id: "49695197",
              guid: "https://bitcoinworld.co.in/?p=186671",
              published_on: 1754575511,
              imageurl:
                "https://resources.cryptocompare.com/news/82/49695197.jpeg",
              title:
                "U.S. Stock Markets Soar: A Powerful Boost for Financial Markets",
              url: "https://bitcoinworld.co.in/us-stock-markets-soar-3/",
              body: "The highly anticipated opening of U.S. stock markets today delivered a wave of positive news, with all major indices registering significant gains.",
              tags: "Crypto News|Economic News|financial markets|investor sentiment|market rally|Stocks",
              lang: "EN",
              upvotes: "0",
              downvotes: "0",
              categories: "MARKET|BUSINESS|TRADING|MACROECONOMICS",
              source_info: {
                name: "Bitcoin World",
                img: "https://resources.cryptocompare.com/news/82/default.png",
                lang: "EN",
              },
              source: "bitcoinworld",
            },
            {
              id: "49695203",
              guid: "https://seekingalpha.com/news/4481352-ripple-to-acquire-stablecoin-payments-platform-rail-for-200m?utm_source=cryptocompare.com&utm_medium=referral&feed_item_type=news",
              published_on: 1754575469,
              imageurl:
                "https://resources.cryptocompare.com/news/50/49695203.jpeg",
              title:
                "Ripple to acquire stablecoin payments platform Rail for $200M",
              url: "https://seekingalpha.com/news/4481352-ripple-to-acquire-stablecoin-payments-platform-rail-for-200m?utm_source=cryptocompare.com&utm_medium=referral&feed_item_type=news",
              body: "More on Ripple USD, Ripple USD Bitcoin Pulls Back, Leaving A Mixed Sentiment In Crypto Markets (Technical Analysis) XRP Surges 10% In 24 Hours As Bitcoin Consolidates Below $120k",
              tags: "XRP-USD|RLUSD-USD",
              lang: "EN",
              upvotes: "0",
              downvotes: "0",
              categories: "BTC|MARKET|TRADING|XRP|ALTCOIN",
              source_info: {
                name: "Seeking Alpha",
                img: "https://images.cryptocompare.com/news/default/seekingalpha.png",
                lang: "EN",
              },
              source: "seekingalpha",
            },
            {
              id: "49694976",
              guid: "https://www.newsbtc.com/?p=800500",
              published_on: 1754575232,
              imageurl:
                "https://resources.cryptocompare.com/news/21/49694976.jpeg",
              title:
                "XRP Whale Activity Signals Warning: Distribution Pattern Resurfaces",
              url: "https://www.newsbtc.com/xrp-news/xrp-whale-activity-signals-warning-distribution-pattern-resurfaces/",
              body: "XRP has come under selling pressure following its recent all-time highs near the end of July.",
              tags: "XRP News|xrp|XRP analysis|XRP distribution|xrp news|XRP Price|XRP selling pressure|XRP Whale Activity|xrpusdt",
              lang: "EN",
              upvotes: "0",
              downvotes: "0",
              categories: "XRP|TRADING|MARKET|BTC|BUSINESS",
              source_info: {
                name: "NewsBTC",
                img: "https://images.cryptocompare.com/news/default/newsbtc.png",
                lang: "EN",
              },
              source: "newsbtc",
            },
            {
              id: "49694927",
              guid: "https://bitcoinworld.co.in/?p=186672",
              published_on: 1754575212,
              imageurl:
                "https://resources.cryptocompare.com/news/82/49694927.jpeg",
              title:
                "Cipher Mining: Unveiling Q2 Financial Performance with a $46M Loss and Robust BTC Holdings",
              url: "https://bitcoinworld.co.in/cipher-mining-q2-loss/",
              body: "The world of cryptocurrency mining is constantly evolving, with companies navigating volatile markets and operational challenges.",
              tags: "Crypto News|Bitcoin Mining|cipher mining|CRYPTOCURRENCY|Financial Results|Mining Operations",
              lang: "EN",
              upvotes: "0",
              downvotes: "0",
              categories: "MINING|BTC|MARKET|BUSINESS|TRADING",
              source_info: {
                name: "Bitcoin World",
                img: "https://resources.cryptocompare.com/news/82/default.png",
                lang: "EN",
              },
              source: "bitcoinworld",
            },
          ],
        };
        const staticWhaleData = [
          {
            id: 1,
            timestamp: Date.now() - 5 * 60 * 1000,
            symbol: "ETH",
            type: "DEPOSIT",
            amountCrypto: 10000,
            amountUSD: 38300000,
            from: "Unknown Wallet",
            to: "Binance",
          },
          {
            id: 2,
            timestamp: Date.now() - 12 * 60 * 1000,
            symbol: "BTC",
            type: "WITHDRAWAL",
            amountCrypto: 500,
            amountUSD: 58200000,
            from: "Coinbase",
            to: "Unknown Wallet",
          },
          {
            id: 3,
            timestamp: Date.now() - 25 * 60 * 1000,
            symbol: "PEPE",
            type: "DEPOSIT",
            amountCrypto: 1000000000000,
            amountUSD: 11500000,
            from: "Unknown Wallet",
            to: "OKX",
          },
          {
            id: 4,
            timestamp: Date.now() - 45 * 60 * 1000,
            symbol: "SOL",
            type: "WITHDRAWAL",
            amountCrypto: 200000,
            amountUSD: 34400000,
            from: "Kraken",
            to: "Phantom Wallet",
          },
          {
            id: 5,
            timestamp: Date.now() - 75 * 60 * 1000,
            symbol: "BTC",
            type: "DEPOSIT",
            amountCrypto: 1000,
            amountUSD: 116400000,
            from: "Unknown Wallet",
            to: "Binance",
          },
        ];

        let activeCharts = {};
        let allMarketData = [];

        const strategies = {
          msrp: {
            name: "Max Sharpe Ratio Portfolio (MSRP)",
            type: "Aggressive",
            description:
              "A speculative strategy aiming to maximize risk-adjusted returns, potentially concentrating on a few high-momentum assets.",
            metrics: {
              "Annualized Return": "325.26%",
              "Annualized Volatility": "0.97",
              "Sharpe Ratio": "3.34",
              "Max Drawdown": "-70.67%",
              "Weekly CVaR (95%)": "-19.42%",
              "Annualized Alpha": "1.5944",
              Beta: "0.4605",
            },
            weights: {
              aave: 0.4032,
              ada: -0.4352,
              bnb: 0.5411,
              bonk: 0.1056,
              btc: -0.2643,
              doge: 0.0702,
              eth: 0.1631,
              kas: 0.4963,
              ldo: -0.2541,
              matic: 0.0708,
              mkr: 0.0173,
              pepe: 0.2437,
              sol: 0.1842,
              tao: 0.1861,
              uni: -0.5279,
            },
            images: {
              dashboard: "https://i.imgur.com/iiiCFC2.png",
              cumulative: "https://i.imgur.com/bgeFGBj.png",
              underwater: "https://i.imgur.com/fPZsRzn.png",
              weekly_returns: "https://i.imgur.com/PGMS5u6.png",
              rolling_vol: "https://i.imgur.com/uRLWuvX.png",
              distribution: "https://i.imgur.com/PKhvBVK.png",
            },
          },
          gmvp: {
            name: "Global Minimum Variance Portfolio (GMVP)",
            type: "Defensive",
            description:
              "A defensive strategy that aims to minimize portfolio volatility, suitable for risk-averse investors.",
            metrics: {
              "Annualized Return": "55.42%",
              "Annualized Volatility": "0.54",
              "Sharpe Ratio": "1.03",
              "Max Drawdown": "-76.57%",
              "Weekly CVaR (95%)": "-15.72%",
              "Annualized Alpha": "0.0532",
              Beta: "0.8116",
            },
            weights: {
              aave: -0.055,
              ada: -0.0664,
              bnb: 0.0446,
              bonk: -0.0248,
              btc: 0.9443,
              doge: -0.0569,
              eth: -0.1504,
              kas: 0.1025,
              ldo: -0.0035,
              matic: 0.0053,
              mkr: 0.125,
              pepe: -0.0235,
              sol: 0.0124,
              tao: 0.0477,
              uni: 0.0988,
            },
            images: {
              dashboard: "https://i.imgur.com/sixBHO1.png",
              cumulative: "https://i.imgur.com/2ll4569.png",
              underwater: "https://i.imgur.com/Qk34f7d.png",
              weekly_returns: "https://i.imgur.com/tQ4e0kJ.png",
              rolling_vol: "https://i.imgur.com/2nhCSBX.png",
              distribution: "https://i.imgur.com/DBZSgf9.png",
            },
          },
          risk_parity: {
            name: "Risk Parity Portfolio",
            type: "Balanced",
            description:
              "Allocates risk exposure equally among assets, rather than capital. Often more stable than equal weight.",
            metrics: {
              "Annualized Return": "111.22%",
              "Annualized Volatility": "0.68",
              "Sharpe Ratio": "1.63",
              "Max Drawdown": "-69.22%",
              "Weekly CVaR (95%)": "-17.97%",
              "Annualized Alpha": "0.4088",
              Beta: "0.8672",
            },
            weights: {
              aave: 0.0692,
              ada: 0.0707,
              bnb: 0.0798,
              bonk: 0.0341,
              btc: 0.1311,
              doge: 0.0449,
              eth: 0.0959,
              kas: 0.0646,
              ldo: 0.0649,
              matic: 0.0571,
              mkr: 0.0796,
              pepe: 0.0322,
              sol: 0.0557,
              tao: 0.0451,
              uni: 0.0749,
            },
            images: {
              dashboard: "https://i.imgur.com/tctOUFY.png",
              cumulative: "https://i.imgur.com/Lw8DPwN.png",
              underwater: "https://i.imgur.com/XD4yAaM.png",
              weekly_returns: "https://i.imgur.com/Qom6bta.png",
              rolling_vol: "https://i.imgur.com/ZR5EJjt.png",
              distribution: "https://i.imgur.com/cnEo41K.png",
            },
          },
          ew: {
            name: "Equal Weighted Portfolio (EW)",
            type: "Balanced",
            description:
              "Allocates capital equally to every asset in the portfolio, the simplest diversification method.",
            metrics: {
              "Annualized Return": "129.45%",
              "Annualized Volatility": "0.71",
              "Sharpe Ratio": "1.83",
              "Max Drawdown": "-65.89%",
              "Weekly CVaR (95%)": "-17.52%",
              "Annualized Alpha": "0.5195",
              Beta: "0.8468",
            },
            weights: {
              aave: 0.0667,
              ada: 0.0667,
              bnb: 0.0667,
              bonk: 0.0667,
              btc: 0.0667,
              doge: 0.0667,
              eth: 0.0667,
              kas: 0.0667,
              ldo: 0.0667,
              matic: 0.0667,
              mkr: 0.0667,
              pepe: 0.0667,
              sol: 0.0667,
              tao: 0.0667,
              uni: 0.0667,
            },
            images: {
              dashboard: "https://i.imgur.com/bLAcHkt.png",
              cumulative: "https://i.imgur.com/zUwhu2h.png",
              underwater: "https://i.imgur.com/8wWgKYz.png",
              weekly_returns: "https://i.imgur.com/zlZqqhL.png",
              rolling_vol: "https://i.imgur.com/B2wMez0.png",
              distribution: "https://i.imgur.com/W0fospK.png",
            },
          },
          ew_top7_momentum: {
            name: "Top-7 Momentum Equal Weighted",
            type: "Momentum",
            description:
              "Selects the top 7 tokens by annual momentum monthly and applies an equal weight.",
            metrics: {
              "Annualized Return": "179.77%",
              "Annualized Volatility": "0.81",
              "Sharpe Ratio": "2.23",
              "Max Drawdown": "-61.92%",
              "Weekly CVaR (95%)": "-16.98%",
              "Annualized Alpha": "0.7492",
              Beta: "0.8892",
            },
            weights: {
              bnb: 0.1429,
              doge: 0.1429,
              eth: 0.1429,
              kas: 0.1429,
              matic: 0.1429,
              pepe: 0.1429,
              sol: 0.1429,
            },
            images: {
              dashboard: "https://i.imgur.com/D66K50B.png",
              cumulative: "https://i.imgur.com/R0vrVam.png",
              underwater: "https://i.imgur.com/WTwxh6A.png",
              weekly_returns: "https://i.imgur.com/GM27lk6.png",
              rolling_vol: "https://i.imgur.com/3Q8VhCD.png",
              distribution: "https://i.imgur.com/iT5xT6R.png",
            },
          },
          max_diversification: {
            name: "Max Diversification Portfolio",
            type: "Balanced",
            description:
              "Constructs a portfolio by minimizing the correlation between assets, aiming for optimal risk dispersion.",
            metrics: {
              "Annualized Return": "111.22%",
              "Annualized Volatility": "0.68",
              "Sharpe Ratio": "1.63",
              "Max Drawdown": "-69.22%",
              "Weekly CVaR (95%)": "-17.97%",
              "Annualized Alpha": "0.4088",
              Beta: "0.8672",
            },
            weights: {
              aave: 0.1481,
              ada: -0.0723,
              bnb: 0.1396,
              bonk: 0.1356,
              btc: -0.0319,
              doge: 0.1024,
              eth: -0.1908,
              kas: 0.1784,
              ldo: 0.1204,
              matic: 0.0499,
              mkr: 0.1415,
              pepe: 0.1779,
              sol: 0.0103,
              tao: 0.1808,
              uni: -0.09,
            },
            images: {
              dashboard: "https://i.imgur.com/SZl9vHl.png",
              cumulative: "https://i.imgur.com/UgYMcbd.png",
              underwater: "https://i.imgur.com/5tOocZf.png",
              weekly_returns: "https://i.imgur.com/id0NfwN.png",
              rolling_vol: "https://i.imgur.com/lPbSyDc.png",
              distribution: "https://i.imgur.com/4ykyjyG.png",
            },
          },
          sentiment_tilted: {
            name: "Dynamic Sentiment-Tilted Strategy (0.3)",
            type: "Dynamic",
            description:
              "Combines market sentiment and momentum factors to dynamically adjust exposure to the Top-5 assets.",
            metrics: {
              "Annualized Return": "191.07%",
              "Annualized Volatility": "0.86",
              "Sharpe Ratio": "2.23",
              "Max Drawdown": "-64.67%",
              "Weekly CVaR (95%)": "-17.65%",
              "Annualized Alpha": "0.8038",
              Beta: "0.9329",
            },
            weights: {
              bnb: 0.0651,
              doge: 0.045,
              kas: 0.2414,
              pepe: 0.5599,
              sol: 0.0886,
            },
            images: {
              dashboard: "https://i.imgur.com/CGnpdIV.png",
              cumulative: "https://i.imgur.com/1350Cee.png",
              underwater: "https://i.imgur.com/9B7yZUU.png",
              weekly_returns: "https://i.imgur.com/Rit8g2r.png",
              rolling_vol: "https://i.imgur.com/i0bwkn4.png",
              distribution: "https://i.imgur.com/Rcr3hDT.png",
            },
          },
        };

        // This is a simplified representation of the full historical data.
        // In a real application, you would parse the full CSV.
        const historicalReturns = {
          msrp: [0.1346, 0.2016, 0.0019], // Example data points
          gmvp: [0.0282, 0.0331, -0.0033],
          risk_parity: [0.0653, 0.077, -0.0164],
          ew: [0.0539, 0.0915, -0.0209],
          ew_top7_momentum: [0.0916, 0.1729, -0.0246],
          max_diversification: [-0.0022, 0.0494, -0.02],
          sentiment_tilted: [0.0, 0.0, 0.0], // Starts later
        };

        const comparisonImages = {
          risk_return: "https://i.imgur.com/07pXIDX.png",
          correlation: "https://i.imgur.com/bDPCaWh.png",
          sharpe: "https://i.imgur.com/eew113B.png",
          drawdown: "https://i.imgur.com/E31cgyJ.png",
          weekly_returns_distribution: "https://i.imgur.com/Qqb3bwJ.png",
          alpha: "https://i.imgur.com/4hgdqrA.png",
        };

        // --- TRANSLATION ---
        const translations = {
          zh: {
            // Header
            "Connect Wallet": "è¿æ¥é’±åŒ…",
            "Client": "å®¢æˆ·",
            "Total Assets": "æ€»èµ„äº§",
            
            // Portfolio
            "Portfolio Summary": "æ™ºèƒ½æŠ•èµ„ç»„åˆæ¦‚è§ˆ",
            "Today's P&L": "ä»Šæ—¥ç›ˆäº",
            "24h Volume": "24å°æ—¶äº¤æ˜“é‡",
            "Dominant Asset": "ä¸»å¯¼èµ„äº§",
            "Holdings": "æŒä»“",
            "Assets": "èµ„äº§",
            
            // Strategy
            "Strategy Screener": "ç­–ç•¥ç­›é€‰å™¨",
            "Filter your strategies based on your risk profile.": "æ ¹æ®æ‚¨çš„é£é™©åå¥½ç­›é€‰ç­–ç•¥ã€‚",
            "Conservative": "ä¿å®ˆå‹",
            "Balanced": "å¹³è¡¡å‹",
            "Aggressive": "ç§¯æå‹",
            "My Strategy Library": "ç³»ç»Ÿæ¨èçš„æŠ•èµ„ç­–ç•¥",
            "Sentiment Overlay": "æƒ…ç»ªå åŠ ",
            "Compare": "æ¯”è¾ƒ",
            
            // Market Intelligence
            "Market Intelligence": "æ™ºèƒ½æƒ…ç»ªåˆ†æä¸å¸‚åœºæƒ…æŠ¥",
            "Key Events": "å…³é”®äº‹ä»¶",
            "Market Movers": "å¸‚åœºå¼‚åŠ¨",
            "Whale Watch": "å·¨é²¸ç›‘æ§",
            
            // Comparison
            "Strategy Comparison Dashboard": "ç­–ç•¥æ¯”è¾ƒä»ªè¡¨æ¿",
            "Hide Comparison": "éšè—æ¯”è¾ƒ",
            "Show Comparison": "æ˜¾ç¤ºæ¯”è¾ƒ",
            "Overview": "æ¦‚è§ˆ",
            "Performance": "è¡¨ç°",
            "Risk Analysis": "é£é™©åˆ†æ",
            "Risk vs. Return Profile": "é£é™©-æ”¶ç›Šåˆ†æ",
            "Strategy Correlation Heatmap": "ç­–ç•¥ç›¸å…³æ€§çƒ­åŠ›å›¾",
            "Sharpe Ratio Comparison": "å¤æ™®æ¯”ç‡æ¯”è¾ƒ",
            "Alpha vs BTC Comparison": "Alpha vs BTC æ¯”è¾ƒ",
            "Weekly Returns Distribution": "å‘¨æ”¶ç›Šåˆ†å¸ƒ",
            "Max Drawdown Comparison": "æœ€å¤§å›æ’¤æ¯”è¾ƒ",
            
            // Common
            "Close": "å…³é—­",
            "Show": "æ˜¾ç¤º",
            "Hide": "éšè—",
            "Client": "å®¢æˆ·",
            "Strategy Introduction": "ç­–ç•¥ä»‹ç»",
            "Generating introduction...": "æ­£åœ¨ç”Ÿæˆä»‹ç»...",
            "View Gallery": "æŸ¥çœ‹å›¾åº“",
            "Cash / Cash Equivalents (%)": "ç°é‡‘/ç°é‡‘ç­‰ä»·ç‰© (%)",
            "Stocks (%)": "è‚¡ç¥¨ (%)",
            "Fixed Income / Bonds (%)": "å›ºå®šæ”¶ç›Š/å€ºåˆ¸ (%)",
            "Cryptocurrency (%)": "åŠ å¯†è´§å¸ (%)",
            "Risk Tolerance": "é£é™©æ‰¿å—èƒ½åŠ›",
            "Investment Horizon": "æŠ•èµ„æœŸé™",
            "Total Assets (USD)": "æ€»èµ„äº§ (USD)",
            "Generate Recommendation": "ç”Ÿæˆæ¨è",
            "Analyzing your portfolio...": "æ­£åœ¨åˆ†ææ‚¨çš„æŠ•èµ„ç»„åˆ...",
            "Risk Warning": "é£é™©æç¤º",
            "Cash": "ç°é‡‘",
            "Bonds": "å€ºåˆ¸",
            "Crypto": "åŠ å¯†è´§å¸",
            "View Strategy": "æŸ¥çœ‹ç­–ç•¥",
            "1 Year": "1å¹´",
            "3 Years": "3å¹´",
            "5 Years": "5å¹´",
            "Expected Return": "é¢„æœŸå›æŠ¥",
            "1 Years": "1å¹´",
            "10+ Years": "10å¹´ä»¥ä¸Š",
            "Reset": "é‡ç½®",

            // New modules - Asset Allocation
            "Asset Allocation": "èµ„äº§é…ç½®",
            "BTC": "æ¯”ç‰¹å¸",
            "ETH": "ä»¥å¤ªåŠ",
            "SOL": "ç´¢æ‹‰çº³",
            "DOGE": "ç‹—ç‹—å¸",
            "MATIC": "é©¬è¹„å¸",
            "Others": "å…¶ä»–",

            // Performance Metrics
            "Performance Metrics": "ä¸šç»©æŒ‡æ ‡",
            "YTD Return": "å¹´åˆè‡³ä»Šå›æŠ¥",
            "Best Performer": "æœ€ä½³è¡¨ç°",
            "Worst Performer": "æœ€å·®è¡¨ç°",
            "Win Rate": "èƒœç‡",

            // Quick Actions
            "Quick Actions": "å¿«æ·æ“ä½œ",
            "Rebalance": "å†å¹³è¡¡",
            "Analytics": "åˆ†æ",
            "Export": "å¯¼å‡º",
            "Alerts": "æé†’",

            // Risk Monitor
            "Risk Monitor": "é£é™©ç›‘æ§",
            "Portfolio Beta": "ç»„åˆè´å¡”",
            "Diversification Score": "åˆ†æ•£åº¦è¯„åˆ†",
            "Liquidity Risk": "æµåŠ¨æ€§é£é™©",
            "Low": "ä½",
            "Medium": "ä¸­",
            "High": "é«˜",

            // Strategy Performance
            "Strategy Performance": "ç­–ç•¥è¡¨ç°",

            // Market Conditions
            "Market Conditions": "å¸‚åœºçŠ¶å†µ",
            "Market Trend": "å¸‚åœºè¶‹åŠ¿",
            "Bullish": "çœ‹æ¶¨",
            "Bearish": "çœ‹è·Œ",
            "Neutral": "ä¸­æ€§",
            "Volatility": "æ³¢åŠ¨æ€§",
            "Fear & Greed": "ææƒ§ä¸è´ªå©ª",
            "Bitcoin Dominance": "æ¯”ç‰¹å¸ä¸»å¯¼ç‡",

            // Deep Dive Analytics
            "Deep Dive Analytics": "æ·±åº¦åˆ†æ",
            "Deep dive": "æ·±åº¦åˆ†æ",
            "Strategy & Portfolio Analytics": "ç­–ç•¥ä¸æŠ•èµ„ç»„åˆåˆ†æ",
            "Advanced Analytics": "é«˜çº§åˆ†æ",
            "Analytics": "åˆ†æ",
            "Asset Correlation Matrix": "èµ„äº§ç›¸å…³æ€§çŸ©é˜µ",
            "Max Drawdown": "æœ€å¤§å›æ’¤",
            "Rolling Sharpe Ratio": "æ»šåŠ¨å¤æ™®æ¯”ç‡",
            "60-day rolling window": "60æ—¥æ»šåŠ¨çª—å£",
            "Last 90 Days": "è¿‡å»90å¤©",
            "Smart Allocation Center": "æ™ºèƒ½é…ç½®ä¸­å¿ƒ",
            "Risk / Return Quadrant": "é£é™©/æ”¶ç›Šè±¡é™",
            "Portfolio vs Benchmark": "æŠ•èµ„ç»„åˆ vs åŸºå‡†",
            "Strategy Risk Buckets": "ç­–ç•¥é£é™©åˆ†çº§",
            "Rolling 30-day": "æ»šåŠ¨30å¤©",
            "Peak to trough": "å³°å€¼åˆ°è°·åº•",

            // Market Intelligence Section
            "Market context": "å¸‚åœºèƒŒæ™¯",
            "Market Sentiment": "å¸‚åœºæƒ…ç»ª",
            "Market Briefing": "å¸‚åœºç®€æŠ¥",
            "Capital Flows": "èµ„æœ¬æµåŠ¨",
            "Last 90 minutes": "è¿‡å»90åˆ†é’Ÿ",
            "Greed": "è´ªå©ª",
            "Fear": "ææƒ§",
            "Extreme Greed": "æåº¦è´ªå©ª",
            "Extreme Fear": "æåº¦ææƒ§",

            // Research Report
            "New Research": "æ–°ç ”ç©¶",
            "Cryptocurrency Investment Strategy Research Report": "é«˜é£é™©äº§å“æŠ•èµ„ç­–ç•¥ç ”ç©¶æŠ¥å‘Š",
            "Comprehensive 50-page analysis covering market trends, portfolio optimization, risk management, and strategic recommendations for cryptocurrency investment.": "å…¨é¢çš„50é¡µåˆ†ææŠ¥å‘Šï¼Œæ¶µç›–å¸‚åœºè¶‹åŠ¿ã€æŠ•èµ„ç»„åˆä¼˜åŒ–ã€é£é™©ç®¡ç†ä»¥åŠåŠ å¯†è´§å¸æŠ•èµ„çš„æˆ˜ç•¥å»ºè®®ã€‚",
            "Report Highlights": "æŠ¥å‘Šäº®ç‚¹",
            "15+ Investment Strategies Analyzed": "15+ æŠ•èµ„ç­–ç•¥åˆ†æ",
            "Market Sentiment Analysis": "å¸‚åœºæƒ…ç»ªåˆ†æ",
            "Risk Management Framework": "é£é™©ç®¡ç†æ¡†æ¶",
            "Portfolio Optimization Models": "æŠ•èµ„ç»„åˆä¼˜åŒ–æ¨¡å‹",
            "Download Report (PDF)": "ä¸‹è½½æŠ¥å‘Š (PDF)",
            "View Online": "åœ¨çº¿æŸ¥çœ‹",
            "Pages": "é¡µ",
            "Strategies": "ç­–ç•¥",
            "Avg. Return": "å¹³å‡å›æŠ¥",
            "Latest": "æœ€æ–°",

            // Smart Assistant
            "Smart assistant": "æ™ºèƒ½åŠ©æ‰‹",
            "On-demand strategy insights": "éšæ—¶è·å–ç­–ç•¥è§è§£",
            "Refresh": "åˆ·æ–°",

            // Portfolio Health Section
            "Diagnostics": "è¯Šæ–­",
            "Portfolio Health Score": "æŠ•èµ„ç»„åˆå¥åº·è¯„åˆ†",
            "Excellent": "ä¼˜ç§€",
            "Good": "è‰¯å¥½",
            "Fair": "ä¸€èˆ¬",
            "Poor": "è¾ƒå·®",
            "Healthy": "å¥åº·",

            // Common UI Elements
            "Current breakdown": "å½“å‰ç»†åˆ†",
            "Avg Return": "å¹³å‡å›æŠ¥",
            "Avg Sharpe": "å¹³å‡å¤æ™®",
            "Best": "æœ€ä½³",
            "Liquidity": "æµåŠ¨æ€§",
            "Trend": "è¶‹åŠ¿",
            "Bullish": "çœ‹æ¶¨",
            "Sentiment leans optimistic; risk assets tend to outperform while spreads compress.": "å¸‚åœºæƒ…ç»ªåå‘ä¹è§‚ï¼›é£é™©èµ„äº§è¡¨ç°å¾€å¾€ä¼˜äºå¤§ç›˜ï¼Œåˆ©å·®æ”¶çª„ã€‚",
            "Enable sentiment overlay to highlight strategies that perform well in current market conditions. Strategies with a purple glow are best suited for the current Fear & Greed sentiment.": "å¯ç”¨æƒ…ç»ªå åŠ åŠŸèƒ½ï¼Œç³»ç»Ÿå°†æ ¹æ®å½“å‰å¸‚åœºæƒ…ç»ªï¼ˆææƒ§ä¸è´ªå©ªæŒ‡æ•°ï¼‰é«˜äº®æ˜¾ç¤ºè¡¨ç°ä¼˜å¼‚çš„ç­–ç•¥ã€‚å¸¦æœ‰ç´«è‰²å…‰æ™•çš„ç­–ç•¥æœ€é€‚åˆå½“å‰å¸‚åœºç¯å¢ƒã€‚",
            "Click on any strategy card to view detailed analysis, performance metrics, and personalized recommendations.": "ç‚¹å‡»ä»»æ„ç­–ç•¥å¡ç‰‡æŸ¥çœ‹è¯¦ç»†åˆ†æã€ä¸šç»©æŒ‡æ ‡å’Œä¸ªæ€§åŒ–å»ºè®®ã€‚",
          },
          en: {
            "Portfolio Summary": "Intelligent Portfolio Overview",
            "My Strategy Library": "Tech-Driven Strategy Hub",
            "Market Intelligence": "Intelligent Sentiment & Market Watch",
            "Risk Warning": "Risk Reminder",
            "Generate Recommendation": "Get Recommendation",
            "Reset": "Reset",
          }
        };
        
        let currentLanguage = localStorage.getItem("language") || "en";
        
        function t(key) {
          if (currentLanguage === "zh" && translations.zh[key]) {
            return translations.zh[key];
          }
          return key;
        }
        
        function updateLanguage() {
          currentLanguage = currentLanguage === "zh" ? "en" : "zh";
          localStorage.setItem("language", currentLanguage);
          updateLanguageUI();
          // Update dynamic content
          populatePortfolioSummary();
          populateStrategyScreener();
          populateHoldings(
            allMarketData.filter((d) => userHoldingsSymbols.includes(d.symbol))
          );

          // Update charts with translated labels
          createAllocationDonutChart();
          createStrategyPerformanceChart();
          
          // Update strategy introduction if modal is open
          const strategyModal = document.getElementById("strategyDetailModal");
          if (strategyModal && !strategyModal.classList.contains("hidden")) {
            const strategyContent = document.getElementById("strategyDetailContent");
            if (strategyContent) {
              // Find the current strategy ID from the modal
              const strategyName = strategyContent.querySelector("h2")?.textContent;
              if (strategyName) {
                // Find strategy ID from name
                const strategyId = Object.keys(strategies).find(id => strategies[id].name === strategyName);
                if (strategyId) {
                  // Regenerate introduction with new language
                  const introContent = document.getElementById("strategy-intro-content");
                  const loadingDiv = document.getElementById("strategy-intro-loading");
                  if (introContent) {
                    loadingDiv?.classList.remove("hidden");
                    introContent.classList.add("hidden");
                    generateStrategyIntroduction(strategies[strategyId], strategyId).then(intro => {
                      introContent.innerHTML = intro;
                      loadingDiv?.classList.add("hidden");
                      introContent.classList.remove("hidden");
                    });
                  }
                }
              }
            }
          }
        }

        // --- INITIALIZATION ---
        function init() {
          // Set default theme to warm sand if not set
          const savedTheme = localStorage.getItem("theme") || "sand";
          document.body.classList.remove("light-theme", "dark-theme", "sand-theme");
          if (savedTheme === "dark") {
            document.body.classList.add("dark-theme");
          } else if (savedTheme === "sand") {
            document.body.classList.add("sand-theme");
          } else {
            document.body.classList.add("light-theme");
          }
          
          if (localStorage.getItem("colorblind") === "true")
            document.body.classList.add("colorblind-mode");
          
          updateThemeIcon();
          updateLanguageUI();

          loadStaticData();
          populatePortfolioSummary();
          populateStrategyScreener();
          populateStrategyList();
          renderMarketSentimentCard();
          renderMarketNewsCard();
          renderWhaleFlows();
          renderStrategyRiskDistribution();
          createQuadrantChart();
          createPortfolioVsBenchmarkChart();
          createCorrelationMatrix();
          createDrawdownChart();
          createRollingSharpeChart();
          createAllocationDonutChart();
          createStrategyPerformanceChart();
          initHeroSection();
          initSystemStatusTicker();
          setupEventListeners();

          // Simulate real-time price updates
          setInterval(updatePrices, 3000);
        }
        
        function updateLanguageUI() {
          const languageText = document.getElementById("language-text");
          if (languageText) {
            languageText.textContent = currentLanguage === "zh" ? "ä¸­æ–‡" : "English";
          }
          
          // Update all elements with data-translate attribute
          document.querySelectorAll("[data-translate]").forEach((element) => {
            const key = element.getAttribute("data-translate");
            if (key) {
              const translated = t(key);
              if (translated !== key) {
                // Handle different element types
                if (element.tagName === "INPUT" && element.type === "button") {
                  element.value = translated;
                } else if (element.tagName === "BUTTON" || element.tagName === "SPAN" || element.tagName === "H2" || element.tagName === "H3") {
                  element.textContent = translated;
                } else {
                  element.textContent = translated;
                }
              }
            }
          });
          
          // Update toggle comparison button text
          const toggleBtn = document.getElementById("toggleComparisonBtn");
          if (toggleBtn) {
            const analyticsContent = document.getElementById("advanced-analytics-content");
            const isHidden = analyticsContent?.classList.contains("hidden");
            const toggleText = toggleBtn.querySelector(".toggle-text");
            if (toggleText) {
              toggleText.textContent = isHidden ? t("Show") : t("Hide");
            }
          }
        }

        // --- DATA HANDLING & UPDATES ---
        function loadStaticData() {
          allMarketData = staticMarketData.Data.map((d) => ({
            symbol: d.CoinInfo.Name,
            name: d.CoinInfo.FullName,
            imageUrl: `https://www.cryptocompare.com${d.CoinInfo.ImageUrl}`,
            price: d.RAW.USD.PRICE,
            change: d.RAW.USD.CHANGEPCT24HOUR,
            volume: d.RAW.USD.VOLUME24HOURTO,
            marketCap: d.RAW.USD.MKTCAP,
            history: Array.from(
              { length: 30 },
              () => d.RAW.USD.PRICE * (1 + (Math.random() - 0.5) * 0.1)
            ),
          }));

          const userHoldingsData = allMarketData.filter((d) =>
            userHoldingsSymbols.includes(d.symbol)
          );
          populateHoldings(userHoldingsData);
        }

        /**
         * Update prices with simulated real-time changes
         */
        function updatePrices() {
          try {
          allMarketData.forEach((asset) => {
              if (!asset || !asset.price) return;
              
            const changeFactor = (Math.random() - 0.49) * 0.01; // Small random change
            const oldPrice = asset.price;
            asset.price *= 1 + changeFactor;
              asset.change = (asset.change || 0) + changeFactor * 100;
              
              // Maintain history array
              if (!asset.history) asset.history = [];
            asset.history.push(asset.price);
              if (asset.history.length > 30) {
            asset.history.shift();
              }

            const priceEl = document.getElementById(`price-${asset.symbol}`);
            const changeEl = document.getElementById(`change-${asset.symbol}`);

            if (priceEl) {
              priceEl.textContent = formatPrice(asset.price);
                
                // Visual feedback for price changes
              priceEl.classList.toggle("text-gain", asset.price > oldPrice);
              priceEl.classList.toggle("text-loss", asset.price < oldPrice);
                
                // Add animation class
                priceEl.classList.add("transition-colors", "duration-300");
                
              setTimeout(() => {
                priceEl.classList.remove("text-gain", "text-loss");
              }, 500);
            }
              
            if (changeEl) {
              const isPositive = asset.change >= 0;
                changeEl.textContent = `${isPositive ? "+" : ""}${asset.change.toFixed(2)}%`;
              changeEl.className = `font-mono text-sm ${
                isPositive ? "text-gain" : "text-loss"
              }`;
            }
            assetMeta.set(asset.symbol, asset);
          });
          
          const holdingsData = allMarketData.filter((d) =>
            userHoldingsSymbols.includes(d.symbol)
          );
          renderAssetSparklines(holdingsData);
          } catch (error) {
            console.error("Error updating prices:", error);
          }
        }

        // --- UI POPULATION ---
        function populatePortfolioSummary() {
          const container = document.getElementById("portfolioSummary");
          const todayPL = 5678.88;
          const isPositive = todayPL >= 0;

          container.innerHTML = `
            <h2 class="text-lg font-semibold mb-3">${t("Portfolio Summary")}</h2>
            <div class="space-y-3">
                <div class="flex justify-between items-baseline">
                    <span class="text-secondary">${t("Today's P&L")}</span>
                    <span class="font-mono text-xl ${
                      isPositive ? "text-gain" : "text-loss"
                    }">${isPositive ? "+" : ""}${formatPrice(todayPL)}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-secondary">${t("24h Volume")}</span>
                    <span class="font-mono">$2,450,123.78</span>
                </div>
                 <div class="flex justify-between text-sm">
                    <span class="text-secondary">${t("Dominant Asset")}</span>
                    <span class="font-semibold">BTC (45.2%)</span>
                </div>
            </div>
            <div class="h-24 mt-4"><canvas id="portfolio-chart"></canvas></div>
        `;
          createPortfolioChart("portfolio-chart");
        }

        function populateHoldings(data) {
          const container = document.getElementById("holdingsContainer");
          const assetCountEl = document.getElementById("assetCount");
          if (!container) return;
          if (assetCountEl) {
            const assetLabel = currentLanguage === "zh" ? t("Assets") : "Assets";
            assetCountEl.textContent = `${data.length} ${assetLabel}`;
          }

          assetMeta.clear();
          const holdingsWithAllocation = data.map((asset) => {
            const allocationUsd =
              userPortfolioProfile[asset.symbol]?.allocationUsd ?? portfolioFallbackAllocation;
            return { ...asset, allocationUsd };
          });
          const totalAllocation =
            holdingsWithAllocation.reduce((sum, asset) => sum + asset.allocationUsd, 0) || 1;

          container.innerHTML = holdingsWithAllocation
            .map((asset) => {
              const isPositive = (asset.change || 0) >= 0;
              const changeColorClass = isPositive ? "text-gain" : "text-loss";
              const portfolioWeight = (asset.allocationUsd / totalAllocation) * 100;
              const enrichedAsset = {
                ...asset,
                allocationPercent: portfolioWeight,
              };
              assetMeta.set(asset.symbol, enrichedAsset);
              return `
            <div class="holding-row p-3 rounded-2xl">
              <div class="holding-meta">
                    <div class="asset-icon-shell">
                        <img src="${asset.imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/40x40/161b22/c9d1d9?text=${asset.symbol.substring(
                0,
                2
              )}';" class="asset-icon w-10 h-10 rounded-full" alt="${asset.symbol} logo">
                    </div>
                    <div>
                        <div class="font-semibold">${asset.symbol}</div>
                        <div class="text-xs text-secondary">${asset.name}</div>
                  <p class="holding-last-price">Last price Â· ${formatPrice(asset.price)}</p>
                    </div>
                </div>
              <div class="holding-stats">
                <div>
                  <p class="holding-stat-label">Market value</p>
                  <p class="holding-stat-value">${formatPrice(asset.allocationUsd)}</p>
                </div>
                <div>
                  <p class="holding-stat-label">Portfolio</p>
                  <p class="holding-stat-value">${portfolioWeight.toFixed(1)}%</p>
                </div>
                <div>
                  <p class="holding-stat-label">24h</p>
                  <p class="holding-stat-value ${changeColorClass}">${
                isPositive ? "+" : ""
                  }${(asset.change || 0).toFixed(2)}%</p>
                </div>
                <canvas class="holding-sparkline" data-symbol="${asset.symbol}" width="140" height="34"></canvas>
            </div>
            </div>`;
            })
            .join("");

          renderAssetSparklines(holdingsWithAllocation);
          renderHealthScoreCard(holdingsWithAllocation);
        }

        function renderAssetSparklines(assets) {
          requestAnimationFrame(() => {
            const dpr = window.devicePixelRatio || 1;
            assets.forEach((asset) => {
              const canvas = document.querySelector(
                `.holding-sparkline[data-symbol="${asset.symbol}"]`
              );
              if (!canvas) return;
              const ctx = canvas.getContext("2d");
              if (!ctx) return;
              const rect = canvas.getBoundingClientRect();
              const cssWidth = Math.max(120, rect.width || canvas.clientWidth || 140);
              const cssHeight =
                rect.height || parseFloat(canvas.getAttribute("height")) || 34;
              const scaledWidth = Math.round(cssWidth * dpr);
              const scaledHeight = Math.round(cssHeight * dpr);
              if (canvas.width !== scaledWidth || canvas.height !== scaledHeight) {
                canvas.width = scaledWidth;
                canvas.height = scaledHeight;
              }
              canvas.style.height = `${cssHeight}px`;
              ctx.setTransform(1, 0, 0, 1, 0, 0);
              ctx.scale(dpr, dpr);
              ctx.imageSmoothingEnabled = false;
              ctx.clearRect(0, 0, cssWidth, cssHeight);
              const points = getSparklinePoints(asset.symbol, asset.price);
              drawSparkline(ctx, points, (asset.change || 0) >= 0, cssWidth, cssHeight);
              bindSparklineTooltip(canvas, asset.symbol);
            });
          });
        }

        function getSparklinePoints(symbol, basePrice = 100) {
          const asset = assetMeta.get(symbol);
          if (asset?.history?.length) {
            const recent = asset.history.slice(-22);
            sparklineCache.set(symbol, recent);
            return recent;
          }
          if (sparklineCache.has(symbol)) return sparklineCache.get(symbol);
          const points = Array.from({ length: 22 }, (_, idx) => {
            const variance = (Math.sin(idx / 2) + Math.random() * 0.5) * 0.015;
            return basePrice * (1 + variance);
          });
          sparklineCache.set(symbol, points);
          return points;
        }

        function drawSparkline(ctx, points, isPositive, width, height) {
          if (!ctx || !points || points.length < 2) return;
          const min = Math.min(...points);
          const max = Math.max(...points);
          const range = max - min || 1;
          const step = width / Math.max(points.length - 1, 1);
          const strokeColor = isPositive
            ? "rgba(63, 185, 80, 0.95)"
            : "rgba(248, 81, 73, 0.95)";
          const gradient = ctx.createLinearGradient(0, 0, 0, height);
          gradient.addColorStop(
            0,
            isPositive ? "rgba(63, 185, 80, 0.28)" : "rgba(248, 81, 73, 0.28)"
          );
          gradient.addColorStop(1, "rgba(10, 14, 23, 0)");

          const valueToY = (value) =>
            height - ((value - min) / range) * height;

          const tracePath = (limitX, shouldFill = false) => {
            const safeLimit = Math.max(0, Math.min(limitX, width));
          ctx.beginPath();
            let prevX = 0;
            let prevY = valueToY(points[0]);
            ctx.moveTo(prevX, prevY);
            for (let idx = 1; idx < points.length; idx++) {
            const x = idx * step;
              const y = valueToY(points[idx]);
              if (x >= safeLimit) {
                const prevPointX = (idx - 1) * step;
                const prevPointY = valueToY(points[idx - 1]);
                const distance = Math.max(x - prevPointX, 0.0001);
                const ratio =
                  safeLimit <= prevPointX ? 0 : (safeLimit - prevPointX) / distance;
                const interpolatedY = prevPointY + (y - prevPointY) * ratio;
                ctx.lineTo(safeLimit, interpolatedY);
                prevX = safeLimit;
                prevY = interpolatedY;
                break;
            } else {
              ctx.lineTo(x, y);
                prevX = x;
                prevY = y;
              }
            }
            if (shouldFill) {
              ctx.lineTo(prevX, height);
              ctx.lineTo(0, height);
              ctx.closePath();
            }
          };

          let animationStart;
          const animate = (timestamp) => {
            if (!animationStart) animationStart = timestamp;
            const elapsed = timestamp - animationStart;
            const progress = Math.min(1, elapsed / SPARKLINE_ANIMATION_DURATION);
            const eased = easeOutCubic(progress);
            const limitX = width * eased;
            ctx.clearRect(0, 0, width, height);

            tracePath(limitX, false);
            ctx.strokeStyle = strokeColor;
            ctx.lineWidth = 1.5;
          ctx.lineJoin = "round";
            ctx.lineCap = "round";
          ctx.stroke();

            tracePath(limitX, true);
            ctx.globalAlpha = 0.18;
          ctx.fillStyle = gradient;
          ctx.fill();
            ctx.globalAlpha = 1;

            if (progress < 1) {
              requestAnimationFrame(animate);
            }
          };

          requestAnimationFrame(animate);
        }

        function renderHealthScoreCard(holdingsData = []) {
          const card = document.getElementById("healthScoreCard");
          if (!card) return;
          const scores = calculateHealthScore(holdingsData);
          card.innerHTML = `
            <div class="health-score-card">
              <div>
                <div class="health-score-card__header">
                  <div>
                    <p class="text-xs uppercase tracking-[0.35em] text-secondary">${t("Diagnostics")}</p>
                    <h2 class="text-xl font-semibold">${t("Portfolio Health Score")}</h2>
                  </div>
                  <span class="health-tag ${scores.tagClass}">${t(scores.band)}</span>
                </div>
                <div class="health-score-ring">
                  <svg viewBox="0 0 200 200" aria-hidden="true" focusable="false">
                    <defs>
                      <linearGradient id="healthScoreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#34d399"></stop>
                        <stop offset="100%" stop-color="#0ea5e9"></stop>
                      </linearGradient>
                    </defs>
                    <circle class="health-ring-bg" cx="100" cy="100" r="90"></circle>
                    <circle class="health-ring-value" cx="100" cy="100" r="90"></circle>
                  </svg>
                  <div class="health-score-ring__value">
                    <span class="health-score-value" id="healthScoreValue">${scores.score}</span>
                    <span class="health-score-label">/100</span>
                  </div>
                </div>
              </div>
              <div>
                <ul class="health-score-breakdown">
                  ${scores.breakdown
                    .map(
                      (item) => `
                    <li data-score-item="${item.key}" tabindex="0">
                      <div class="label">${item.label}</div>
                      <div class="bar">
                        <span class="bar-fill" data-score-key="${item.key}"></span>
                      </div>
                      <span class="value text-sm font-semibold" id="score-${item.key}">${item.value}</span>
                    </li>`
                    )
                    .join("")}
                </ul>
                <p class="text-xs text-secondary mt-4">
                  System score blends diversification, realised volatility, and current market regime. For reference onlyâ€”the platform never reallocates automatically.
                </p>
              </div>
            </div>
          `;
          
          const circumference = 2 * Math.PI * 90;
          const ring = card.querySelector(".health-ring-value");
          if (ring) {
            ring.style.strokeDasharray = circumference;
            ring.style.strokeDashoffset = circumference - (circumference * scores.score) / 100;
          }
          scores.breakdown.forEach((item) => {
            const bar = card.querySelector(`[data-score-key="${item.key}"]`);
            if (bar) {
              requestAnimationFrame(() => {
                bar.style.width = `${item.value}%`;
              });
            }
            const valueEl = card.querySelector(`#score-${item.key}`);
            if (valueEl) {
              valueEl.textContent = `${item.value}`;
            }
          });
          bindHealthScoreBreakdown(card);
        }

        function calculateHealthScore(holdingsData = []) {
          const totalHoldings = holdingsData.length || 1;
          const highMovers = holdingsData.filter((asset) => Math.abs(asset.change || 0) > 5).length;
          const diversificationScore = Math.min(95, 62 + totalHoldings * 2.5);
          const concentrationPenalty = Math.max(0, 60 - totalHoldings * 4);
          const adjustedDiversification = Math.max(40, diversificationScore - concentrationPenalty);
          const volatilityScore = Math.max(45, 92 - highMovers * 5);
          const sentimentValue = getCurrentSentimentValue();
          const environmentScore = 55 + (sentimentValue - 50) * 0.8;
          const weightedScore =
            adjustedDiversification * 0.4 + volatilityScore * 0.35 + environmentScore * 0.25;
          const overall = Math.max(35, Math.min(95, Math.round(weightedScore)));
          
          let band = "Balanced profile";
          let tagClass = "health-tag--green";
          if (overall < 70 && overall >= 55) {
            band = "Risk elevated";
            tagClass = "health-tag--yellow";
          } else if (overall < 55) {
            band = "High risk";
            tagClass = "health-tag--red";
          }
          
          const diversificationValue = Math.max(30, Math.min(95, Math.round(adjustedDiversification)));
          const volatilityValue = Math.max(30, Math.min(95, Math.round(volatilityScore)));
          const environmentValue = Math.max(30, Math.min(95, Math.round(environmentScore)));
          
          return {
            score: overall,
            band,
            tagClass,
            breakdown: [
              { key: "diversification", label: "Allocation quality", value: diversificationValue },
              { key: "volatility", label: "Volatility control", value: volatilityValue },
              { key: "environment", label: "Market alignment", value: environmentValue }
            ]
          };
        }

        function getCurrentSentimentValue() {
          const card = document.getElementById("marketSentimentCard");
          if (!card) return 55;
          return parseInt(card.dataset.sentimentValue || "55", 10);
        }

        function bindHealthScoreBreakdown(card) {
          if (!card || !chartTooltip) return;
          const items = card.querySelectorAll("[data-score-item]");
          items.forEach((item) => {
            const key = item.getAttribute("data-score-item");
            const insightCopy = healthScoreInsights[key];
            if (!insightCopy) return;
            const positionTooltip = (event) => {
              let clientX = event?.clientX;
              let clientY = event?.clientY;
              if (clientX === undefined || clientY === undefined) {
                const rect = item.getBoundingClientRect();
                clientX = rect.left + rect.width / 2;
                clientY = rect.top + rect.height / 2;
              }
              showChartTooltip(insightCopy, clientX, clientY - 16);
            };
            const handleLeave = () => hideChartTooltip();
            item.addEventListener("mouseenter", positionTooltip);
            item.addEventListener("mousemove", positionTooltip);
            item.addEventListener("mouseleave", handleLeave);
            item.addEventListener("focus", positionTooltip);
            item.addEventListener("blur", handleLeave);
          });
        }

        function renderMarketSentimentCard() {
          const sentiment = getCurrentSentimentValue();
          const arc = document.getElementById("sentimentArc");
          const needle = document.getElementById("sentimentNeedle");
          const valueEl = document.getElementById("sentimentScoreValue");
          const badge = document.getElementById("sentimentBadge");
          const impactCopy = document.getElementById("sentimentImpactCopy");
          const circumference = 282;
          if (arc) {
            arc.style.strokeDasharray = circumference;
            arc.style.strokeDashoffset = circumference - (circumference * sentiment) / 100;
          }
          if (needle) {
            const angle = -90 + (sentiment / 100) * 180;
            needle.style.transform = `translateX(-50%) rotate(${angle}deg)`;
          }
          if (valueEl) valueEl.textContent = sentiment;
          if (badge) {
            let label = "Balanced";
            badge.classList.remove("sentiment-badge--warning", "sentiment-badge--danger");
            if (sentiment >= 70) {
              label = "Greed";
            } else if (sentiment <= 35) {
              label = "Fear";
              badge.classList.add("sentiment-badge--danger");
            } else if (sentiment < 50) {
              label = "Neutral / watch";
              badge.classList.add("sentiment-badge--warning");
            }
            badge.textContent = label;
          }
          if (impactCopy) {
            if (sentiment >= 70) {
              impactCopy.textContent = "Momentum chasing intensifies. Consider trimming high beta exposure.";
            } else if (sentiment <= 35) {
              impactCopy.textContent = "Risk aversion elevated; hedges and cash buffers matter more.";
            } else {
              impactCopy.textContent = "Balanced conditions. Monitor catalysts before adjusting exposure.";
            }
          }
        }

        function renderMarketNewsCard(shuffle = false) {
          const list = document.getElementById("marketNewsList");
          const loadMoreBtn = document.getElementById("loadMoreNews");
          if (!list) return;
          const news = [...staticNewsData.Data];
          if (shuffle) {
            news.sort(() => Math.random() - 0.5);
          }
          const initialCount = 7;
          let renderedCount = initialCount;

          const renderSlice = (count) => {
            const items = news.slice(0, count).map((item) => {
              const published = formatRelativeTime(item.published_on * 1000);
              const source = item.source_info?.name || item.source || "Newswire";
              return `
                <li class="news-item">
                  <p class="news-item__meta">${source} Â· ${published}</p>
                  <a href="${item.url}" target="_blank" rel="noopener" class="news-item__headline news-item__title">
                    ${item.title}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 17L17 7M7 7h10v10"></path>
                    </svg>
                  </a>
                </li>
              `;
            }).join("");
            list.innerHTML = items;
          };

          renderSlice(initialCount);

          if (loadMoreBtn) {
            loadMoreBtn.onclick = () => {
              const additional = 3;
              renderedCount = Math.min(renderedCount + additional, news.length);
              renderSlice(renderedCount);
              if (renderedCount >= news.length) {
                loadMoreBtn.classList.add("hidden");
              }
            };
            loadMoreBtn.classList.toggle("hidden", renderedCount >= news.length);
          }
        }

        function renderWhaleFlows() {
          const list = document.getElementById("whaleFlowList");
          if (!list) return;
          list.innerHTML = staticWhaleData.slice(0, 4).map((flow) => {
            const direction = flow.type === "DEPOSIT" ? "On-exchange" : "Off-exchange";
            const amountUsd = formatCompactCurrency(flow.amountUSD);
            const timeAgo = formatRelativeTime(flow.timestamp);
            return `
              <li class="whale-flow-row">
                <div>
                  <strong>${flow.symbol}</strong>
                  <span>${direction}</span>
                  <p class="text-sm mt-1">${flow.amountCrypto.toLocaleString()} ${flow.symbol} (${amountUsd})</p>
                </div>
                <div class="text-right text-xs text-secondary">
                  <p>${flow.from} â†’ ${flow.to}</p>
                  <p>${timeAgo}</p>
                </div>
              </li>
            `;
          }).join("");
        }

        function formatRelativeTime(timestamp) {
          const diff = Date.now() - timestamp;
          const minutes = Math.round(diff / 60000);
          if (minutes < 1) return "just now";
          if (minutes < 60) return `${minutes}m ago`;
          const hours = Math.round(minutes / 60);
          if (hours < 24) return `${hours}h ago`;
          const days = Math.round(hours / 24);
          return `${days}d ago`;
        }

        function formatCompactCurrency(value) {
          if (value >= 1_000_000_000) return `$${(value / 1_000_000_000).toFixed(1)}B`;
          if (value >= 1_000_000) return `$${(value / 1_000_000).toFixed(1)}M`;
          if (value >= 1_000) return `$${(value / 1_000).toFixed(1)}K`;
          return `$${value.toFixed(0)}`;
        }

        function initHeroSection() {
          const generateBtn = document.getElementById("heroGeneratePlanBtn");
          generateBtn?.addEventListener("click", () => {
            document.getElementById("portfolioAIAgentSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
          });
          const sampleBtn = document.getElementById("heroSamplePortfolioBtn");
          sampleBtn?.addEventListener("click", () => {
            document.getElementById("strategyOutput")?.scrollIntoView({ behavior: "smooth", block: "start" });
          });
          createHeroPerformanceChart();
        }

        function createHeroPerformanceChart() {
          const ctx = document.getElementById("heroPerformanceChart");
          if (!ctx || !window.Chart) return;
          if (activeCharts.heroPerformance) {
            activeCharts.heroPerformance.destroy();
          }
          const labels = Array.from({ length: 12 }, (_, idx) => `Week ${idx + 1}`);
          const base = 100;
          const data = labels.map((_, idx) => base + Math.sin(idx / 2.3) * 6 + idx * 1.4);
          activeCharts.heroPerformance = new Chart(ctx, {
            type: "line",
            data: {
              labels,
              datasets: [
                {
                  label: "Multi-asset stack",
                  data,
                  borderColor: "rgba(56, 139, 253, 1)",
                  backgroundColor: "rgba(56, 139, 253, 0.15)",
                  borderWidth: 2,
                  tension: 0.4,
                  fill: true,
                },
              ],
            },
            options: {
              plugins: { legend: { display: false }, tooltip: { enabled: true } },
              scales: {
                x: { grid: { display: false }, ticks: { color: "var(--text-secondary)" } },
                y: { grid: { color: "rgba(0,0,0,0.08)" }, ticks: { color: "var(--text-secondary)" } },
              },
              animation: { duration: 500 },
              responsive: true,
              maintainAspectRatio: false,
            },
          });
        }

        function renderStrategyRiskDistribution() {
          const container = document.getElementById("strategyRiskDistribution");
          if (!container) return;
          const strategyEntries = Object.values(strategies).slice(0, 5).map((strategy) => {
            const vol = parseFloat(strategy.metrics["Annualized Volatility"]) || Math.random() * 0.8;
            return {
              name: strategy.name,
              value: Math.min(100, Math.round(vol * 100)),
            };
          });
          container.innerHTML = strategyEntries
            .map(
              (item) => `
            <div class="strategy-risk-row">
              <span class="strategy-risk-label">${item.name}</span>
              <div class="strategy-risk-bar"><span style="width:${item.value}%"></span></div>
              <span class="strategy-risk-value">${item.value}%</span>
            </div>
          `
            )
            .join("");
        }

        function createQuadrantChart() {
          const canvas = document.getElementById("quadrantChart");
          if (!canvas || !window.Chart) return;
          if (activeCharts.quadrantChart) {
            activeCharts.quadrantChart.destroy();
          }
          const dataset = Object.values(strategies).slice(0, 6).map((strategy) => {
            const ret = parseFloat(strategy.metrics["Annualized Return"]) || Math.random() * 200;
            const vol = parseFloat(strategy.metrics["Annualized Volatility"]) || Math.random();
            return {
              x: vol * 100,
              y: ret,
              r: Math.max(8, Math.min(20, ret / 20)),
              label: strategy.name,
            };
          });
          activeCharts.quadrantChart = new Chart(canvas, {
            type: "bubble",
            data: {
              datasets: dataset.map((point) => ({
                label: point.label,
                data: [{ x: point.x, y: point.y, r: point.r }],
                backgroundColor: "rgba(56, 139, 253, 0.25)",
                borderColor: "rgba(56, 139, 253, 1)",
                borderWidth: 1.5,
              })),
            },
            options: {
              plugins: { legend: { display: false }, tooltip: { enabled: true } },
              scales: {
                x: {
                  title: { display: true, text: "Volatility %" },
                  grid: { color: "rgba(0,0,0,0.08)" },
                },
                y: {
                  title: { display: true, text: "Annualised Return %" },
                  grid: { color: "rgba(0,0,0,0.08)" },
                },
              },
            },
          });
        }

        function createPortfolioVsBenchmarkChart() {
          const canvas = document.getElementById("portfolioVsBenchmarkChart");
          if (!canvas || !window.Chart) return;
          if (activeCharts.portfolioBenchmark) {
            activeCharts.portfolioBenchmark.destroy();
          }
          const labels = Array.from({ length: 12 }, (_, idx) => `M${idx + 1}`);
          const portfolio = labels.map((_, idx) => 100 + idx * 4 + Math.sin(idx / 2) * 3);
          const benchmark = labels.map((_, idx) => 100 + idx * 3 + Math.sin(idx / 1.8) * 2);
          activeCharts.portfolioBenchmark = new Chart(canvas, {
            type: "line",
            data: {
              labels,
              datasets: [
                {
                  label: "Configured portfolio",
                  data: portfolio,
                  borderColor: "rgba(56, 139, 253, 1)",
                  backgroundColor: "rgba(56, 139, 253, 0.1)",
                  borderWidth: 2,
                  tension: 0.35,
                  fill: true,
                },
                {
                  label: "BTC benchmark",
                  data: benchmark,
                  borderColor: "rgba(15, 23, 42, 0.6)",
                  borderDash: [6, 6],
                  borderWidth: 2,
                  fill: false,
                  tension: 0.35,
                },
              ],
            },
            options: {
              plugins: { legend: { display: true }, tooltip: { enabled: true } },
              scales: {
                x: { grid: { display: false } },
                y: { grid: { color: "rgba(0,0,0,0.08)" } },
              },
            },
          });
        }

        // New: Correlation Matrix Heatmap
        function createCorrelationMatrix() {
          const container = document.getElementById("correlationMatrix");
          if (!container) return;

          const assets = ["BTC", "ETH", "SOL", "DOGE", "MATIC"];
          const correlations = [
            [1.00, 0.85, 0.72, 0.68, 0.75],
            [0.85, 1.00, 0.78, 0.65, 0.82],
            [0.72, 0.78, 1.00, 0.58, 0.71],
            [0.68, 0.65, 0.58, 1.00, 0.62],
            [0.75, 0.82, 0.71, 0.62, 1.00]
          ];

          const getColor = (value) => {
            if (value > 0.8) return "rgba(239, 68, 68, 0.8)";
            if (value > 0.6) return "rgba(251, 146, 60, 0.7)";
            if (value > 0.4) return "rgba(253, 224, 71, 0.6)";
            if (value > 0.2) return "rgba(134, 239, 172, 0.6)";
            return "rgba(96, 165, 250, 0.6)";
          };

          let html = '<table class="correlation-table" style="width: 100%; border-collapse: collapse; font-size: 0.75rem;">';
          html += '<tr><th style="padding: 0.4rem; text-align: center;"></th>';
          assets.forEach(asset => {
            html += `<th style="padding: 0.4rem; text-align: center; font-weight: 600; color: var(--text-secondary);">${asset}</th>`;
          });
          html += '</tr>';

          correlations.forEach((row, i) => {
            html += '<tr>';
            html += `<td style="padding: 0.4rem; font-weight: 600; color: var(--text-secondary);">${assets[i]}</td>`;
            row.forEach(value => {
              html += `<td style="padding: 0.4rem; text-align: center; background: ${getColor(value)}; border: 1px solid rgba(0,0,0,0.1); font-weight: 600; color: var(--text-primary);">${value.toFixed(2)}</td>`;
            });
            html += '</tr>';
          });
          html += '</table>';

          container.innerHTML = html;
        }

        // New: Maximum Drawdown Chart
        function createDrawdownChart() {
          const canvas = document.getElementById("drawdownChart");
          if (!canvas || !window.Chart) return;
          if (activeCharts.drawdown) {
            activeCharts.drawdown.destroy();
          }

          const labels = Array.from({ length: 90 }, (_, idx) => `D${idx + 1}`);
          const drawdown = labels.map((_, idx) => {
            const base = -Math.abs(Math.sin(idx / 10) * 15);
            const spike = idx === 45 ? -25 : 0;
            return base + spike + Math.random() * 3;
          });

          activeCharts.drawdown = new Chart(canvas, {
            type: "line",
            data: {
              labels,
              datasets: [{
                label: "Drawdown %",
                data: drawdown,
                borderColor: "rgba(239, 68, 68, 1)",
                backgroundColor: "rgba(239, 68, 68, 0.1)",
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 0,
              }]
            },
            options: {
              plugins: {
                legend: { display: false },
                tooltip: { enabled: true }
              },
              scales: {
                x: {
                  display: false,
                  grid: { display: false }
                },
                y: {
                  title: { display: true, text: "Drawdown %" },
                  grid: { color: "rgba(0,0,0,0.08)" },
                  max: 0,
                  min: -30
                }
              }
            }
          });
        }

        // New: Strategy Performance Chart
        function createStrategyPerformanceChart() {
          const canvas = document.getElementById("strategyPerformanceChart");
          if (!canvas || !window.Chart) return;
          if (activeCharts.strategyPerformance) {
            activeCharts.strategyPerformance.destroy();
          }

          const strategies = ["EWP", "Momentum", "Risk Parity", "Max Div", "Sentiment"];
          const returns = [129.45, 179.77, 111.22, 111.22, 191.07];

          activeCharts.strategyPerformance = new Chart(canvas, {
            type: "bar",
            data: {
              labels: strategies,
              datasets: [{
                label: "Annualized Return (%)",
                data: returns,
                backgroundColor: returns.map(r =>
                  r > 150 ? "rgba(34, 197, 94, 0.7)" :
                  r > 120 ? "rgba(56, 139, 253, 0.7)" :
                  "rgba(251, 146, 60, 0.7)"
                ),
                borderColor: returns.map(r =>
                  r > 150 ? "rgba(34, 197, 94, 1)" :
                  r > 120 ? "rgba(56, 139, 253, 1)" :
                  "rgba(251, 146, 60, 1)"
                ),
                borderWidth: 2,
                borderRadius: 6,
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return 'Return: ' + context.parsed.y.toFixed(2) + '%';
                    }
                  }
                }
              },
              scales: {
                x: {
                  grid: { display: false },
                  ticks: { font: { size: 10 } }
                },
                y: {
                  beginAtZero: true,
                  grid: { color: "rgba(0,0,0,0.08)" },
                  ticks: {
                    callback: function(value) {
                      return value + '%';
                    }
                  }
                }
              }
            }
          });
        }

        // New: Asset Allocation Donut Chart
        function createAllocationDonutChart() {
          const canvas = document.getElementById("allocationDonutChart");
          const legendContainer = document.getElementById("allocationLegend");
          if (!canvas || !window.Chart) return;
          if (activeCharts.allocationDonut) {
            activeCharts.allocationDonut.destroy();
          }

          const assets = [
            { name: t("BTC"), value: 41.5, color: "rgba(247, 147, 26, 0.8)" },
            { name: t("ETH"), value: 19.5, color: "rgba(98, 126, 234, 0.8)" },
            { name: t("SOL"), value: 7.6, color: "rgba(20, 241, 149, 0.8)" },
            { name: t("MATIC"), value: 3.2, color: "rgba(130, 71, 229, 0.8)" },
            { name: t("Others"), value: 28.2, color: "rgba(148, 163, 184, 0.8)" }
          ];

          activeCharts.allocationDonut = new Chart(canvas, {
            type: "doughnut",
            data: {
              labels: assets.map(a => a.name),
              datasets: [{
                data: assets.map(a => a.value),
                backgroundColor: assets.map(a => a.color),
                borderWidth: 0,
                borderColor: "transparent",
                hoverBorderWidth: 0,
                hoverBorderColor: "transparent",
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: { display: false },
                tooltip: {
                  enabled: true,
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: 'rgba(255, 255, 255, 0.1)',
                  borderWidth: 1,
                  cornerRadius: 8,
                  padding: 12,
                  displayColors: true,
                  callbacks: {
                    label: function(context) {
                      return context.label + ': ' + context.parsed + '%';
                    }
                  }
                }
              },
              cutout: '65%',
              spacing: 0,
              animation: {
                animateRotate: true,
                animateScale: true,
                duration: 1000,
                easing: 'easeInOutQuart'
              }
            }
          });

          // Create legend
          if (legendContainer) {
            legendContainer.innerHTML = assets.map(asset => `
              <div class="allocation-legend-item">
                <div class="allocation-legend-label">
                  <div class="allocation-legend-color" style="background: ${asset.color}"></div>
                  <span>${asset.name}</span>
                </div>
                <span class="allocation-legend-value">${asset.value}%</span>
              </div>
            `).join('');
          }
        }

        // New: Rolling Sharpe Ratio Chart
        function createRollingSharpeChart() {
          const canvas = document.getElementById("rollingSharpeChart");
          if (!canvas || !window.Chart) return;
          if (activeCharts.rollingSharpe) {
            activeCharts.rollingSharpe.destroy();
          }

          const labels = Array.from({ length: 60 }, (_, idx) => `D${idx + 1}`);
          const sharpeRatio = labels.map((_, idx) => {
            return 1.5 + Math.sin(idx / 8) * 0.8 + Math.random() * 0.3;
          });

          activeCharts.rollingSharpe = new Chart(canvas, {
            type: "line",
            data: {
              labels,
              datasets: [{
                label: "Sharpe Ratio",
                data: sharpeRatio,
                borderColor: "rgba(56, 139, 253, 1)",
                backgroundColor: "rgba(56, 139, 253, 0.1)",
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 0,
              }]
            },
            options: {
              plugins: {
                legend: { display: false },
                tooltip: { enabled: true }
              },
              scales: {
                x: {
                  display: false,
                  grid: { display: false }
                },
                y: {
                  title: { display: true, text: "Sharpe Ratio" },
                  grid: { color: "rgba(0,0,0,0.08)" },
                  min: 0,
                  max: 3
                }
              }
            }
          });
        }

        function initSystemStatusTicker() {
          const statuses = [
            { label: "ğŸŸ¢ Market data synced", meta: "Updated seconds ago", level: "synced" },
            { label: "ğŸŸ¡ Data slightly delayed", meta: "Refresh in progress", level: "delayed" },
            { label: "ğŸ”´ Service temporarily constrained", meta: "Failover running", level: "degraded" },
          ];
          const labelEl = document.getElementById("systemStatusLabel");
          const metaEl = document.getElementById("systemStatusMeta");
          const dotEl = document.getElementById("systemStatusDot");
          if (!labelEl || !metaEl || !dotEl) return;
          let index = 0;
          const updateStatus = () => {
            const state = statuses[index % statuses.length];
            labelEl.textContent = state.label;
            metaEl.textContent = state.meta;
            dotEl.classList.remove("status-dot--warning", "status-dot--error");
            if (state.level === "delayed") {
              dotEl.classList.add("status-dot--warning");
            } else if (state.level === "degraded") {
              dotEl.classList.add("status-dot--error");
            }
            index += 1;
          };
          updateStatus();
          setInterval(updateStatus, 12000);
        }

        function handlePrimaryNavigation(target) {
          const navLinks = document.querySelectorAll(".top-nav-link");
          navLinks.forEach((link) => {
            if (link.dataset.nav === "wallet") return;
            link.classList.toggle("active", link.dataset.nav === target);
          });
          if (target === "dashboard") {
            document.getElementById("heroSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
          } else if (target === "strategies") {
            document.getElementById("strategyOutput")?.scrollIntoView({ behavior: "smooth", block: "start" });
          } else if (target === "research") {
            document.getElementById("advancedAnalyticsSection")?.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        }

        function bindSparklineTooltip(canvas, symbol) {
          if (!canvas || !chartTooltip || canvas.dataset.tooltipBound === "true")
            return;

          const show = (event) => {
            const asset = assetMeta.get(symbol);
            if (!asset) return;
            const changeValue = asset.change || 0;
            const prefix = changeValue >= 0 ? "+" : "";
            const content = `${asset.symbol} Â· ${formatPrice(asset.price)} (${prefix}${changeValue.toFixed(
              2
            )}%)`;
            showChartTooltip(content, event.clientX, event.clientY);
          };

          const hide = () => {
            hideChartTooltip();
          };

          canvas.addEventListener("mousemove", show);
          canvas.addEventListener("mouseleave", hide);
          canvas.addEventListener("blur", hide);
          canvas.dataset.tooltipBound = "true";
        }

        function showChartTooltip(content, x, y) {
          if (!chartTooltip) return;
          chartTooltip.textContent = content;
          chartTooltip.style.left = `${x}px`;
          chartTooltip.style.top = `${y - 12}px`;
          chartTooltip.classList.add("visible");
          chartTooltip.setAttribute("aria-hidden", "false");
        }

        function hideChartTooltip() {
          if (!chartTooltip) return;
          chartTooltip.classList.remove("visible");
          chartTooltip.setAttribute("aria-hidden", "true");
        }

        function easeOutCubic(t) {
          return 1 - Math.pow(1 - t, 3);
        }

        function populateStrategyScreener() {
          const container = document.getElementById("strategyScreener");
          container.innerHTML = `
            <h2 class="text-lg font-semibold mb-3">${t("Strategy Screener")}</h2>
            <p class="text-sm text-secondary mb-4">${t("Filter your strategies based on your risk profile.")}</p>
            <div class="flex space-x-2 mb-4">
                <button class="risk-profile-btn btn btn-secondary flex-1 text-xs" data-profile="Defensive">${t("Conservative")}</button>
                <button class="risk-profile-btn btn btn-secondary flex-1 text-xs active" data-profile="Balanced">${t("Balanced")}</button>
                <button class="risk-profile-btn btn btn-secondary flex-1 text-xs" data-profile="Aggressive">${t("Aggressive")}</button>
            </div>
        `;
          document.querySelectorAll(".risk-profile-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              document
                .querySelectorAll(".risk-profile-btn")
                .forEach((b) => b.classList.remove("active"));
              e.currentTarget.classList.add("active");
              filterStrategies(e.currentTarget.dataset.profile);
            });
          });
        }

        function filterStrategies(profile) {
          document
            .querySelectorAll("#strategyList > div[data-strategy-id]")
            .forEach((card) => {
              const cardType = card.dataset.strategyType;
              const isDynamic = cardType === "Dynamic";

              // In Balanced view, show Balanced, Momentum, and Dynamic
              const match =
                profile === cardType ||
                (profile === "Balanced" &&
                  (cardType === "Balanced" ||
                    cardType === "Momentum" ||
                    isDynamic)) ||
                (profile === "Aggressive" &&
                  (cardType === "Aggressive" ||
                    cardType === "Momentum" ||
                    isDynamic));

              card.style.transition = "opacity 0.3s, transform 0.3s";
              if (match) {
                card.style.opacity = "1";
                card.style.transform = "scale(1)";
                card.style.pointerEvents = "auto";
              } else {
                card.style.opacity = "0.4";
                card.style.transform = "scale(0.95)";
                card.style.pointerEvents = "none";
              }
            });
        }

        function populateIntelligenceTabs(activeTab) {
          const tabContent = document.getElementById("tabContent");
          tabContent.innerHTML = ""; // Clear previous content

          if (activeTab === "events") {
            const newsData = staticNewsData.Data;
            const getSentiment = (title) => {
              const positiveWords = [
                "soar",
                "boost",
                "explode",
                "embrace",
                "surge",
                "rebound",
                "rallies",
              ];
              const negativeWords = [
                "warning",
                "pressure",
                "loss",
                "crushed",
                "fails",
              ];
              const lowerTitle = title.toLowerCase();
              if (positiveWords.some((word) => lowerTitle.includes(word)))
                return { text: "Bullish", class: "tag-green" };
              if (negativeWords.some((word) => lowerTitle.includes(word)))
                return { text: "Bearish", class: "tag-red" };
              return { text: "Neutral", class: "tag-blue" };
            };

            tabContent.innerHTML = newsData
              .map((item) => {
                const coins = item.categories
                  .split("|")
                  .filter((c) => assetSymbols.includes(c));
                const sentiment = getSentiment(item.title);

                return `<div class="p-2.5 rounded-lg bg-bg-secondary">
                    <div class="flex justify-between items-start mb-2">
                        <span class="tag tag-purple">${
                          item.source_info.name
                        }</span>
                        <button class="ai-analyze-btn text-xs font-semibold text-purple-400 hover:text-purple-300" data-title="${
                          item.title
                        }">âœ¨ æ™ºèƒ½åˆ†æ</button>
                    </div>
                    <p class="font-medium text-sm">${item.title}</p>
                    <div class="flex items-center justify-between mt-2">
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="tag ${sentiment.class}">${
                  sentiment.text
                }</span>
                            ${coins
                              .map(
                                (c) =>
                                  `<span class="tag tag-orange">${c}</span>`
                              )
                              .join("")}
                        </div>
                        <p class="text-xs text-secondary text-right flex-shrink-0">${new Date(
                          item.published_on * 1000
                        ).toLocaleDateString()}</p>
                    </div>
                </div>`;
              })
              .join("");
            document
              .querySelectorAll(".ai-analyze-btn")
              .forEach((btn) =>
                btn.addEventListener("click", (e) =>
                  analyzeNews(e.currentTarget.dataset.title)
                )
              );
          } else if (activeTab === "movers") {
            const topGainers = [...allMarketData]
              .sort((a, b) => (b.change || 0) - (a.change || 0))
              .slice(0, 5);
            const topLosers = [...allMarketData]
              .filter((a) => (a.change || 0) < 0)
              .sort((a, b) => (a.change || 0) - (b.change || 0))
              .slice(0, 5);

            const renderList = (title, listData) => `
                <div>
                    <h4 class="font-semibold mb-2 text-sm text-secondary">${title}</h4>
                    <ul class="space-y-2">
                        ${listData
                          .map(
                            (asset) => `
                            <li class="flex items-center justify-between text-sm">
                                <div class="flex items-center">
                                    <img src="${
                                      asset.imageUrl
                                    }" onerror="this.onerror=null;this.src='https://placehold.co/24x24/161b22/c9d1d9?text=${asset.symbol.substring(
                              0,
                              2
                            )}';" class="w-6 h-6 rounded-full mr-2" alt="${
                              asset.symbol
                            } logo">
                                    <span class="font-medium">${
                                      asset.symbol
                                    }</span>
                                </div>
                                <span class="font-mono ${
                                  asset.change >= 0 ? "text-gain" : "text-loss"
                                }">${asset.change.toFixed(2)}%</span>
                            </li>
                        `
                          )
                          .join("")}
                    </ul>
                </div>`;
            tabContent.innerHTML = `
                <div class="space-y-4">
                    ${renderList("Top Gainers", topGainers)}
                    ${renderList("Top Losers", topLosers)}
                </div>
            `;
          } else if (activeTab === "whales") {
            const timeSince = (timestamp) => {
              const seconds = Math.floor((Date.now() - timestamp) / 1000);
              let interval = seconds / 31536000;
              if (interval > 1) return Math.floor(interval) + " years ago";
              interval = seconds / 2592000;
              if (interval > 1) return Math.floor(interval) + " months ago";
              interval = seconds / 86400;
              if (interval > 1) return Math.floor(interval) + " days ago";
              interval = seconds / 3600;
              if (interval > 1) return Math.floor(interval) + " hours ago";
              interval = seconds / 60;
              if (interval > 1) return Math.floor(interval) + " minutes ago";
              return Math.floor(seconds) + " seconds ago";
            };

            const formatWallet = (name) => {
              if (name.startsWith("0x")) {
                return `${name.substring(0, 6)}...${name.substring(
                  name.length - 4
                )}`;
              }
              return name;
            };

            tabContent.innerHTML = staticWhaleData
              .map((tx) => {
                const isDeposit = tx.type === "DEPOSIT";
                const icon = isDeposit
                  ? `<svg class="w-5 h-5 mr-3 text-loss" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5l-3 3-3-3"></path></svg>`
                  : `<svg class="w-5 h-5 mr-3 text-gain" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5l3-3-3-3"></path></svg>`;

                return `
                <div class="p-3 rounded-lg bg-bg-secondary">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            ${icon}
                            <span class="font-semibold text-text-primary">${new Intl.NumberFormat().format(
                              tx.amountCrypto
                            )} ${tx.symbol}</span>
                            <span class="text-xs text-secondary ml-2">($${(
                              tx.amountUSD / 1000000
                            ).toFixed(1)}M)</span>
                        </div>
                        <span class="text-xs text-secondary">${timeSince(
                          tx.timestamp
                        )}</span>
                    </div>
                    <div class="text-xs text-secondary space-y-1 pl-8">
                        <div class="flex justify-between">
                            <span>From: <span class="font-mono text-text-primary">${formatWallet(
                              tx.from
                            )}</span></span>
                            <span>To: <span class="font-mono text-text-primary">${formatWallet(
                              tx.to
                            )}</span></span>
                        </div>
                    </div>
                     <div class="mt-2 text-right">
                        <a href="#" class="text-xs font-semibold text-accent-blue hover:underline">View on Explorer &rarr;</a>
                    </div>
                </div>
                `;
              })
              .join("");
          }
        }

        function populateStrategyList() {
          const strategyList = document.getElementById("strategyList");

          const typeColors = {
            Defensive: "tag-blue",
            Balanced: "tag-green",
            Aggressive: "tag-orange",
            Momentum: "tag-purple",
            Dynamic: "tag-red",
          };

          strategyList.innerHTML = Object.entries(strategies)
            .map(([id, strategy]) => {
              return `
            <div id="strategy-card-${id}" data-strategy-id="${id}" data-scroll-target="strategyFocusAnchor" data-strategy-type="${
                strategy.type
              }" class="glass-card strategy-card p-5 rounded-2xl transition-all duration-300 cursor-pointer hover:border-accent-blue-hover">
                <div class="flex justify-between items-start mb-3">
                    <h4 class="font-semibold text-md w-4/5">${
                      strategy.name
                    }</h4>
                    <span class="tag ${
                      typeColors[strategy.type] || "tag-blue"
                    }">${strategy.type}</span>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-center border-t border-b border-border-color py-3 my-3">
                    <div>
                        <div class="text-xs text-secondary">Ann. Return</div>
                        <div class="font-semibold text-sm flex items-center justify-center gap-1">
                            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4V20M12 4L8 8M12 4L16 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            ${strategy.metrics["Annualized Return"]}
                        </div>
                    </div>
                    <div>
                        <div class="text-xs text-secondary">Volatility</div>
                        <div class="font-semibold text-sm flex items-center justify-center gap-1">
                             <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 12H6L9 4L15 20L18 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            ${strategy.metrics["Annualized Volatility"]}
                        </div>
                    </div>
                    <div>
                        <div class="text-xs text-secondary">Sharpe Ratio</div>
                        <div class="font-semibold text-sm flex items-center justify-center gap-1">
                             <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12L16 8M12 12L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            ${strategy.metrics["Sharpe Ratio"]}
                        </div>
                    </div>
                </div>
                
                <div class="sentiment-overlay-content hidden space-y-2">
                     <div class="text-xs text-secondary">Sentiment Match</div>
                     <div class="w-full bg-bg-secondary rounded-full h-2.5">
                        <div class="h-2.5 rounded-full sentiment-gauge-bar" style="width: 50%"></div>
                    </div>
                </div>
            </div>`;
            })
            .join("");

          document
            .querySelectorAll(".strategy-card")
            .forEach((card) =>
              card.addEventListener("click", (e) => {
                handleStrategyCardClick(e.currentTarget);
              })
            );

          // Initial filter
          filterStrategies("Balanced");
          
          // Initialize comparison gallery
          initializeComparisonGallery();
          
          // Initialize Portfolio AI Agent
          initializePortfolioAIAgent();
        }

        function handleStrategyCardClick(card) {
          if (!card) return;
          const targetId = card.dataset.scrollTarget;
          if (targetId) {
            const target = document.getElementById(targetId);
            if (target) {
              target.classList.add("strategy-focus-active");
              target.scrollIntoView({ behavior: "smooth", block: "start" });
              setTimeout(() => target.classList.remove("strategy-focus-active"), 350);
            }
          }
          const strategyId = card.dataset.strategyId;
          if (strategyId) {
            showStrategyDetail(strategyId);
          }
        }
        
        /**
         * Initialize Intelligent Portfolio Assistant
         */
        function initializePortfolioAIAgent() {
          const generateBtn = document.getElementById("generate-recommendation-btn");
          
          if (generateBtn) {
            generateBtn.addEventListener("click", async () => {
              await generatePortfolioRecommendation();
            });
          }
          
          // Auto-calculate percentages when user inputs values
          const assetInputs = ["input-cash", "input-stocks", "input-bonds", "input-crypto"];
          assetInputs.forEach(id => {
            const input = document.getElementById(id);
            if (input) {
              input.addEventListener("input", () => {
                normalizeAssetPercentages();
              });
            }
          });
          
          // Reset form button
          const resetBtn = document.getElementById("reset-form-btn");
          if (resetBtn) {
            resetBtn.addEventListener("click", () => {
              // Clear all inputs
              document.getElementById("input-cash").value = "";
              document.getElementById("input-stocks").value = "";
              document.getElementById("input-bonds").value = "";
              document.getElementById("input-crypto").value = "";
              document.getElementById("input-risk").value = "balanced";
              document.getElementById("input-horizon").value = "3";
              document.getElementById("input-total-assets").value = "1254300";
              
              // Hide results, show input form
              const resultsSection = document.getElementById("ai-agent-results");
              if (resultsSection) resultsSection.classList.add("hidden");
              const loadingSection = document.getElementById("ai-agent-loading");
              if (loadingSection) loadingSection.classList.add("hidden");
              const generateBtn = document.getElementById("generate-recommendation-btn");
              if (generateBtn) generateBtn.disabled = false;
            });
          }
        }
        
        /**
         * Normalize asset percentages to sum to 100%
         */
        function normalizeAssetPercentages() {
          const cash = parseFloat(document.getElementById("input-cash")?.value || 0);
          const stocks = parseFloat(document.getElementById("input-stocks")?.value || 0);
          const bonds = parseFloat(document.getElementById("input-bonds")?.value || 0);
          const crypto = parseFloat(document.getElementById("input-crypto")?.value || 0);
          
          const total = cash + stocks + bonds + crypto;
          
          // If user has entered values but they don't sum to 100, show a hint
          if (total > 0 && total !== 100 && (cash > 0 || stocks > 0 || bonds > 0 || crypto > 0)) {
            // Auto-normalize if total is close to 100
            if (total > 95 && total < 105) {
              const scale = 100 / total;
              if (cash > 0) document.getElementById("input-cash").value = Math.round(cash * scale);
              if (stocks > 0) document.getElementById("input-stocks").value = Math.round(stocks * scale);
              if (bonds > 0) document.getElementById("input-bonds").value = Math.round(bonds * scale);
              if (crypto > 0) document.getElementById("input-crypto").value = Math.round(crypto * scale);
            }
          }
        }
        
        /**
         * Generate portfolio recommendation
         */
        async function generatePortfolioRecommendation() {
          // Get user inputs
          const cash = parseFloat(document.getElementById("input-cash")?.value || 0);
          const stocks = parseFloat(document.getElementById("input-stocks")?.value || 0);
          const bonds = parseFloat(document.getElementById("input-bonds")?.value || 0);
          const crypto = parseFloat(document.getElementById("input-crypto")?.value || 0);
          const riskTolerance = document.getElementById("input-risk")?.value || "balanced";
          const horizon = parseInt(document.getElementById("input-horizon")?.value || 3);
          const totalAssets = parseFloat(document.getElementById("input-total-assets")?.value || 1000000);
          
          // Calculate current percentages (if not provided, auto-calculate)
          let currentCash = cash;
          let currentStocks = stocks;
          let currentBonds = bonds;
          let currentCrypto = crypto;
          
          const totalInput = cash + stocks + bonds + crypto;
          
          // If user hasn't provided percentages, estimate from total assets
          if (totalInput === 0 || totalInput !== 100) {
            // Default allocation based on common patterns
            currentCash = 20;
            currentStocks = 50;
            currentBonds = 20;
            currentCrypto = 10;
          } else {
            // Normalize to 100%
            const scale = 100 / totalInput;
            currentCash = cash * scale;
            currentStocks = stocks * scale;
            currentBonds = bonds * scale;
            currentCrypto = crypto * scale;
          }
          
          // Show loading state
          const loadingSection = document.getElementById("ai-agent-loading");
          const resultsSection = document.getElementById("ai-agent-results");
          const generateBtn = document.getElementById("generate-recommendation-btn");
          
          if (generateBtn) generateBtn.disabled = true;
          if (loadingSection) loadingSection.classList.remove("hidden");
          if (resultsSection) resultsSection.classList.add("hidden");
          
          try {
            const recommendation = generateRecommendationLogic({
              currentCash,
              currentStocks,
              currentBonds,
              currentCrypto,
              riskTolerance,
              horizon,
              totalAssets
            });
            
            // Display results
            displayPortfolioRecommendation(recommendation);
            
            // Show results
            if (resultsSection) resultsSection.classList.remove("hidden");
          } catch (error) {
            console.error("Error generating portfolio recommendation:", error);
            if (resultsSection) {
              resultsSection.innerHTML = `
                <div class="error-message" role="alert">
                  <p>${currentLanguage === "zh" ? "ç³»ç»Ÿæš‚æ—¶æ— æ³•ç”Ÿæˆå»ºè®®ï¼Œè¯·ç¨åå†è¯•ã€‚" : "The system couldn't generate a recommendation. Please try again later."}</p>
                </div>
              `;
              resultsSection.classList.remove("hidden");
            }
          } finally {
            if (loadingSection) loadingSection.classList.add("hidden");
            if (generateBtn) generateBtn.disabled = false;
          }
        }
        
        /**
         * Generate recommendation logic
         */
        function generateRecommendationLogic(inputs) {
          const { currentCash, currentStocks, currentBonds, currentCrypto, riskTolerance, horizon, totalAssets } = inputs;
          
          // Recommended allocation based on risk tolerance
          let recommendedCash, recommendedStocks, recommendedBonds, recommendedCrypto;
          let allocationReason;
          let recommendedStrategies = [];
          let returnPredictions = {};
          let riskWarning = "";
          
          if (riskTolerance === "conservative") {
            recommendedCash = 30;
            recommendedStocks = 40;
            recommendedBonds = 25;
            recommendedCrypto = 5;
            allocationReason = currentLanguage === "zh" 
              ? "ä¿å®ˆå‹é…ç½®ï¼šå¢åŠ ç°é‡‘å’Œå€ºåˆ¸æ¯”ä¾‹ä»¥é™ä½é£é™©ï¼Œé€‚åº¦é…ç½®è‚¡ç¥¨å’ŒåŠ å¯†è´§å¸ã€‚"
              : "Conservative allocation: Increase cash and bonds to reduce risk, moderate stocks and crypto exposure.";
            recommendedStrategies = [
              { id: "gmvp", name: "Global Minimum Variance Portfolio (GMVP)", reason: currentLanguage === "zh" ? "æœ€å°åŒ–æ³¢åŠ¨æ€§ï¼Œé€‚åˆä¿å®ˆå‹æŠ•èµ„è€…" : "Minimizes volatility, suitable for conservative investors" },
              { id: "risk_parity", name: "Risk Parity Portfolio", reason: currentLanguage === "zh" ? "å¹³è¡¡é£é™©åˆ†é…ï¼Œæä¾›ç¨³å®šå›æŠ¥" : "Balanced risk allocation for stable returns" }
            ];
            returnPredictions = {
              "1": { min: 4, max: 8 },
              "3": { min: 12, max: 25 },
              "5": { min: 20, max: 45 }
            };
            riskWarning = currentLanguage === "zh" 
              ? "ä¿å®ˆå‹é…ç½®é£é™©è¾ƒä½ï¼Œä½†å›æŠ¥ä¹Ÿç›¸å¯¹è¾ƒä½ã€‚é€‚åˆé£é™©åŒæ¶å‹æŠ•èµ„è€…ã€‚"
              : "Conservative allocation has lower risk but also lower returns. Suitable for risk-averse investors.";
          } else if (riskTolerance === "aggressive") {
            recommendedCash = 10;
            recommendedStocks = 50;
            recommendedBonds = 10;
            recommendedCrypto = 30;
            allocationReason = currentLanguage === "zh"
              ? "ç§¯æå‹é…ç½®ï¼šå¢åŠ è‚¡ç¥¨å’ŒåŠ å¯†è´§å¸æ¯”ä¾‹ä»¥è¿½æ±‚é«˜å›æŠ¥ï¼Œå‡å°‘ç°é‡‘å’Œå€ºåˆ¸é…ç½®ã€‚"
              : "Aggressive allocation: Increase stocks and crypto for higher returns, reduce cash and bonds.";
            recommendedStrategies = [
              { id: "msrp", name: "Max Sharpe Ratio Portfolio (MSRP)", reason: currentLanguage === "zh" ? "æœ€å¤§åŒ–é£é™©è°ƒæ•´å›æŠ¥ï¼Œé€‚åˆç§¯æå‹æŠ•èµ„è€…" : "Maximizes risk-adjusted returns, suitable for aggressive investors" },
              { id: "ew_top7_momentum", name: "Top-7 Momentum Equal Weighted", reason: currentLanguage === "zh" ? "æ•æ‰å¸‚åœºåŠ¨é‡ï¼Œè¿½æ±‚é«˜å›æŠ¥" : "Captures market momentum for high returns" }
            ];
            returnPredictions = {
              "1": { min: 15, max: 35 },
              "3": { min: 50, max: 120 },
              "5": { min: 100, max: 250 }
            };
            riskWarning = currentLanguage === "zh"
              ? "ç§¯æå‹é…ç½®é£é™©è¾ƒé«˜ï¼Œå¯èƒ½å‡ºç°å¤§å¹…æ³¢åŠ¨ã€‚é€‚åˆé£é™©æ‰¿å—èƒ½åŠ›å¼ºçš„æŠ•èµ„è€…ã€‚"
              : "Aggressive allocation has higher risk with potential for significant volatility. Suitable for investors with high risk tolerance.";
          } else { // balanced
            recommendedCash = 20;
            recommendedStocks = 45;
            recommendedBonds = 20;
            recommendedCrypto = 15;
            allocationReason = currentLanguage === "zh"
              ? "å¹³è¡¡å‹é…ç½®ï¼šåœ¨é£é™©å’Œå›æŠ¥ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œé€‚åˆå¤§å¤šæ•°æŠ•èµ„è€…ã€‚"
              : "Balanced allocation: Strikes a balance between risk and return, suitable for most investors.";
            recommendedStrategies = [
              { id: "risk_parity", name: "Risk Parity Portfolio", reason: currentLanguage === "zh" ? "å¹³è¡¡é£é™©åˆ†é…ï¼Œæä¾›ç¨³å®šå›æŠ¥" : "Balanced risk allocation for stable returns" },
              { id: "max_diversification", name: "Max Diversification Portfolio", reason: currentLanguage === "zh" ? "æœ€å¤§åŒ–åˆ†æ•£åŒ–ï¼Œé™ä½ç›¸å…³æ€§é£é™©" : "Maximizes diversification to reduce correlation risk" }
            ];
            returnPredictions = {
              "1": { min: 8, max: 18 },
              "3": { min: 25, max: 60 },
              "5": { min: 50, max: 120 }
            };
            riskWarning = currentLanguage === "zh"
              ? "å¹³è¡¡å‹é…ç½®åœ¨é£é™©å’Œå›æŠ¥ä¹‹é—´å–å¾—å¹³è¡¡ã€‚é€‚åˆä¸­ç­‰é£é™©æ‰¿å—èƒ½åŠ›çš„æŠ•èµ„è€…ã€‚"
              : "Balanced allocation strikes a balance between risk and return. Suitable for investors with moderate risk tolerance.";
          }
          
          // Adjust based on investment horizon
          if (horizon >= 5) {
            // Long-term: can take more risk
            recommendedCrypto = Math.min(recommendedCrypto + 5, 40);
            recommendedCash = Math.max(recommendedCash - 5, 5);
            recommendedStocks = Math.min(recommendedStocks + 2, 60);
            recommendedBonds = Math.max(recommendedBonds - 2, 10);
            // Update return predictions for long-term
            if (riskTolerance === "aggressive") {
              returnPredictions["5"] = { min: Math.round(returnPredictions["5"].min * 1.2), max: Math.round(returnPredictions["5"].max * 1.2) };
            }
          } else if (horizon === 1) {
            // Short-term: more conservative
            recommendedCash = Math.min(recommendedCash + 10, 40);
            recommendedCrypto = Math.max(recommendedCrypto - 5, 0);
            recommendedStocks = Math.max(recommendedStocks - 3, 30);
            recommendedBonds = Math.max(recommendedBonds - 2, 15);
            // Update return predictions for short-term
            returnPredictions["1"] = { min: Math.round(returnPredictions["1"].min * 0.8), max: Math.round(returnPredictions["1"].max * 0.8) };
          }
          
          // Adjust based on current allocation (if user has crypto-heavy portfolio, suggest more crypto strategies)
          if (currentCrypto > 20) {
            // User already has significant crypto exposure
            if (riskTolerance === "aggressive") {
              recommendedStrategies = [
                { id: "msrp", name: "Max Sharpe Ratio Portfolio (MSRP)", reason: currentLanguage === "zh" ? "æœ€å¤§åŒ–é£é™©è°ƒæ•´å›æŠ¥ï¼Œé€‚åˆåŠ å¯†è´§å¸æŠ•èµ„è€…" : "Maximizes risk-adjusted returns, suitable for crypto investors" },
                { id: "sentiment_tilted", name: "Dynamic Sentiment-Tilted Strategy (0.3)", reason: currentLanguage === "zh" ? "ç»“åˆå¸‚åœºæƒ…ç»ªï¼Œä¼˜åŒ–åŠ å¯†è´§å¸é…ç½®" : "Combines market sentiment to optimize crypto allocation" }
              ];
            }
          } else if (currentCrypto < 5 && riskTolerance !== "conservative") {
            // User has low crypto exposure, but might benefit from some
            recommendedCrypto = Math.min(recommendedCrypto + 3, 20);
            recommendedCash = Math.max(recommendedCash - 3, 10);
          }
          
          // Adjust based on current stock allocation
          if (currentStocks > 60 && riskTolerance === "aggressive") {
            // User has high stock exposure, might want to diversify
            recommendedCrypto = Math.min(recommendedCrypto + 5, 35);
            recommendedStocks = Math.max(recommendedStocks - 5, 45);
          } else if (currentStocks < 30 && riskTolerance !== "conservative") {
            // User has low stock exposure, might want to increase
            recommendedStocks = Math.min(recommendedStocks + 5, 55);
            recommendedCash = Math.max(recommendedCash - 3, 10);
          }
          
          // Ensure percentages sum to 100
          const total = recommendedCash + recommendedStocks + recommendedBonds + recommendedCrypto;
          if (total !== 100) {
            const scale = 100 / total;
            recommendedCash = Math.round(recommendedCash * scale);
            recommendedStocks = Math.round(recommendedStocks * scale);
            recommendedBonds = Math.round(recommendedBonds * scale);
            recommendedCrypto = Math.round(recommendedCrypto * scale);
          }
          
          // Final validation: ensure no negative values
          recommendedCash = Math.max(0, recommendedCash);
          recommendedStocks = Math.max(0, recommendedStocks);
          recommendedBonds = Math.max(0, recommendedBonds);
          recommendedCrypto = Math.max(0, recommendedCrypto);
          
          // Re-normalize if needed
          const finalTotal = recommendedCash + recommendedStocks + recommendedBonds + recommendedCrypto;
          if (finalTotal !== 100) {
            const finalScale = 100 / finalTotal;
            recommendedCash = Math.round(recommendedCash * finalScale);
            recommendedStocks = Math.round(recommendedStocks * finalScale);
            recommendedBonds = Math.round(recommendedBonds * finalScale);
            recommendedCrypto = Math.round(recommendedCrypto * finalScale);
          }
          
          return {
            current: {
              cash: currentCash,
              stocks: currentStocks,
              bonds: currentBonds,
              crypto: currentCrypto
            },
            recommended: {
              cash: recommendedCash,
              stocks: recommendedStocks,
              bonds: recommendedBonds,
              crypto: recommendedCrypto
            },
            allocationReason,
            recommendedStrategies,
            returnPredictions,
            riskWarning,
            totalAssets
          };
        }
        
        /**
         * Display portfolio recommendation
         */
        function displayPortfolioRecommendation(recommendation) {
          const { current, recommended, allocationReason, recommendedStrategies, returnPredictions, riskWarning } = recommendation;
          const resultsSection = document.getElementById("ai-agent-results");
          if (!resultsSection) return;

          const labels =
            currentLanguage === "zh"
              ? {
                  assetOverview: "èµ„äº§æ¦‚å†µ",
                  recommended: "æ¨èèµ„äº§é…ç½®ï¼ˆæ™ºèƒ½ä¼˜åŒ–ï¼‰",
                  stocks: "è‚¡ç¥¨",
                  bonds: "å›ºå®šæ”¶ç›Š",
                  cash: "ç°é‡‘",
                  crypto: "åŠ å¯†è´§å¸",
                  strategies: "æ¨èç­–ç•¥",
                  futureReturns: "æœªæ¥å›æŠ¥é¢„æµ‹",
                  risk: "é£é™©æç¤º",
                  oneYear: "1 å¹´",
                  threeYear: "3 å¹´",
                  fiveYear: "5 å¹´",
                  guidance: "è‹¥éœ€æŸ¥çœ‹ç­–ç•¥è¯¦æƒ…ï¼Œå¯ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ã€‚",
                }
              : {
                  assetOverview: "Asset Overview",
                  recommended: "Recommended Allocation (Intelligent)",
                  stocks: "Stocks",
                  bonds: "Fixed Income",
                  cash: "Cash",
                  crypto: "Cryptocurrency",
                  strategies: "Recommended Strategies",
                  futureReturns: "Future Return Forecast",
                  risk: "Risk Reminder",
                  oneYear: "1 Year",
                  threeYear: "3 Years",
                  fiveYear: "5 Years",
                  guidance: "Click the links below to view strategy details.",
                };

          const colon = currentLanguage === "zh" ? "ï¼š" : ": ";
          const formatLine = (label, value) => `<li>- ${label}${colon}${value}</li>`;

          const assetOverview = `
            <div class="space-y-2">
              <p class="font-semibold text-base" style="color: var(--text-primary);">ã€${labels.assetOverview}ã€‘</p>
              <ul class="space-y-1 text-sm" style="color: var(--text-secondary);">
                ${formatLine(labels.stocks, `${current.stocks.toFixed(1)}%`)}
                ${formatLine(labels.bonds, `${current.bonds.toFixed(1)}%`)}
                ${formatLine(labels.cash, `${current.cash.toFixed(1)}%`)}
                ${formatLine(labels.crypto, `${current.crypto.toFixed(1)}%`)}
              </ul>
            </div>
          `;

          const recommendedBlock = `
            <div class="space-y-2">
              <p class="font-semibold text-base" style="color: var(--text-primary);">ã€${labels.recommended}ã€‘</p>
              <ul class="space-y-1 text-sm" style="color: var(--text-secondary);">
                ${formatLine(labels.stocks, `${recommended.stocks}%`)}
                ${formatLine(labels.bonds, `${recommended.bonds}%`)}
                ${formatLine(labels.cash, `${recommended.cash}%`)}
                ${formatLine(labels.crypto, `${recommended.crypto}%`)}
              </ul>
              <p class="text-sm italic" style="color: var(--text-secondary);">${allocationReason}</p>
            </div>
          `;

          const strategiesBlock = `
            <div class="space-y-2">
              <p class="font-semibold text-base" style="color: var(--text-primary);">ã€${labels.strategies}ã€‘</p>
              <p class="text-xs" style="color: var(--text-secondary);">${labels.guidance}</p>
              <div class="space-y-2">
                ${recommendedStrategies
                  .map(
                    (strategy, idx) => `
                      <div class="p-3 rounded-lg border border-border-color">
                        <p class="font-semibold" style="color: var(--text-primary);">${idx + 1}. ${strategy.name}</p>
                        <p class="text-sm" style="color: var(--text-secondary);">${strategy.reason}</p>
                        <button class="text-accent-blue text-sm font-mono mt-1 underline" data-strategy-link="${strategy.id}">
                          â¡ /strategy/${strategy.id}
                        </button>
                      </div>
                    `
                  )
                  .join("")}
              </div>
            </div>
          `;

          const returnsBlock = `
            <div class="space-y-2">
              <p class="font-semibold text-base" style="color: var(--text-primary);">ã€${labels.futureReturns}ã€‘</p>
              <ul class="space-y-1 text-sm" style="color: var(--text-secondary);">
                ${formatLine(labels.oneYear, `${returnPredictions["1"].min}% ~ ${returnPredictions["1"].max}%`)}
                ${formatLine(labels.threeYear, `${returnPredictions["3"].min}% ~ ${returnPredictions["3"].max}%`)}
                ${formatLine(labels.fiveYear, `${returnPredictions["5"].min}% ~ ${returnPredictions["5"].max}%`)}
              </ul>
            </div>
          `;

          const riskBlock = `
            <div class="space-y-2">
              <p class="font-semibold text-base" style="color: var(--text-primary);">ã€${labels.risk}ã€‘</p>
              <p class="text-sm" style="color: var(--text-secondary);">${riskWarning}</p>
            </div>
          `;

          resultsSection.innerHTML = `
            <div class="space-y-5 text-sm leading-relaxed">
              ${assetOverview}
              ${recommendedBlock}
              ${strategiesBlock}
              ${returnsBlock}
              ${riskBlock}
            </div>
          `;

          resultsSection.querySelectorAll("[data-strategy-link]").forEach((button) => {
            button.addEventListener("click", () => {
              const strategyId = button.getAttribute("data-strategy-link");
              if (strategyId && strategies[strategyId]) {
                showStrategyDetail(strategyId);
                const agentSection = document.getElementById("portfolioAIAgentSection");
                if (agentSection) {
                  agentSection.scrollIntoView({ behavior: "smooth", block: "nearest" });
                }
              }
            });
          });
        }
        
        /**
         * Initialize comparison gallery
         */
        function initializeComparisonGallery() {
          const comparisonImages = [
            { src: "https://i.imgur.com/07pXIDX.png", title: t("Risk vs. Return Profile") || "Risk vs. Return Profile", key: "Risk vs. Return Profile" },
            { src: "https://i.imgur.com/bDPCaWh.png", title: t("Strategy Correlation Heatmap") || "Strategy Correlation Heatmap", key: "Strategy Correlation Heatmap" },
            { src: "https://i.imgur.com/eew113B.png", title: t("Sharpe Ratio Comparison") || "Sharpe Ratio Comparison", key: "Sharpe Ratio Comparison" },
            { src: "https://i.imgur.com/4hgdqrA.png", title: t("Alpha vs BTC Comparison") || "Alpha vs BTC Comparison", key: "Alpha vs BTC Comparison" },
            { src: "https://i.imgur.com/Qqb3bwJ.png", title: t("Weekly Returns Distribution") || "Weekly Returns Distribution", key: "Weekly Returns Distribution" },
            { src: "https://i.imgur.com/E31cgyJ.png", title: t("Max Drawdown Comparison") || "Max Drawdown Comparison", key: "Max Drawdown Comparison" },
          ];
          
          // Store globally for gallery access
          window.comparisonGallery = comparisonImages;
          
          // Set featured image
          const featuredImage = document.getElementById("featured-chart-image");
          const featuredTitle = document.getElementById("featured-chart-title");
          if (featuredImage && comparisonImages[0]) {
            featuredImage.src = comparisonImages[0].src;
            featuredImage.alt = comparisonImages[0].title;
            if (featuredTitle) {
              featuredTitle.textContent = comparisonImages[0].title;
            }
          }
          
          // Create thumbnail gallery
          const thumbnailContainer = document.querySelector("#comparison-content .grid.grid-cols-2");
          if (thumbnailContainer) {
            thumbnailContainer.innerHTML = comparisonImages.map((img, idx) => `
              <div class="comparison-thumbnail-item cursor-pointer group relative overflow-hidden rounded-lg border-2 transition-all ${
                idx === 0 ? 'border-accent-blue ring-2 ring-accent-blue' : 'border-transparent hover:border-accent-blue'
              }" data-comparison-index="${idx}">
                <img 
                  src="${img.src}" 
                  alt="${img.title}"
                  class="w-full h-32 object-cover transition-transform group-hover:scale-110"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center">
                  <p class="text-white text-xs font-semibold opacity-0 group-hover:opacity-100 transition-opacity text-center px-2">${img.title}</p>
                </div>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                  <p class="text-white text-xs font-medium truncate">${img.title}</p>
                </div>
              </div>
            `).join("");
            
            // Thumbnail click handlers
            thumbnailContainer.querySelectorAll(".comparison-thumbnail-item").forEach((item, idx) => {
              item.addEventListener("click", () => {
                const img = comparisonImages[idx];
                if (img && featuredImage) {
                  featuredImage.src = img.src;
                  featuredImage.alt = img.title;
                  if (featuredTitle) {
                    featuredTitle.textContent = img.title;
                  }
                  // Update active state
                  thumbnailContainer.querySelectorAll(".comparison-thumbnail-item").forEach(i => {
                    i.classList.remove("border-accent-blue", "ring-2", "ring-accent-blue");
                  });
                  item.classList.add("border-accent-blue", "ring-2", "ring-accent-blue");
                }
              });
            });
          }
          
          // Featured image click to open gallery
          const featuredContainer = document.getElementById("featured-chart-container");
          if (featuredContainer) {
            featuredContainer.addEventListener("click", () => {
              const currentIndex = comparisonImages.findIndex(img => img.src === featuredImage?.src);
              openImageGallery(comparisonImages, currentIndex >= 0 ? currentIndex : 0);
            });
          }
          
          // Open gallery button
          const openGalleryBtn = document.getElementById("openComparisonGalleryBtn");
          if (openGalleryBtn) {
            openGalleryBtn.addEventListener("click", () => {
              const currentIndex = comparisonImages.findIndex(img => img.src === featuredImage?.src);
              openImageGallery(comparisonImages, currentIndex >= 0 ? currentIndex : 0);
            });
          }
        }

        function applySentimentOverlay() {
          const toggle = document.getElementById("sentiment-toggle");
          if (!toggle) return;
          const isEnabled = toggle.checked;
          const sentimentCard = document.getElementById("marketSentimentCard");
          const fngValue = sentimentCard ? parseInt(sentimentCard.dataset.sentimentValue) : 50;

          document
            .querySelectorAll(".sentiment-overlay-content")
            .forEach((el) => {
              el.classList.toggle("hidden", !isEnabled);
            });

          document
            .querySelectorAll(".glass-card[data-strategy-id]")
            .forEach((card) => {
              if (!isEnabled) {
                card.classList.remove("sentiment-favored");
                card.style.boxShadow = "";
                card.style.borderColor = "";
                return;
              }

              const type = card.dataset.strategyType;
              let sentimentScore = 50; // Neutral
              let isFavored = false;

              if (fngValue > 60) {
                // Greed
                if (
                  type === "Aggressive" ||
                  type === "Momentum" ||
                  type === "Dynamic"
                ) {
                  sentimentScore = 85;
                  isFavored = true;
                } else if (type === "Balanced") {
                  sentimentScore = 65;
                } else {
                  // Defensive
                  sentimentScore = 25;
                }
              } else if (fngValue < 40) {
                // Fear
                if (type === "Defensive") {
                  sentimentScore = 85;
                  isFavored = true;
                } else if (type === "Balanced") {
                  sentimentScore = 65;
                } else {
                  // Aggressive, Momentum, Dynamic
                  sentimentScore = 25;
                }
              } else {
                // Neutral
                if (type === "Balanced" || type === "Dynamic") {
                  sentimentScore = 75;
                  isFavored = true;
                } else {
                  sentimentScore = 50;
                }
              }

              const gaugeBar = card.querySelector(".sentiment-gauge-bar");
              if (gaugeBar) {
                gaugeBar.style.width = `${sentimentScore}%`;
                if (sentimentScore > 70)
                  gaugeBar.style.backgroundColor = "var(--status-green)";
                else if (sentimentScore < 40)
                  gaugeBar.style.backgroundColor = "var(--status-red)";
                else gaugeBar.style.backgroundColor = "var(--accent-blue)";
              }

              if (isFavored) {
                card.classList.add("sentiment-favored");
                card.style.boxShadow = "0 0 25px var(--accent-purple), 0 0 50px rgba(167, 139, 250, 0.4)";
                card.style.borderColor = "var(--accent-purple)";
              } else {
                card.classList.remove("sentiment-favored");
                card.style.boxShadow = "";
                card.style.borderColor = "";
              }
            });
        }

        // --- CHARTING ---
        function destroyActiveCharts() {
          Object.values(activeCharts).forEach((chart) => {
            if (chart) chart.destroy();
          });
          activeCharts = {};
        }

        function createPortfolioChart(canvasId) {
          const ctx = document.getElementById(canvasId).getContext("2d");
          const gradient = ctx.createLinearGradient(0, 0, 0, 100);
          gradient.addColorStop(0, "rgba(56, 139, 253, 0.3)");
          gradient.addColorStop(1, "rgba(56, 139, 253, 0)");

          const data = Array.from(
            { length: 30 },
            () => Math.random() * 1000 + 1250000
          );

          activeCharts["portfolio"] = new Chart(ctx, {
            type: "line",
            data: {
              labels: Array(data.length).fill(""),
              datasets: [
                {
                  data: data,
                  borderColor: "var(--accent-blue)",
                  borderWidth: 2,
                  fill: true,
                  backgroundColor: gradient,
                  tension: 0.4,
                  pointRadius: 0,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  enabled: true,
                  backgroundColor: "rgba(10, 14, 23, 0.9)",
                  displayColors: false,
                  callbacks: {
                    label: (context) =>
                      `${t("Total Assets")}: ${formatPrice(context.parsed.y)}`,
                  },
                },
              },
              interaction: { intersect: false, mode: "index" },
              scales: { x: { display: false }, y: { display: false } },
              animation: { duration: 300, easing: "easeOutQuart" },
            },
          });
        }

        function createAllocationBarChart(canvasId, strategyId, weights) {
          const ctx = document.getElementById(canvasId)?.getContext("2d");
          if (!ctx) return;

          const sortedWeights = Object.entries(weights).sort(
            ([, a], [, b]) => Math.abs(b) - Math.abs(a)
          );

          const labels = sortedWeights.map(([ticker]) => ticker.toUpperCase());
          const data = sortedWeights.map(([, weight]) => weight);

          const backgroundColors = data.map((weight) =>
            weight >= 0 ? "rgba(35, 134, 54, 0.6)" : "rgba(218, 54, 51, 0.6)"
          );
          const borderColors = data.map((weight) =>
            weight >= 0 ? "rgba(35, 134, 54, 1)" : "rgba(218, 54, 51, 1)"
          );

          activeCharts[`bar-${strategyId}`] = new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Weight",
                  data: data,
                  backgroundColor: backgroundColors,
                  borderColor: borderColors,
                  borderWidth: 1,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  grid: { color: "var(--border-color)" },
                  ticks: {
                    color: "var(--text-secondary)",
                    callback: (value) => (value * 100).toFixed(0) + "%",
                  },
                },
                y: {
                  grid: { display: false },
                  ticks: { color: "var(--text-primary)" },
                },
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  enabled: true,
                  callbacks: {
                    label: function (context) {
                      let label = context.dataset.label || "";
                      if (label) {
                        label += ": ";
                      }
                      if (context.parsed.x !== null) {
                        label += (context.parsed.x * 100).toFixed(2) + "%";
                      }
                      return label;
                    },
                  },
                },
              },
              interaction: { intersect: false, mode: "index" },
              animation: { duration: 300, easing: "easeOutQuart" },
            },
          });
        }

        // --- MODAL & UI LOGIC ---
        function setupEventListeners() {
          const closeStrategyBtn = document.getElementById("closeStrategyModalBtn");
          closeStrategyBtn?.addEventListener("click", () => closeModal("strategyDetailModal"));
          const closeAiBtn = document.getElementById("closeAiModalBtn");
          closeAiBtn?.addEventListener("click", () => closeModal("aiAnalysisModal"));
          const closeWalletModalBtn = document.getElementById("closeWalletModalBtn");
          closeWalletModalBtn?.addEventListener("click", () => closeModal("walletModal"));
          const compareBtn = document.getElementById("compareAllBtn");
          compareBtn?.addEventListener("click", showComparisonDetail);
          document
            .getElementById("theme-toggle")
            .addEventListener("click", toggleTheme);
          document
            .getElementById("colorblind-toggle")
            .addEventListener("click", toggleColorblindMode);
          document
            .getElementById("language-toggle")
            .addEventListener("click", toggleLanguage);
          const sentimentToggle = document.getElementById("sentiment-toggle");
          const sentimentToggleHeader = document.getElementById("sentiment-toggle-header");

          // Sync both toggles
          sentimentToggle?.addEventListener("change", function() {
            if (sentimentToggleHeader) {
              sentimentToggleHeader.checked = this.checked;
            }
            applySentimentOverlay();
          });

          sentimentToggleHeader?.addEventListener("change", function() {
            if (sentimentToggle) {
              sentimentToggle.checked = this.checked;
            }
            applySentimentOverlay();
          });
          const navLinks = document.querySelectorAll(".top-nav-link");
          navLinks.forEach((link) => {
            link.addEventListener("click", (event) => {
              const target = event.currentTarget.dataset.nav;
              if (target === "wallet") {
                event.preventDefault();
                document.getElementById("walletOrb")?.click();
                return;
              }
              handlePrimaryNavigation(target);
            });
          });
          document.getElementById("walletNavLink")?.addEventListener("click", (event) => {
            event.preventDefault();
            document.getElementById("walletOrb")?.click();
          });
          document.getElementById("refreshNewsBtn")?.addEventListener("click", () => renderMarketNewsCard(true));
          document.getElementById("notificationBell")?.addEventListener("click", () => {
            renderMarketNewsCard(true);
          });

          // Quick Action Buttons
          const quickActionBtns = document.querySelectorAll(".quick-action-btn");
          quickActionBtns.forEach((btn, index) => {
            btn.addEventListener("click", () => {
              const actions = ["Rebalance", "Analytics", "Export", "Alerts"];
              const actionName = actions[index] || "Action";

              // Simple feedback animation
              btn.style.transform = "scale(0.95)";
              setTimeout(() => {
                btn.style.transform = "";
              }, 150);

              // Show notification
              console.log(`${actionName} action triggered`);

              // You can add specific logic for each action here
              if (actionName === "Analytics") {
                document.getElementById("advancedAnalyticsSection")?.scrollIntoView({ behavior: "smooth" });
              } else if (actionName === "Rebalance") {
                document.getElementById("portfolioAIAgentSection")?.scrollIntoView({ behavior: "smooth" });
              }
            });
          });

          // Comparison section toggle
          const toggleBtn = document.getElementById("toggleComparisonBtn");
          const analyticsContent = document.getElementById("advanced-analytics-content");
          if (toggleBtn && analyticsContent) {
            toggleBtn.addEventListener("click", () => {
              const isHidden = analyticsContent.classList.contains("hidden");
              analyticsContent.classList.toggle("hidden");
              toggleBtn.setAttribute("aria-expanded", isHidden ? "true" : "false");
              const toggleText = toggleBtn.querySelector(".toggle-text");
              if (toggleText) {
                toggleText.textContent = isHidden ? t("Hide") : t("Show");
              }
            });
          }
          
          // Image gallery event listeners
          document.querySelectorAll(".image-modal-trigger").forEach((trigger) => {
            trigger.addEventListener("click", (e) => {
              e.preventDefault();
              const imageSrc = trigger.dataset.imageSrc;
              const imageTitleKey = trigger.dataset.imageTitleKey || trigger.dataset.imageTitle;
              if (imageSrc) {
                const imageTitle = imageTitleKey ? t(imageTitleKey) : "Image";
                openImageModal(imageSrc, imageTitle);
              }
            });
          });
          
          // Gallery navigation buttons
          const galleryPrevBtn = document.getElementById("galleryPrevBtn");
          const galleryNextBtn = document.getElementById("galleryNextBtn");
          const closeGalleryBtn = document.getElementById("closeGalleryBtn");
          
          if (galleryPrevBtn) {
            galleryPrevBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              galleryPrevious();
            });

          initWalletDrawer();
          initAssistantChat();

          // Initialize sentiment overlay on page load
          applySentimentOverlay();
          }

        function populateWalletHistoryList() {
          const list = document.getElementById("walletHistoryList");
          if (!list) return;
          list.innerHTML = walletActivity
            .map((item) => {
              const accentClass =
                item.accent === "positive"
                  ? "text-gain"
                  : item.accent === "negative"
                  ? "text-loss"
                  : "text-secondary";
              return `
              <li class="wallet-history-item flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="wallet-history-dot ${accentClass}"></span>
                  <div>
                    <p class="font-semibold">${item.type}</p>
                    <p class="text-xs text-secondary">${item.meta}</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="font-mono ${accentClass}">${item.amount}</p>
                  <p class="text-xs text-secondary">${item.time}</p>
                </div>
              </li>
              `;
            })
            .join("");
        }

        function initWalletDrawer() {
          const walletOrb = document.getElementById("walletOrb");
          const drawer = document.getElementById("walletDrawer");
          const overlay = document.getElementById("walletDrawerOverlay");
          const closeBtn = document.getElementById("closeWalletDrawer");

          if (!walletOrb || !drawer || !overlay) return;
          populateWalletHistoryList();

          const toggleDrawer = (open) => {
            drawer.classList.toggle("open", open);
            overlay.classList.toggle("hidden", !open);
            walletOrb.setAttribute("aria-expanded", open ? "true" : "false");
            drawer.setAttribute("aria-hidden", open ? "false" : "true");
          };

          walletOrb.addEventListener("click", () => {
            walletOrb.classList.add("wallet-orb--active");
            toggleDrawer(true);
            setTimeout(() => walletOrb.classList.remove("wallet-orb--active"), 480);
          });

          overlay.addEventListener("click", () => toggleDrawer(false));
          closeBtn?.addEventListener("click", () => toggleDrawer(false));

          document.addEventListener("keydown", (event) => {
            if (event.key === "Escape") {
              toggleDrawer(false);
            }
          });
        }

        // ============================================================
        // AI API Configuration
        // ============================================================
        // To enable the Smart Assistant AI features:
        // 1. Go to https://platform.openai.com/api-keys
        // 2. Create an account or sign in
        // 3. Click "Create new secret key"
        // 4. Copy your API key and replace 'YOUR_OPENAI_API_KEY_HERE' below
        // 5. Save this file and refresh your browser
        //
        // Note: Keep your API key secure and never commit it to public repositories
        // Estimated cost: ~$0.001-0.01 per conversation (very affordable)
        // ============================================================
        const AI_CONFIG = {
          apiKey: 'YOUR_OPENAI_API_KEY_HERE', // âš ï¸ REPLACE THIS WITH YOUR ACTUAL OPENAI API KEY
          model: 'gpt-4o-mini', // Using GPT-4o-mini for cost-effective, fast responses
          endpoint: 'https://api.openai.com/v1/chat/completions'
        };

        function getPortfolioContext() {
          // Gather all current portfolio data to send to AI
          const totalValue = document.getElementById("total-value")?.textContent || "$0";
          const todayChange = document.getElementById("today-change")?.textContent || "0%";
          const totalGain = document.getElementById("total-gain")?.textContent || "$0";
          const sentimentCard = document.getElementById("marketSentimentCard");
          const fngValue = sentimentCard?.dataset.sentimentValue || "50";
          const fngLabel = document.getElementById("sentimentBadge")?.textContent || "Neutral";

          // Get holdings data
          const holdings = Array.from(document.querySelectorAll('.holding-row')).map(row => {
            const symbol = row.querySelector('.font-semibold')?.textContent || '';
            const value = row.querySelector('.holding-stat-value')?.textContent || '';
            return `${symbol}: ${value}`;
          }).join(', ');

          // Get active strategies
          const strategies = Array.from(document.querySelectorAll('.strategy-card')).map(card => {
            const name = card.querySelector('h4')?.textContent || '';
            const type = card.dataset.strategyType || '';
            return `${name} (${type})`;
          }).join(', ');

          return {
            totalValue,
            todayChange,
            totalGain,
            marketSentiment: `${fngLabel} (${fngValue}/100)`,
            holdings: holdings || 'No holdings',
            strategies: strategies || 'No strategies'
          };
        }

        async function callAI(userMessage, context) {
          const systemPrompt = `You are Zentryx, an expert cryptocurrency portfolio management AI assistant. You help users make informed decisions about their crypto investments.

Current Portfolio Context:
- Total Portfolio Value: ${context.totalValue}
- Today's Change: ${context.todayChange}
- Total Gain/Loss: ${context.totalGain}
- Market Sentiment (Fear & Greed): ${context.marketSentiment}
- Current Holdings: ${context.holdings}
- Active Strategies: ${context.strategies}

Provide concise, actionable advice. Focus on risk management, diversification, and market timing. When relevant, reference the user's current holdings and market conditions.`;

          try {
            const response = await fetch(AI_CONFIG.endpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${AI_CONFIG.apiKey}`
              },
              body: JSON.stringify({
                model: AI_CONFIG.model,
                messages: [
                  { role: 'system', content: systemPrompt },
                  { role: 'user', content: userMessage }
                ],
                temperature: 0.7,
                max_tokens: 500
              })
            });

            if (!response.ok) {
              const errorData = await response.json().catch(() => ({}));
              if (response.status === 401) {
                throw new Error('Invalid API key. Please configure your OpenAI API key in the AI_CONFIG section.');
              } else if (response.status === 429) {
                throw new Error('Rate limit exceeded. Please try again in a moment.');
              }
              throw new Error(errorData.error?.message || `API error: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
          } catch (error) {
            console.error('AI API Error:', error);
            if (error.message.includes('Failed to fetch')) {
              throw new Error('Unable to connect to AI service. Please check your internet connection.');
            }
            throw error;
          }
        }

        function initAssistantChat() {
          const fab = document.getElementById("assistantFab");
          const panel = document.getElementById("assistantChatPanel");
          const closeBtn = document.getElementById("assistantChatClose");
          const form = document.getElementById("assistantChatForm");
          const input = document.getElementById("assistantChatInput");

          if (!fab || !panel || !form) return;

          const setOpen = (open) => {
            panel.classList.toggle("hidden", !open);
            fab.setAttribute("aria-expanded", open ? "true" : "false");
            if (open) {
              panel.classList.add("assistant-chat--visible");
              input?.focus();
            } else {
              panel.classList.remove("assistant-chat--visible");
            }
          };

          fab.addEventListener("click", () => {
            const shouldOpen = panel.classList.contains("hidden");
            setOpen(shouldOpen);
          });

          closeBtn?.addEventListener("click", () => setOpen(false));

          form.addEventListener("submit", async (event) => {
            event.preventDefault();
            const value = input.value.trim();
            if (!value) return;

            // Show user message
            appendAssistantMessage("user", value);
            input.value = "";

            // Check if API key is configured
            if (AI_CONFIG.apiKey === 'YOUR_OPENAI_API_KEY_HERE') {
              appendAssistantMessage(
                "assistant",
                "âš ï¸ AI Assistant is not configured. Please add your OpenAI API key to the AI_CONFIG section in the code. Get your API key at: https://platform.openai.com/api-keys"
              );
              return;
            }

            // Show loading message
            const loadingMsg = appendAssistantMessage("assistant", "ğŸ¤” Analyzing your portfolio and market conditions...");

            try {
              // Get portfolio context and call AI
              const context = getPortfolioContext();
              const aiResponse = await callAI(value, context);

              // Remove loading message and show AI response
              loadingMsg.remove();
              appendAssistantMessage("assistant", aiResponse);
            } catch (error) {
              // Remove loading message and show error
              loadingMsg.remove();
              appendAssistantMessage("assistant", `âŒ Error: ${error.message}`);
            }
          });
        }

        function appendAssistantMessage(role, text) {
          const body = document.getElementById("assistantChatBody");
          if (!body) return null;
          const wrapper = document.createElement("div");
          wrapper.className =
            role === "user"
              ? "assistant-message assistant-message--user"
              : "assistant-message";
          const author = role === "user" ? "You" : "Zentryx AI";
          wrapper.innerHTML = `
            <p class="text-xs text-secondary mb-1">${author}</p>
            <p class="text-sm">${text}</p>
          `;
          body.appendChild(wrapper);
          body.scrollTop = body.scrollHeight;
          return wrapper;
        }
          
          if (galleryNextBtn) {
            galleryNextBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              galleryNext();
            });
          }
          
          if (closeGalleryBtn) {
            closeGalleryBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              closeImageGallery();
            });
          }
          
          // Keyboard navigation for gallery
          document.addEventListener("keydown", (e) => {
            const galleryModal = document.getElementById("imageGalleryModal");
            if (galleryModal && !galleryModal.classList.contains("hidden")) {
              if (e.key === "Escape") {
                closeImageGallery();
              } else if (e.key === "ArrowLeft") {
                galleryPrevious();
              } else if (e.key === "ArrowRight") {
                galleryNext();
              }
            }
          });
          
          // Touch/swipe support for gallery
          let touchStartX = 0;
          let touchEndX = 0;
          
          const galleryMainImage = document.getElementById("gallery-main-image");
          if (galleryMainImage) {
            galleryMainImage.addEventListener("touchstart", (e) => {
              touchStartX = e.changedTouches[0].screenX;
            });
            
            galleryMainImage.addEventListener("touchend", (e) => {
              touchEndX = e.changedTouches[0].screenX;
              handleSwipe();
            });
          }
          
          function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
              if (diff > 0) {
                // Swipe left - next image
                galleryNext();
              } else {
                // Swipe right - previous image
                galleryPrevious();
              }
            }
          }
          
          // Close gallery on background click (but not on image click)
          const galleryModal = document.getElementById("imageGalleryModal");
          if (galleryModal) {
            galleryModal.addEventListener("click", (e) => {
              // Only close if clicking the backdrop, not the content
              if (e.target === galleryModal) {
                closeImageGallery();
              }
            });
          }
        }

        /**
         * Open modal dialog
         * @param {string} modalId - ID of the modal element
         */
        function openModal(modalId) {
          const modal = document.getElementById(modalId);
          if (!modal) {
            console.error(`Modal with ID ${modalId} not found`);
            return;
          }
          
          modal.classList.remove("hidden");
          modal.classList.add("flex");
          modal.setAttribute("aria-hidden", "false");
          
          // Focus management for accessibility
          const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (firstFocusable) {
            firstFocusable.focus();
          }
          
          // Prevent body scroll when modal is open
          document.body.style.overflow = "hidden";
          
          setTimeout(() => modal.classList.remove("opacity-0"), 10);
        }
        
        /**
         * Close modal dialog
         * @param {string} modalId - ID of the modal element
         */
        function closeModal(modalId) {
          destroyActiveCharts();
          const modal = document.getElementById(modalId);
          if (!modal) {
            console.error(`Modal with ID ${modalId} not found`);
            return;
          }
          
          modal.classList.add("opacity-0");
          modal.setAttribute("aria-hidden", "true");
          
          // Restore body scroll
          document.body.style.overflow = "";
          
          setTimeout(() => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
          }, 300);
        }

        // Close modal on Escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            const openModals = document.querySelectorAll('[role="dialog"][aria-hidden="false"]');
            openModals.forEach((modal) => {
              const modalId = modal.id;
              if (modalId) {
                closeModal(modalId);
              }
            });
          }
        });

        /**
         * Show comparison detail (now redirects to section on page)
         */
        function showComparisonDetail() {
          const section = document.getElementById("strategyComparisonSection");
          if (section) {
            section.scrollIntoView({ behavior: "smooth", block: "start" });
            // Highlight the section briefly
            section.style.transition = "box-shadow 0.3s";
            section.style.boxShadow = "0 0 20px var(--accent-blue)";
            setTimeout(() => {
              section.style.boxShadow = "";
            }, 2000);
          }
        }
        
        /**
         * Image Gallery State
         */
        let currentGallery = [];
        let currentGalleryIndex = 0;
        
        /**
         * Open image gallery with swipe support
         * @param {Array} images - Array of image objects {src, title}
         * @param {number} startIndex - Starting image index
         */
        function openImageGallery(images, startIndex = 0) {
          if (!images || images.length === 0) return;
          
          currentGallery = images;
          currentGalleryIndex = startIndex >= 0 && startIndex < images.length ? startIndex : 0;
          
          const modal = document.getElementById("imageGalleryModal");
          const mainImage = document.getElementById("gallery-main-image");
          const title = document.getElementById("gallery-modal-title");
          const counter = document.getElementById("gallery-counter");
          const thumbnails = document.getElementById("gallery-thumbnails");
          
          if (!modal || !mainImage) return;
          
          // Load main image
          loadGalleryImage(currentGalleryIndex);
          
          // Update counter
          if (counter) {
            counter.textContent = `${currentGalleryIndex + 1} / ${images.length}`;
          }
          
          // Update title
          if (title && images[currentGalleryIndex]) {
            title.textContent = images[currentGalleryIndex].title || "";
          }
          
          // Build thumbnails
          if (thumbnails) {
            thumbnails.innerHTML = images.map((img, idx) => `
              <img
                src="${img.src}"
                alt="${img.title || ''}"
                class="gallery-thumbnail ${idx === currentGalleryIndex ? 'active' : ''}"
                data-index="${idx}"
                loading="lazy"
              />
            `).join("");
            
            // Thumbnail click handlers
            thumbnails.querySelectorAll(".gallery-thumbnail").forEach((thumb, idx) => {
              thumb.addEventListener("click", () => {
                currentGalleryIndex = idx;
                loadGalleryImage(idx);
                updateGalleryUI();
              });
            });
          }
          
          // Show modal
          modal.classList.remove("hidden");
          modal.classList.add("flex");
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
          
          updateGalleryNavigation();
        }
        
        /**
         * Load gallery image at index
         */
        function loadGalleryImage(index) {
          if (index < 0 || index >= currentGallery.length) return;
          
          const mainImage = document.getElementById("gallery-main-image");
          const title = document.getElementById("gallery-modal-title");
          const loading = document.getElementById("gallery-loading");
          const counter = document.getElementById("gallery-counter");
          
          if (!mainImage) return;
          
          // Show loading
          if (loading) loading.classList.remove("hidden");
          
          const image = currentGallery[index];
          if (image) {
            // Create new image to preload
            const img = new Image();
            img.onload = () => {
              mainImage.src = image.src;
              mainImage.alt = image.title || "";
              // Ensure image displays fully
              mainImage.style.width = "auto";
              mainImage.style.height = "auto";
              mainImage.style.maxWidth = "90vw";
              mainImage.style.maxHeight = "80vh";
              mainImage.style.objectFit = "contain";
              mainImage.style.objectPosition = "center";
              mainImage.style.display = "block";
              
              if (title) title.textContent = image.title || "";
              if (counter) counter.textContent = `${index + 1} / ${currentGallery.length}`;
              if (loading) loading.classList.add("hidden");
              
              // Add fade-in effect
              mainImage.style.opacity = "0";
              setTimeout(() => {
                mainImage.style.opacity = "1";
                mainImage.style.transition = "opacity 0.3s ease";
              }, 50);
            };
            img.onerror = () => {
              if (loading) loading.classList.add("hidden");
              console.error("Failed to load image:", image.src);
            };
            img.src = image.src;
          }
        }
        
        /**
         * Update gallery UI (thumbnails, navigation)
         */
        function updateGalleryUI() {
          // Update thumbnails
          const thumbnails = document.querySelectorAll(".gallery-thumbnail");
          thumbnails.forEach((thumb, idx) => {
            if (idx === currentGalleryIndex) {
              thumb.classList.add("active");
              thumb.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "center" });
            } else {
              thumb.classList.remove("active");
            }
          });
          
          updateGalleryNavigation();
        }
        
        /**
         * Update gallery navigation buttons
         */
        function updateGalleryNavigation() {
          const prevBtn = document.getElementById("galleryPrevBtn");
          const nextBtn = document.getElementById("galleryNextBtn");
          
          if (prevBtn) {
            prevBtn.disabled = currentGalleryIndex === 0;
          }
          if (nextBtn) {
            nextBtn.disabled = currentGalleryIndex === currentGallery.length - 1;
          }
        }
        
        /**
         * Navigate to previous image
         */
        function galleryPrevious() {
          if (currentGalleryIndex > 0) {
            currentGalleryIndex--;
            loadGalleryImage(currentGalleryIndex);
            updateGalleryUI();
          }
        }
        
        /**
         * Navigate to next image
         */
        function galleryNext() {
          if (currentGalleryIndex < currentGallery.length - 1) {
            currentGalleryIndex++;
            loadGalleryImage(currentGalleryIndex);
            updateGalleryUI();
          }
        }
        
        /**
         * Close image gallery
         */
        function closeImageGallery() {
          const modal = document.getElementById("imageGalleryModal");
          if (!modal) return;
          
          modal.classList.add("hidden");
          modal.classList.remove("flex");
          modal.setAttribute("aria-hidden", "true");
          document.body.style.overflow = "";
          
          currentGallery = [];
          currentGalleryIndex = 0;
        }
        
        /**
         * Legacy function for single image modal (now uses gallery)
         */
        function openImageModal(imageSrc, title) {
          openImageGallery([{ src: imageSrc, title: title }], 0);
        }
        
        /**
         * Legacy function for closing image modal
         */
        function closeImageModal() {
          closeImageGallery();
        }

        function showWalletModal() {
          const walletOptionsContainer =
            document.getElementById("walletOptions");
          const wallets = [
            {
              name: "MetaMask",
              icon: "https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg",
            },
            {
              name: "Coinbase Wallet",
              icon: "https://upload.wikimedia.org/wikipedia/commons/c/c7/Coinbase_Wallet_Logo.svg",
            },
            {
              name: "Trust Wallet",
              icon: "https://trustwallet.com/assets/images/media/assets/TWT.svg",
            },
            {
              name: "Ledger",
              icon: "https://www.ledger.com/wp-content/uploads/2021/11/Ledger_Monogram_black.svg",
            },
            {
              name: "Trezor",
              icon: "https://trezor.io/img/trezor_logo_black.svg",
            },
            {
              name: "WalletConnect",
              icon: "https://walletconnect.com/meta/walletconnect-logo.svg",
            },
          ];
          walletOptionsContainer.innerHTML = wallets
            .map(
              (wallet) => `
            <button class="flex flex-col items-center p-4 bg-bg-secondary rounded-lg hover:bg-border-color transition-colors">
                <img src="${wallet.icon}" class="w-12 h-12 mb-2" alt="${wallet.name} logo">
                <span class="text-xs font-semibold">${wallet.name}</span>
            </button>
        `
            )
            .join("");
          openModal("walletModal");
        }

        async function showStrategyDetail(strategyId) {
          const strategy = strategies[strategyId];
          const contentDiv = document.getElementById("strategyDetailContent");

          const kpiCard = (title, value, icon) => `
            <div class="glass-card p-4 rounded-lg">
                <div class="flex items-center text-secondary text-sm mb-2">
                    ${icon}
                    <span>${title}</span>
                </div>
                <div class="text-4xl font-semibold">${value}</div>
            </div>
        `;

          const allMetricsHtml = Object.entries(strategy.metrics)
            .map(
              ([k, v]) =>
                `<div class="flex justify-between text-sm py-2.5 border-b border-border-color last:border-b-0"><span class="text-secondary">${k}</span><span class="font-mono">${v}</span></div>`
            )
            .join("");

          // Prepare image gallery data
          const imageGallery = [
            { key: "dashboard", title: "Performance Dashboard", src: strategy.images?.dashboard },
            { key: "cumulative", title: "Cumulative Return", src: strategy.images?.cumulative },
            { key: "underwater", title: "Underwater Chart", src: strategy.images?.underwater },
            { key: "weekly_returns", title: "Weekly Returns", src: strategy.images?.weekly_returns },
            { key: "rolling_vol", title: "Rolling Volatility", src: strategy.images?.rolling_vol },
            { key: "distribution", title: "Returns Distribution", src: strategy.images?.distribution },
          ].filter(img => img.src); // Only include images that exist
          
          const galleryItems = imageGallery.map((img, idx) => `
            <div class="gallery-item cursor-pointer group relative overflow-hidden rounded-lg border-2 border-transparent hover:border-accent-blue transition-all flex-shrink-0" data-gallery-index="${idx}" style="width: 280px; scroll-snap-align: start;">
              <img 
                src="${img.src}" 
                alt="${img.title}"
                class="w-full h-48 object-cover transition-transform group-hover:scale-110"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center">
                <div class="text-white opacity-0 group-hover:opacity-100 transition-opacity text-center px-4">
                  <p class="font-semibold text-sm">${img.title}</p>
                  <p class="text-xs mt-1">ç‚¹å‡»æŸ¥çœ‹ / Click to view</p>
                </div>
              </div>
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3">
                <p class="text-white text-xs font-medium truncate">${img.title}</p>
              </div>
            </div>
          `).join("");

          // Generate strategy introduction
          const strategyIntro = await generateStrategyIntroduction(strategy, strategyId);
          const strategyIntroHelperText =
            currentLanguage === "zh"
              ? "ç³»ç»Ÿæ ¹æ®ç­–ç•¥ç‰¹æ€§å’Œå†å²è¡¨ç°ç”Ÿæˆä»¥ä¸‹ç®€ä»‹ã€‚"
              : "This overview is generated by the system based on strategy characteristics and historical performance.";

          let detailHtml = `
            <div class="border-b border-border-color pb-6 mb-6">
                <h2 class="text-4xl font-bold mb-3" style="color: var(--text-primary);">${strategy.name}</h2>
                <p class="text-lg mb-4" style="color: var(--text-secondary); max-width: 3xl;">${strategy.description}</p>
                
                <!-- Strategy Introduction Section -->
                <div class="glass-card p-6 rounded-xl mb-6" style="background: var(--card-bg); border: 2px solid var(--border-color);">
                    <div class="mb-4">
                        <h3 class="text-xl font-bold" style="color: var(--text-primary);" data-translate="Strategy Introduction">ç­–ç•¥ä»‹ç» / Strategy Introduction</h3>
                        <p class="text-sm mt-1" style="color: var(--text-secondary);">${strategyIntroHelperText}</p>
                    </div>
                    <div id="strategy-intro-content" class="space-y-4" style="color: var(--text-secondary); line-height: 1.8;">
                        ${strategyIntro}
                    </div>
                    <div id="strategy-intro-loading" class="hidden text-center py-8">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-sm" style="color: var(--text-secondary);" data-translate="Generating introduction...">æ­£åœ¨ç”Ÿæˆä»‹ç»...</p>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                ${kpiCard(
                  "Annualized Return",
                  strategy.metrics["Annualized Return"],
                  `<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>`
                )}
                ${kpiCard(
                  "Annualized Volatility",
                  strategy.metrics["Annualized Volatility"],
                  `<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12h6l3-9 6 18 3-9h6"></path></svg>`
                )}
                ${kpiCard(
                  "Sharpe Ratio",
                  strategy.metrics["Sharpe Ratio"],
                  `<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
                )}
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Left Column - Image Gallery Preview -->
                <div class="lg:col-span-2 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold" style="color: var(--text-primary);">Performance Charts</h3>
                        <button id="viewAllChartsBtn" class="btn-secondary text-sm px-4 py-2 rounded-lg hover:bg-accent-blue hover:text-white transition-colors">
                            æŸ¥çœ‹å…¨éƒ¨å›¾è¡¨ / View All Charts
                        </button>
                    </div>
                    <div class="relative mb-6">
                        <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent" id="strategy-gallery-preview" style="scrollbar-width: thin; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;">
                            ${galleryItems}
                    </div>
                        <!-- Scroll indicators -->
                        <button class="gallery-scroll-btn gallery-scroll-left absolute left-0 top-1/2 -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-900 rounded-full p-2 shadow-lg transition-all z-10 hidden" id="gallery-scroll-left" aria-label="Scroll left">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <button class="gallery-scroll-btn gallery-scroll-right absolute right-0 top-1/2 -translate-y-1/2 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-900 rounded-full p-2 shadow-lg transition-all z-10 hidden" id="gallery-scroll-right" aria-label="Scroll right">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                </div>
                    
                    <!-- Main Image Display -->
                    <div class="glass-card p-6 rounded-xl mb-6" style="min-height: 500px; background: var(--card-bg); border: 2px solid var(--border-color);">
                        <div id="strategy-main-image-container" class="flex items-center justify-center h-full min-h-[500px] w-full">
                            <img 
                                id="strategy-main-image" 
                                src="${imageGallery[0]?.src || ''}" 
                                alt="${imageGallery[0]?.title || 'Chart'}"
                                class="w-full h-auto max-h-[600px] object-contain rounded-lg shadow-lg cursor-zoom-in transition-transform hover:scale-[1.02]"
                                style="object-fit: contain; object-position: center; display: block;"
                            />
                        </div>
                        <div class="mt-4 text-center">
                            <p id="strategy-image-title" class="font-semibold text-lg" style="color: var(--text-primary);">${imageGallery[0]?.title || ''}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column for Data -->
                <div class="lg:col-span-1 flex flex-col gap-6">
                    <div class="glass-card p-4 rounded-xl">
                        <h3 class="font-semibold mb-4 text-lg" style="color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">Full Performance Metrics</h3>
                        <div style="color: var(--text-secondary);">
                            ${allMetricsHtml}
                        </div>
                    </div>
                    <div class="glass-card p-4 rounded-xl flex-grow flex flex-col">
                        <h3 class="font-semibold mb-3 text-lg" style="color: var(--text-primary);">Strategy Allocation</h3>
                        <div class="flex-grow min-h-[300px]">
                            <canvas id="modal-bar-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        `;

          contentDiv.innerHTML = detailHtml;

          // Store gallery data for this strategy
          window.currentStrategyGallery = imageGallery;
          
          // Gallery preview click handlers
          document.querySelectorAll(".gallery-item").forEach((item, idx) => {
            item.addEventListener("click", () => {
              const image = imageGallery[idx];
              if (image) {
                const mainImage = document.getElementById("strategy-main-image");
                const imageTitle = document.getElementById("strategy-image-title");
                if (mainImage) {
                  mainImage.src = image.src;
                  mainImage.alt = image.title;
                }
                if (imageTitle) {
                  imageTitle.textContent = image.title;
                }
                // Update active state
                document.querySelectorAll(".gallery-item").forEach(i => i.classList.remove("border-accent-blue", "ring-2", "ring-accent-blue"));
                item.classList.add("border-accent-blue", "ring-2", "ring-accent-blue");
              }
            });
          });
          
          // Main image click to open gallery
          const mainImage = document.getElementById("strategy-main-image");
          if (mainImage) {
            mainImage.addEventListener("click", () => {
              const currentIndex = imageGallery.findIndex(img => img.src === mainImage.src);
              openImageGallery(imageGallery, currentIndex >= 0 ? currentIndex : 0);
            });
          }
          
          // View all charts button
          const viewAllBtn = document.getElementById("viewAllChartsBtn");
          if (viewAllBtn) {
            viewAllBtn.addEventListener("click", () => {
              openImageGallery(imageGallery, 0);
            });
          }
          
          // Setup gallery scroll functionality
          const galleryPreview = document.getElementById("strategy-gallery-preview");
          const scrollLeftBtn = document.getElementById("gallery-scroll-left");
          const scrollRightBtn = document.getElementById("gallery-scroll-right");
          
          if (galleryPreview) {
            // Show/hide scroll buttons based on scroll position
            const updateScrollButtons = () => {
              if (!galleryPreview) return;
              const { scrollLeft, scrollWidth, clientWidth } = galleryPreview;
              
              if (scrollLeftBtn) {
                scrollLeftBtn.classList.toggle("hidden", scrollLeft === 0);
              }
              if (scrollRightBtn) {
                scrollRightBtn.classList.toggle("hidden", scrollLeft + clientWidth >= scrollWidth - 10);
              }
            };
            
            // Initial check
            updateScrollButtons();
            
            // Update on scroll
            galleryPreview.addEventListener("scroll", updateScrollButtons);
            
            // Update on resize
            window.addEventListener("resize", updateScrollButtons);
            
            // Scroll buttons
            if (scrollLeftBtn) {
              scrollLeftBtn.addEventListener("click", () => {
                galleryPreview.scrollBy({ left: -300, behavior: "smooth" });
              });
            }
            
            if (scrollRightBtn) {
              scrollRightBtn.addEventListener("click", () => {
                galleryPreview.scrollBy({ left: 300, behavior: "smooth" });
              });
            }
          }

          openModal("strategyDetailModal");
          setTimeout(() => {
            createAllocationBarChart(
              "modal-bar-chart",
              strategyId,
              strategy.weights
            );
          }, 100);
        }

        /**
         * Generate strategy introduction using intelligent summary
         * @param {Object} strategy - Strategy object
         * @param {string} strategyId - Strategy ID
         * @returns {Promise<string>} HTML content for strategy introduction
         */
        async function generateStrategyIntroduction(strategy, strategyId) {
          // Check if we have cached introduction
          const cacheKey = `strategy_intro_${strategyId}_${currentLanguage}`;
          const cached = localStorage.getItem(cacheKey);
          if (cached) {
            try {
              const cachedData = JSON.parse(cached);
              // Check if cache is less than 24 hours old
              if (Date.now() - cachedData.timestamp < 24 * 60 * 60 * 1000) {
                return cachedData.content;
              }
            } catch (e) {
              console.error("Error parsing cached introduction:", e);
            }
          }
          
          // Strategy descriptions based on project report data
          const strategyDescriptions = {
            msrp: {
              en: `
                <h4 class="font-semibold text-lg mb-3" style="color: var(--text-primary);">Max Sharpe Ratio Portfolio (MSRP)</h4>
                <p class="mb-4">The Max Sharpe Ratio Portfolio (MSRP) is an aggressive investment strategy designed to maximize risk-adjusted returns by optimizing the Sharpe ratio, which measures excess return per unit of risk. This strategy uses modern portfolio theory to find the optimal asset allocation that delivers the highest return for a given level of risk.</p>
                <p class="mb-3"><strong>How It Works:</strong></p>
                <p class="mb-3">The MSRP strategy employs mathematical optimization techniques to construct a portfolio that maximizes the Sharpe ratio. It analyzes historical returns, volatilities, and correlations between assets to determine the optimal weight allocation. The strategy may take both long and short positions to hedge risk and improve risk-adjusted returns.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1.5 mb-4 ml-4">
                  <li>Optimizes portfolio allocation to maximize the Sharpe ratio, balancing returns against volatility</li>
                  <li>May concentrate positions in high-momentum assets that show strong risk-adjusted performance</li>
                  <li>Uses mathematical optimization (quadratic programming) to find optimal asset weights</li>
                  <li>May include short positions to hedge risk and improve risk-adjusted returns</li>
                  <li>Regular rebalancing to maintain optimal allocation</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1.5 mb-4 ml-4">
                  <li>Annualized Return: 325.26% - Exceptional returns compared to benchmark</li>
                  <li>Sharpe Ratio: 3.34 - Strong risk-adjusted performance indicator</li>
                  <li>Annualized Volatility: 0.97 - Moderate volatility relative to returns</li>
                  <li>Max Drawdown: -70.67% - Significant drawdowns during market downturns</li>
                  <li>Annualized Alpha: 1.5944 - Strong outperformance vs. benchmark</li>
                </ul>
                <p class="mb-3"><strong>Risk Profile & Suitability:</strong></p>
                <p class="mb-3">Aggressive - This strategy targets maximum risk-adjusted returns and is suitable for investors who can tolerate significant volatility and drawdowns. It is ideal for investors seeking high returns and who have a long investment horizon. The strategy may experience substantial drawdowns during market downturns but has demonstrated strong risk-adjusted returns over the long term.</p>
                <p class="mb-3"><strong>Best For:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-4 ml-4">
                  <li>Investors seeking maximum risk-adjusted returns</li>
                  <li>Investors with high risk tolerance</li>
                  <li>Long-term investors who can withstand volatility</li>
                  <li>Sophisticated investors familiar with portfolio optimization</li>
                </ul>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-3" style="color: var(--text-primary);">æœ€å¤§å¤æ™®æ¯”ç‡æŠ•èµ„ç»„åˆ (MSRP)</h4>
                <p class="mb-4">æœ€å¤§å¤æ™®æ¯”ç‡æŠ•èµ„ç»„åˆ (MSRP) æ˜¯ä¸€ç§ç§¯æçš„æŠ•èµ„ç­–ç•¥ï¼Œæ—¨åœ¨é€šè¿‡ä¼˜åŒ–å¤æ™®æ¯”ç‡æ¥æœ€å¤§åŒ–é£é™©è°ƒæ•´åçš„å›æŠ¥ã€‚å¤æ™®æ¯”ç‡è¡¡é‡æ¯å•ä½é£é™©çš„è¶…é¢å›æŠ¥ã€‚è¯¥ç­–ç•¥ä½¿ç”¨ç°ä»£æŠ•èµ„ç»„åˆç†è®ºæ¥æ‰¾åˆ°åœ¨ç»™å®šé£é™©æ°´å¹³ä¸‹æä¾›æœ€é«˜å›æŠ¥çš„æœ€ä¼˜èµ„äº§é…ç½®ã€‚</p>
                <p class="mb-3"><strong>å·¥ä½œåŸç†ï¼š</strong></p>
                <p class="mb-3">MSRPç­–ç•¥é‡‡ç”¨æ•°å­¦ä¼˜åŒ–æŠ€æœ¯æ¥æ„å»ºæœ€å¤§åŒ–å¤æ™®æ¯”ç‡çš„æŠ•èµ„ç»„åˆã€‚å®ƒåˆ†æèµ„äº§çš„å†å²å›æŠ¥ã€æ³¢åŠ¨æ€§å’Œç›¸å…³æ€§ï¼Œä»¥ç¡®å®šæœ€ä¼˜æƒé‡åˆ†é…ã€‚è¯¥ç­–ç•¥å¯èƒ½åŒæ—¶æŒæœ‰å¤šå¤´å’Œç©ºå¤´å¤´å¯¸ï¼Œä»¥å¯¹å†²é£é™©å¹¶æ”¹å–„é£é™©è°ƒæ•´åçš„å›æŠ¥ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1.5 mb-4 ml-4">
                  <li>ä¼˜åŒ–æŠ•èµ„ç»„åˆé…ç½®ä»¥æœ€å¤§åŒ–å¤æ™®æ¯”ç‡ï¼Œå¹³è¡¡å›æŠ¥ä¸æ³¢åŠ¨æ€§</li>
                  <li>å¯èƒ½å°†ä»“ä½é›†ä¸­åœ¨è¡¨ç°å‡ºå¼ºåŠ²é£é™©è°ƒæ•´è¡¨ç°çš„é«˜åŠ¨é‡èµ„äº§ä¸Š</li>
                  <li>ä½¿ç”¨æ•°å­¦ä¼˜åŒ–ï¼ˆäºŒæ¬¡è§„åˆ’ï¼‰æ¥æ‰¾åˆ°æœ€ä¼˜èµ„äº§æƒé‡</li>
                  <li>å¯èƒ½åŒ…æ‹¬ç©ºå¤´å¤´å¯¸ä»¥å¯¹å†²é£é™©å¹¶æ”¹å–„é£é™©è°ƒæ•´åçš„å›æŠ¥</li>
                  <li>å®šæœŸå†å¹³è¡¡ä»¥ç»´æŒæœ€ä¼˜é…ç½®</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1.5 mb-4 ml-4">
                  <li>å¹´åŒ–å›æŠ¥ç‡ï¼š325.26% - ç›¸æ¯”åŸºå‡†è¡¨ç°ä¼˜å¼‚</li>
                  <li>å¤æ™®æ¯”ç‡ï¼š3.34 - å¼ºåŠ²çš„é£é™©è°ƒæ•´è¡¨ç°æŒ‡æ ‡</li>
                  <li>å¹´åŒ–æ³¢åŠ¨ç‡ï¼š0.97 - ç›¸å¯¹äºå›æŠ¥çš„ä¸­ç­‰æ³¢åŠ¨æ€§</li>
                  <li>æœ€å¤§å›æ’¤ï¼š-70.67% - åœ¨å¸‚åœºä¸‹è·ŒæœŸé—´å‡ºç°é‡å¤§å›æ’¤</li>
                  <li>å¹´åŒ–Alphaï¼š1.5944 - ç›¸æ¯”åŸºå‡†çš„å¼ºåŠ²è¶…é¢è¡¨ç°</li>
                </ul>
                <p class="mb-3"><strong>é£é™©ç‰¹å¾ä¸é€‚ç”¨æ€§ï¼š</strong></p>
                <p class="mb-3">ç§¯æå‹ - è¯¥ç­–ç•¥ä»¥æœ€å¤§é£é™©è°ƒæ•´å›æŠ¥ä¸ºç›®æ ‡ï¼Œé€‚åˆèƒ½å¤Ÿæ‰¿å—æ˜¾è‘—æ³¢åŠ¨æ€§å’Œå›æ’¤çš„æŠ•èµ„è€…ã€‚å®ƒæœ€é€‚åˆå¯»æ±‚é«˜å›æŠ¥ä¸”å…·æœ‰é•¿æœŸæŠ•èµ„è§†é‡çš„æŠ•èµ„è€…ã€‚è¯¥ç­–ç•¥åœ¨å¸‚åœºä¸‹è·ŒæœŸé—´å¯èƒ½å‡ºç°å¤§å¹…å›æ’¤ï¼Œä½†åœ¨é•¿æœŸå†…å·²æ˜¾ç¤ºå‡ºå¼ºåŠ²çš„é£é™©è°ƒæ•´å›æŠ¥ã€‚</p>
                <p class="mb-3"><strong>æœ€é€‚åˆï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-4 ml-4">
                  <li>å¯»æ±‚æœ€å¤§é£é™©è°ƒæ•´å›æŠ¥çš„æŠ•èµ„è€…</li>
                  <li>å…·æœ‰é«˜é£é™©æ‰¿å—èƒ½åŠ›çš„æŠ•èµ„è€…</li>
                  <li>èƒ½å¤Ÿæ‰¿å—æ³¢åŠ¨æ€§çš„é•¿æœŸæŠ•èµ„è€…</li>
                  <li>ç†Ÿæ‚‰æŠ•èµ„ç»„åˆä¼˜åŒ–çš„æˆç†ŸæŠ•èµ„è€…</li>
                </ul>
              `
            },
            gmvp: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Global Minimum Variance Portfolio (GMVP)</h4>
                <p class="mb-3">The Global Minimum Variance Portfolio is a defensive strategy that aims to minimize portfolio volatility while maintaining reasonable returns. This strategy is ideal for risk-averse investors.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Minimizes portfolio variance and volatility through mathematical optimization</li>
                  <li>Focuses on asset allocation that reduces overall portfolio risk</li>
                  <li>Often heavily weighted toward stable assets like Bitcoin</li>
                  <li>Suitable for investors who prioritize capital preservation</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Lower volatility compared to other strategies</li>
                  <li>More stable returns with reduced drawdown risk</li>
                  <li>Conservative approach to asset allocation</li>
                </ul>
                <p><strong>Risk Profile:</strong> Defensive - This strategy prioritizes risk minimization and is suitable for conservative investors.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">å…¨å±€æœ€å°æ–¹å·®æŠ•èµ„ç»„åˆ (GMVP)</h4>
                <p class="mb-3">å…¨å±€æœ€å°æ–¹å·®æŠ•èµ„ç»„åˆæ˜¯ä¸€ç§é˜²å¾¡æ€§ç­–ç•¥ï¼Œæ—¨åœ¨æœ€å°åŒ–æŠ•èµ„ç»„åˆæ³¢åŠ¨æ€§ï¼ŒåŒæ—¶ä¿æŒåˆç†å›æŠ¥ã€‚è¯¥ç­–ç•¥é€‚åˆé£é™©åŒæ¶å‹æŠ•èµ„è€…ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>é€šè¿‡æ•°å­¦ä¼˜åŒ–æœ€å°åŒ–æŠ•èµ„ç»„åˆæ–¹å·®å’Œæ³¢åŠ¨æ€§</li>
                  <li>ä¸“æ³¨äºé™ä½æ•´ä½“æŠ•èµ„ç»„åˆé£é™©çš„èµ„äº§é…ç½®</li>
                  <li>é€šå¸¸å¤§é‡é…ç½®ç¨³å®šèµ„äº§ï¼Œå¦‚æ¯”ç‰¹å¸</li>
                  <li>é€‚åˆä¼˜å…ˆè€ƒè™‘èµ„æœ¬ä¿å€¼çš„æŠ•èµ„è€…</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>ä¸å…¶ä»–ç­–ç•¥ç›¸æ¯”ï¼Œæ³¢åŠ¨æ€§è¾ƒä½</li>
                  <li>æ›´ç¨³å®šçš„å›æŠ¥ï¼Œé™ä½å›æ’¤é£é™©</li>
                  <li>ä¿å®ˆçš„èµ„äº§é…ç½®æ–¹æ³•</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> é˜²å¾¡å‹ - è¯¥ç­–ç•¥ä¼˜å…ˆè€ƒè™‘é£é™©æœ€å°åŒ–ï¼Œé€‚åˆä¿å®ˆå‹æŠ•èµ„è€…ã€‚</p>
              `
            },
            risk_parity: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Risk Parity Portfolio</h4>
                <p class="mb-3">The Risk Parity Portfolio allocates risk exposure equally among assets rather than capital. This approach often provides more stability than equal-weighted portfolios.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Equal risk allocation across all assets in the portfolio</li>
                  <li>Accounts for different asset volatilities when allocating capital</li>
                  <li>Provides balanced risk exposure across the portfolio</li>
                  <li>Suitable for investors seeking balanced risk-return profile</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>More stable than equal-weighted portfolios</li>
                  <li>Better risk diversification across assets</li>
                  <li>Balanced approach to portfolio construction</li>
                </ul>
                <p><strong>Risk Profile:</strong> Balanced - This strategy provides balanced risk exposure and moderate returns.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">é£é™©å¹³ä»·æŠ•èµ„ç»„åˆ</h4>
                <p class="mb-3">é£é™©å¹³ä»·æŠ•èµ„ç»„åˆåœ¨èµ„äº§ä¹‹é—´å¹³å‡åˆ†é…é£é™©æ•å£ï¼Œè€Œä¸æ˜¯èµ„æœ¬ã€‚è¿™ç§æ–¹æ³•é€šå¸¸æ¯”ç­‰æƒé‡æŠ•èµ„ç»„åˆæä¾›æ›´ç¨³å®šçš„è¡¨ç°ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æŠ•èµ„ç»„åˆä¸­æ‰€æœ‰èµ„äº§çš„é£é™©åˆ†é…ç›¸ç­‰</li>
                  <li>åœ¨åˆ†é…èµ„æœ¬æ—¶è€ƒè™‘ä¸åŒèµ„äº§çš„æ³¢åŠ¨æ€§</li>
                  <li>åœ¨æ•´ä¸ªæŠ•èµ„ç»„åˆä¸­æä¾›å¹³è¡¡çš„é£é™©æ•å£</li>
                  <li>é€‚åˆå¯»æ±‚å¹³è¡¡é£é™©å›æŠ¥ç‰¹å¾çš„æŠ•èµ„è€…</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æ¯”ç­‰æƒé‡æŠ•èµ„ç»„åˆæ›´ç¨³å®š</li>
                  <li>æ›´å¥½çš„è·¨èµ„äº§é£é™©åˆ†æ•£</li>
                  <li>å¹³è¡¡çš„æŠ•èµ„ç»„åˆæ„å»ºæ–¹æ³•</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> å¹³è¡¡å‹ - è¯¥ç­–ç•¥æä¾›å¹³è¡¡çš„é£é™©æ•å£å’Œä¸­ç­‰å›æŠ¥ã€‚</p>
              `
            },
            ew: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Equal Weighted Portfolio (EW)</h4>
                <p class="mb-3">The Equal Weighted Portfolio allocates capital equally to every asset in the portfolio. This is the simplest diversification method.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Equal capital allocation across all assets</li>
                  <li>Simple and easy to understand</li>
                  <li>No complex optimization required</li>
                  <li>Suitable for investors seeking simple diversification</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Straightforward approach to portfolio construction</li>
                  <li>Equal exposure to all assets</li>
                  <li>No bias toward any particular asset</li>
                </ul>
                <p><strong>Risk Profile:</strong> Balanced - This strategy provides equal exposure to all assets without complex optimization.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">ç­‰æƒé‡æŠ•èµ„ç»„åˆ (EW)</h4>
                <p class="mb-3">ç­‰æƒé‡æŠ•èµ„ç»„åˆå°†èµ„æœ¬å¹³å‡åˆ†é…ç»™æŠ•èµ„ç»„åˆä¸­çš„æ¯ä¸ªèµ„äº§ã€‚è¿™æ˜¯æœ€ç®€å•çš„åˆ†æ•£åŒ–æ–¹æ³•ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æ‰€æœ‰èµ„äº§çš„èµ„æœ¬åˆ†é…ç›¸ç­‰</li>
                  <li>ç®€å•æ˜“æ‡‚</li>
                  <li>ä¸éœ€è¦å¤æ‚çš„ä¼˜åŒ–</li>
                  <li>é€‚åˆå¯»æ±‚ç®€å•åˆ†æ•£åŒ–çš„æŠ•èµ„è€…</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>ç›´æ¥çš„æŠ•èµ„ç»„åˆæ„å»ºæ–¹æ³•</li>
                  <li>å¯¹æ‰€æœ‰èµ„äº§çš„å¹³å‡æ•å£</li>
                  <li>ä¸å¯¹ä»»ä½•ç‰¹å®šèµ„äº§äº§ç”Ÿåè§</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> å¹³è¡¡å‹ - è¯¥ç­–ç•¥åœ¨ä¸è¿›è¡Œå¤æ‚ä¼˜åŒ–çš„æƒ…å†µä¸‹æä¾›å¯¹æ‰€æœ‰èµ„äº§çš„å¹³ç­‰æ•å£ã€‚</p>
              `
            },
            ew_top7_momentum: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Top-7 Momentum Equal Weighted</h4>
                <p class="mb-3">The Top-7 Momentum strategy selects the top 7 tokens by annual momentum monthly and applies an equal weight allocation.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Monthly rebalancing based on momentum signals</li>
                  <li>Focuses on top-performing assets with strong momentum</li>
                  <li>Equal weight allocation among selected assets</li>
                  <li>Dynamic asset selection based on performance</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Captures momentum trends in the market</li>
                  <li>Regular rebalancing to maintain optimal exposure</li>
                  <li>Focus on high-performing assets</li>
                </ul>
                <p><strong>Risk Profile:</strong> Momentum - This strategy follows momentum trends and may experience volatility during trend reversals.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">å‰7ååŠ¨é‡ç­‰æƒé‡</h4>
                <p class="mb-3">å‰7ååŠ¨é‡ç­–ç•¥æ¯æœˆæ ¹æ®å¹´åº¦åŠ¨é‡é€‰æ‹©å‰7ä¸ªä»£å¸ï¼Œå¹¶åº”ç”¨ç­‰æƒé‡åˆ†é…ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>åŸºäºåŠ¨é‡ä¿¡å·çš„æœˆåº¦å†å¹³è¡¡</li>
                  <li>ä¸“æ³¨äºå…·æœ‰å¼ºåŠ²åŠ¨é‡çš„è¡¨ç°æœ€ä½³èµ„äº§</li>
                  <li>æ‰€é€‰èµ„äº§ä¹‹é—´çš„ç­‰æƒé‡åˆ†é…</li>
                  <li>åŸºäºè¡¨ç°çš„åŠ¨æ€èµ„äº§é€‰æ‹©</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æ•æ‰å¸‚åœºä¸­çš„åŠ¨é‡è¶‹åŠ¿</li>
                  <li>å®šæœŸå†å¹³è¡¡ä»¥ç»´æŒæœ€ä½³æ•å£</li>
                  <li>ä¸“æ³¨äºè¡¨ç°è‰¯å¥½çš„èµ„äº§</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> åŠ¨é‡å‹ - è¯¥ç­–ç•¥è·ŸéšåŠ¨é‡è¶‹åŠ¿ï¼Œåœ¨è¶‹åŠ¿åè½¬æœŸé—´å¯èƒ½ç»å†æ³¢åŠ¨æ€§ã€‚</p>
              `
            },
            max_diversification: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Max Diversification Portfolio</h4>
                <p class="mb-3">The Max Diversification Portfolio constructs a portfolio by minimizing the correlation between assets, aiming for optimal risk dispersion.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Minimizes correlation between portfolio assets</li>
                  <li>Optimizes risk dispersion across the portfolio</li>
                  <li>May include short positions to reduce correlation</li>
                  <li>Suitable for investors seeking maximum diversification</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Optimal risk dispersion</li>
                  <li>Reduced portfolio correlation</li>
                  <li>Balanced risk exposure</li>
                </ul>
                <p><strong>Risk Profile:</strong> Balanced - This strategy focuses on maximum diversification and risk dispersion.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">æœ€å¤§åˆ†æ•£åŒ–æŠ•èµ„ç»„åˆ</h4>
                <p class="mb-3">æœ€å¤§åˆ†æ•£åŒ–æŠ•èµ„ç»„åˆé€šè¿‡æœ€å°åŒ–èµ„äº§ä¹‹é—´çš„ç›¸å…³æ€§æ¥æ„å»ºæŠ•èµ„ç»„åˆï¼Œæ—¨åœ¨å®ç°æœ€ä¼˜çš„é£é™©åˆ†æ•£ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æœ€å°åŒ–æŠ•èµ„ç»„åˆèµ„äº§ä¹‹é—´çš„ç›¸å…³æ€§</li>
                  <li>ä¼˜åŒ–æ•´ä¸ªæŠ•èµ„ç»„åˆçš„é£é™©åˆ†æ•£</li>
                  <li>å¯èƒ½åŒ…æ‹¬ç©ºå¤´å¤´å¯¸ä»¥é™ä½ç›¸å…³æ€§</li>
                  <li>é€‚åˆå¯»æ±‚æœ€å¤§åˆ†æ•£åŒ–çš„æŠ•èµ„è€…</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>æœ€ä¼˜çš„é£é™©åˆ†æ•£</li>
                  <li>é™ä½æŠ•èµ„ç»„åˆç›¸å…³æ€§</li>
                  <li>å¹³è¡¡çš„é£é™©æ•å£</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> å¹³è¡¡å‹ - è¯¥ç­–ç•¥ä¸“æ³¨äºæœ€å¤§åˆ†æ•£åŒ–å’Œé£é™©åˆ†æ•£ã€‚</p>
              `
            },
            sentiment_tilted: {
              en: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">Dynamic Sentiment-Tilted Strategy (0.3)</h4>
                <p class="mb-3">The Dynamic Sentiment-Tilted Strategy combines market sentiment and momentum factors to dynamically adjust exposure to the Top-5 assets.</p>
                <p class="mb-3"><strong>Key Features:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Combines market sentiment analysis with momentum signals</li>
                  <li>Dynamically adjusts asset allocation based on market conditions</li>
                  <li>Focuses on top-performing assets with positive sentiment</li>
                  <li>Adaptive strategy that responds to market changes</li>
                </ul>
                <p class="mb-3"><strong>Performance Highlights:</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>Adaptive to market sentiment changes</li>
                  <li>Combines multiple factors for better decision-making</li>
                  <li>Dynamic asset allocation</li>
                </ul>
                <p><strong>Risk Profile:</strong> Dynamic - This strategy adapts to market conditions and may change allocation frequently.</p>
              `,
              zh: `
                <h4 class="font-semibold text-lg mb-2" style="color: var(--text-primary);">åŠ¨æ€æƒ…ç»ªå€¾æ–œç­–ç•¥ (0.3)</h4>
                <p class="mb-3">åŠ¨æ€æƒ…ç»ªå€¾æ–œç­–ç•¥ç»“åˆå¸‚åœºæƒ…ç»ªå’ŒåŠ¨é‡å› ç´ ï¼ŒåŠ¨æ€è°ƒæ•´å¯¹å‰5åèµ„äº§çš„æ•å£ã€‚</p>
                <p class="mb-3"><strong>ä¸»è¦ç‰¹ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>ç»“åˆå¸‚åœºæƒ…ç»ªåˆ†æå’ŒåŠ¨é‡ä¿¡å·</li>
                  <li>æ ¹æ®å¸‚åœºçŠ¶å†µåŠ¨æ€è°ƒæ•´èµ„äº§é…ç½®</li>
                  <li>ä¸“æ³¨äºå…·æœ‰æ­£é¢æƒ…ç»ªçš„è¡¨ç°æœ€ä½³èµ„äº§</li>
                  <li>å“åº”å¸‚åœºå˜åŒ–çš„è‡ªé€‚åº”ç­–ç•¥</li>
                </ul>
                <p class="mb-3"><strong>è¡¨ç°äº®ç‚¹ï¼š</strong></p>
                <ul class="list-disc list-inside space-y-1 mb-3 ml-4">
                  <li>é€‚åº”å¸‚åœºæƒ…ç»ªå˜åŒ–</li>
                  <li>ç»“åˆå¤šä¸ªå› ç´ ä»¥åšå‡ºæ›´å¥½çš„å†³ç­–</li>
                  <li>åŠ¨æ€èµ„äº§é…ç½®</li>
                </ul>
                <p><strong>é£é™©ç‰¹å¾ï¼š</strong> åŠ¨æ€å‹ - è¯¥ç­–ç•¥é€‚åº”å¸‚åœºçŠ¶å†µï¼Œå¯èƒ½ä¼šé¢‘ç¹æ”¹å˜é…ç½®ã€‚</p>
              `
            }
          };
          
          // Get introduction based on strategy ID and current language
          const intro = strategyDescriptions[strategyId];
          if (intro && intro[currentLanguage]) {
            // Cache the introduction
            localStorage.setItem(cacheKey, JSON.stringify({
              content: intro[currentLanguage],
              timestamp: Date.now()
            }));
            return intro[currentLanguage];
          }
          
          // Fallback: Use intelligent generation if not available
          try {
            const language = currentLanguage === "zh" ? "ä¸­æ–‡" : "English";
            const prompt = `Please provide a detailed introduction for the ${strategy.name} investment strategy in ${language}. 
            
Strategy Details:
- Name: ${strategy.name}
- Type: ${strategy.type}
- Description: ${strategy.description}
- Annualized Return: ${strategy.metrics["Annualized Return"]}
- Annualized Volatility: ${strategy.metrics["Annualized Volatility"]}
- Sharpe Ratio: ${strategy.metrics["Sharpe Ratio"]}
- Max Drawdown: ${strategy.metrics["Max Drawdown"]}

Please provide:
1. A comprehensive explanation of what this strategy does
2. Key features and characteristics
3. Performance highlights
4. Risk profile and suitability

Format the response in HTML with proper headings and bullet points.`;
            
            const aiIntro = await callGeminiAPI(prompt);
            if (aiIntro && !aiIntro.includes("API key not configured") && !aiIntro.includes("error")) {
              // Cache the system-generated introduction
              localStorage.setItem(cacheKey, JSON.stringify({
                content: `<div class="prose prose-invert max-w-none">${aiIntro.replace(/\n/g, "<br>")}</div>`,
                timestamp: Date.now()
              }));
              return `<div class="prose prose-invert max-w-none">${aiIntro.replace(/\n/g, "<br>")}</div>`;
            }
          } catch (error) {
            console.error("Error generating strategy introduction:", error);
          }
          
          // Final fallback: Return basic description
          return `<p>${strategy.description}</p>`;
        }

        /**
         * Call Gemini API for intelligent analysis
         * @param {string} prompt - The prompt to send to the API
         * @returns {Promise<string>} The generated analysis response
         */
        async function callGeminiAPI(prompt) {
          // SECURITY NOTE: API key should be stored securely (e.g., environment variable)
          // For production, use a backend proxy to hide the API key
          const apiKey = ""; // Set this in your environment or use a backend proxy
          if (!apiKey) {
            return "API key not configured. Please configure your Gemini API key to use intelligent analysis.";
          }
          
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
          const payload = { contents: [{ parts: [{ text: prompt }] }] };
          
          try {
            const response = await fetch(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            
            if (!response.ok) {
              if (response.status === 401) {
                throw new Error("Invalid API key. Please check your configuration.");
              } else if (response.status === 429) {
                throw new Error("Rate limit exceeded. Please try again later.");
              } else {
                throw new Error(`API call failed with status: ${response.status}`);
              }
            }
            
            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
              return result.candidates[0].content.parts[0].text;
            }
            return "Could not get a valid response from the analysis service. Please try again later.";
          } catch (error) {
            console.error("Gemini API call error:", error);
            return `An error occurred while calling the analysis service: ${error.message}. Please check your connection or try again later.`;
          }
        }

        /**
         * Analyze news article using intelligent analysis
         * @param {string} title - News article title
         */
        async function analyzeNews(title) {
          const aiModalContent = document.getElementById("aiAnalysisContent");
          const aiModal = document.getElementById("aiAnalysisModal");
          
          // Show loading state
          aiModalContent.innerHTML = `
            <div class="text-center py-8" role="status" aria-live="polite">
              <div class="spinner mx-auto"></div>
              <p class="mt-4 text-secondary">${currentLanguage === "zh" ? "ç³»ç»Ÿæ­£åœ¨åˆ†æè¿™åˆ™æ–°é—»..." : "The system is analyzing this news..."}</p>
            </div>
          `;
          aiModal.setAttribute("aria-hidden", "false");
          openModal("aiAnalysisModal");
          
          try {
          const prompt = `Analyze the potential market impact of this crypto news headline: "${title}". Explain it concisely for a retail investor.`;
          const analysis = await callGeminiAPI(prompt);
            
            // Sanitize and format the analysis
            const sanitizedAnalysis = analysis
              .replace(/\n/g, "<br>")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/&lt;br&gt;/g, "<br>"); // Restore line breaks
            
            aiModalContent.innerHTML = `<div class="prose prose-invert max-w-none">${sanitizedAnalysis}</div>`;
          } catch (error) {
            console.error("Error analyzing news:", error);
            aiModalContent.innerHTML = `
              <div class="error-message" role="alert">
                <p>Failed to analyze news: ${error.message}</p>
              </div>
            `;
          }
        }

        // --- ACCESSIBILITY ---
        function toggleTheme() {
          // Cycle through: light -> dark -> sand -> light
          if (document.body.classList.contains("light-theme")) {
            document.body.classList.remove("light-theme");
            document.body.classList.add("dark-theme");
            localStorage.setItem("theme", "dark");
          } else if (document.body.classList.contains("dark-theme")) {
            document.body.classList.remove("dark-theme");
            document.body.classList.add("sand-theme");
            localStorage.setItem("theme", "sand");
          } else {
            document.body.classList.remove("sand-theme");
            document.body.classList.add("light-theme");
            localStorage.setItem("theme", "light");
          }
          updateThemeIcon();
          destroyActiveCharts();
          populatePortfolioSummary();
        }
        
        function toggleColorblindMode() {
          document.body.classList.toggle("colorblind-mode");
          localStorage.setItem(
            "colorblind",
            document.body.classList.contains("colorblind-mode")
          );
          destroyActiveCharts();
          populateHoldings(
            allMarketData.filter((d) => userHoldingsSymbols.includes(d.symbol))
          );
        }
        
        function toggleLanguage() {
          updateLanguage();
        }
        
        function updateThemeIcon() {
          const icon = document.getElementById("theme-icon");
          if (!icon) return;
          
          if (document.body.classList.contains("light-theme")) {
            // Moon icon - next theme is dark
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
          } else if (document.body.classList.contains("dark-theme")) {
            // Globe/earth icon - next theme is sand
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>`;
          } else if (document.body.classList.contains("sand-theme")) {
            // Sun icon - next theme is light
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>`;
          } else {
            // Default: Moon icon
            icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
          }
        }

        // --- UTILITY ---
        function formatPrice(price) {
          if (price < 1) return `$${price.toPrecision(4)}`;
          return `$${new Intl.NumberFormat("en-US", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }).format(price)}`;
        }

        // --- START THE APP ---
        init();
        const scrollToReportBtn = document.getElementById('scrollToReportBtn');
        const docViewerSection = document.getElementById('docViewer');
        if (scrollToReportBtn && docViewerSection) {
          scrollToReportBtn.addEventListener('click', () => {
            docViewerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
        }
      });
    </script>
  </body>
</html>

